window.driver = "let modules =/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 2);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony export (immutable) */ __webpack_exports__[\"CodeBlockToPlainText\"] = CodeBlockToPlainText;\n/* harmony export (immutable) */ __webpack_exports__[\"processDocCode\"] = processDocCode;\n/* harmony export (immutable) */ __webpack_exports__[\"makeImgVisible\"] = makeImgVisible;\nfunction escapeHtml(text) {\n  return text\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;')\n}\n\nfunction getChildren(obj, count) {\n  count++\n  if (count > 4) return null\n  if (obj.children().length > 1) return obj\n  return getChildren(obj.children().eq(0), count)\n}\n\nfunction CodeBlockToPlainTextOther(pre) {\n  var text = []\n  var minSub = getChildren(pre, 0)\n  var lines = minSub.children()\n  for (let index = 0; index < lines.length; index++) {\n    const element = lines.eq(index)\n    const codeStr = element.text()\n    text.push(escapeHtml(codeStr))\n  }\n  return text.join('\\n')\n}\n\nfunction CodeBlockToPlainText(pre) {\n  var text = []\n  var minSub = getChildren(pre, 0)\n  var lines = pre.find('code')\n  if (lines.length > 1) {\n    return CodeBlockToPlainTextOther(pre)\n  }\n\n  for (let index = 0; index < lines.length; index++) {\n    const element = lines.eq(index)\n    const codeStr = element[0].innerText\n    console.log('codeStr', codeStr)\n    var codeLines = codeStr.split('\\n')\n    codeLines.forEach((codeLine) => {\n      text.push('<code>' + escapeHtml(codeLine) + '</code>')\n    })\n  }\n  return text.join('\\n')\n}\n\nfunction processDocCode(div) {\n  var doc = div\n  var pres = doc.find('pre')\n  // console.log(\"find code blocks\", pres.length, post);\n  for (let mindex = 0; mindex < pres.length; mindex++) {\n    const pre = pres.eq(mindex)\n    try {\n      var newHtml = CodeBlockToPlainText(pre, 0)\n      if (newHtml) {\n        console.log('processDocCode', newHtml)\n        pre.html(newHtml)\n      } else {\n        console.log('processDocCode.failed')\n      }\n    } catch (e) {}\n  }\n}\n\nfunction makeImgVisible(doc) {\n  console.log('makeImgVisible')\n  var pres = doc.find('img')\n  for (let mindex = 0; mindex < pres.length; mindex++) {\n    const item = pres.eq(mindex)\n    const src = item.attr('data-src')\n    if (src) {\n      item.attr('src', src)\n    }\n  }\n}\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nfunction extend (destination) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n      if (source.hasOwnProperty(key)) destination[key] = source[key];\n    }\n  }\n  return destination\n}\n\nfunction repeat (character, count) {\n  return Array(count + 1).join(character)\n}\n\nvar blockElements = [\n  'address', 'article', 'aside', 'audio', 'blockquote', 'body', 'canvas',\n  'center', 'dd', 'dir', 'div', 'dl', 'dt', 'fieldset', 'figcaption',\n  'figure', 'footer', 'form', 'frameset', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',\n  'header', 'hgroup', 'hr', 'html', 'isindex', 'li', 'main', 'menu', 'nav',\n  'noframes', 'noscript', 'ol', 'output', 'p', 'pre', 'section', 'table',\n  'tbody', 'td', 'tfoot', 'th', 'thead', 'tr', 'ul'\n];\n\nfunction isBlock (node) {\n  return blockElements.indexOf(node.nodeName.toLowerCase()) !== -1\n}\n\nvar voidElements = [\n  'area', 'base', 'br', 'col', 'command', 'embed', 'hr', 'img', 'input',\n  'keygen', 'link', 'meta', 'param', 'source', 'track', 'wbr'\n];\n\nfunction isVoid (node) {\n  return voidElements.indexOf(node.nodeName.toLowerCase()) !== -1\n}\n\nvar voidSelector = voidElements.join();\nfunction hasVoid (node) {\n  return node.querySelector && node.querySelector(voidSelector)\n}\n\nvar rules = {};\n\nrules.paragraph = {\n  filter: 'p',\n\n  replacement: function (content) {\n    return '\\n\\n' + content + '\\n\\n'\n  }\n};\n\nrules.lineBreak = {\n  filter: 'br',\n\n  replacement: function (content, node, options) {\n    return options.br + '\\n'\n  }\n};\n\nrules.heading = {\n  filter: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\n\n  replacement: function (content, node, options) {\n    var hLevel = Number(node.nodeName.charAt(1));\n\n    if (options.headingStyle === 'setext' && hLevel < 3) {\n      var underline = repeat((hLevel === 1 ? '=' : '-'), content.length);\n      return (\n        '\\n\\n' + content + '\\n' + underline + '\\n\\n'\n      )\n    } else {\n      return '\\n\\n' + repeat('#', hLevel) + ' ' + content + '\\n\\n'\n    }\n  }\n};\n\nrules.blockquote = {\n  filter: 'blockquote',\n\n  replacement: function (content) {\n    content = content.replace(/^\\n+|\\n+$/g, '');\n    content = content.replace(/^/gm, '> ');\n    return '\\n\\n' + content + '\\n\\n'\n  }\n};\n\nrules.list = {\n  filter: ['ul', 'ol'],\n\n  replacement: function (content, node) {\n    var parent = node.parentNode;\n    if (parent.nodeName === 'LI' && parent.lastElementChild === node) {\n      return '\\n' + content\n    } else {\n      return '\\n\\n' + content + '\\n\\n'\n    }\n  }\n};\n\nrules.listItem = {\n  filter: 'li',\n\n  replacement: function (content, node, options) {\n    content = content\n      .replace(/^\\n+/, '') // remove leading newlines\n      .replace(/\\n+$/, '\\n') // replace trailing newlines with just a single one\n      .replace(/\\n/gm, '\\n    '); // indent\n    var prefix = options.bulletListMarker + '   ';\n    var parent = node.parentNode;\n    if (parent.nodeName === 'OL') {\n      var start = parent.getAttribute('start');\n      var index = Array.prototype.indexOf.call(parent.children, node);\n      prefix = (start ? Number(start) + index : index + 1) + '.  ';\n    }\n    return (\n      prefix + content + (node.nextSibling && !/\\n$/.test(content) ? '\\n' : '')\n    )\n  }\n};\n\nrules.indentedCodeBlock = {\n  filter: function (node, options) {\n    return (\n      options.codeBlockStyle === 'indented' &&\n      node.nodeName === 'PRE' &&\n      node.firstChild &&\n      node.firstChild.nodeName === 'CODE'\n    )\n  },\n\n  replacement: function (content, node, options) {\n    return (\n      '\\n\\n    ' +\n      node.firstChild.textContent.replace(/\\n/g, '\\n    ') +\n      '\\n\\n'\n    )\n  }\n};\n\nrules.fencedCodeBlock = {\n  filter: function (node, options) {\n    return (\n      options.codeBlockStyle === 'fenced' &&\n      node.nodeName === 'PRE' &&\n      node.firstChild &&\n      node.firstChild.nodeName === 'CODE'\n    )\n  },\n\n  replacement: function (content, node, options) {\n    var className = node.firstChild.className || '';\n    var language = (className.match(/language-(\\S+)/) || [null, ''])[1];\n    var code = node.firstChild.textContent;\n\n    var fenceChar = options.fence.charAt(0);\n    var fenceSize = 3;\n    var fenceInCodeRegex = new RegExp('^' + fenceChar + '{3,}', 'gm');\n\n    var match;\n    while ((match = fenceInCodeRegex.exec(code))) {\n      if (match[0].length >= fenceSize) {\n        fenceSize = match[0].length + 1;\n      }\n    }\n\n    var fence = repeat(fenceChar, fenceSize);\n\n    return (\n      '\\n\\n' + fence + language + '\\n' +\n      code.replace(/\\n$/, '') +\n      '\\n' + fence + '\\n\\n'\n    )\n  }\n};\n\nrules.horizontalRule = {\n  filter: 'hr',\n\n  replacement: function (content, node, options) {\n    return '\\n\\n' + options.hr + '\\n\\n'\n  }\n};\n\nrules.inlineLink = {\n  filter: function (node, options) {\n    return (\n      options.linkStyle === 'inlined' &&\n      node.nodeName === 'A' &&\n      node.getAttribute('href')\n    )\n  },\n\n  replacement: function (content, node) {\n    var href = node.getAttribute('href');\n    var title = node.title ? ' \"' + node.title + '\"' : '';\n    return '[' + content + '](' + href + title + ')'\n  }\n};\n\nrules.referenceLink = {\n  filter: function (node, options) {\n    return (\n      options.linkStyle === 'referenced' &&\n      node.nodeName === 'A' &&\n      node.getAttribute('href')\n    )\n  },\n\n  replacement: function (content, node, options) {\n    var href = node.getAttribute('href');\n    var title = node.title ? ' \"' + node.title + '\"' : '';\n    var replacement;\n    var reference;\n\n    switch (options.linkReferenceStyle) {\n      case 'collapsed':\n        replacement = '[' + content + '][]';\n        reference = '[' + content + ']: ' + href + title;\n        break\n      case 'shortcut':\n        replacement = '[' + content + ']';\n        reference = '[' + content + ']: ' + href + title;\n        break\n      default:\n        var id = this.references.length + 1;\n        replacement = '[' + content + '][' + id + ']';\n        reference = '[' + id + ']: ' + href + title;\n    }\n\n    this.references.push(reference);\n    return replacement\n  },\n\n  references: [],\n\n  append: function (options) {\n    var references = '';\n    if (this.references.length) {\n      references = '\\n\\n' + this.references.join('\\n') + '\\n\\n';\n      this.references = []; // Reset references\n    }\n    return references\n  }\n};\n\nrules.emphasis = {\n  filter: ['em', 'i'],\n\n  replacement: function (content, node, options) {\n    if (!content.trim()) return ''\n    return options.emDelimiter + content + options.emDelimiter\n  }\n};\n\nrules.strong = {\n  filter: ['strong', 'b'],\n\n  replacement: function (content, node, options) {\n    if (!content.trim()) return ''\n    return options.strongDelimiter + content + options.strongDelimiter\n  }\n};\n\nrules.code = {\n  filter: function (node) {\n    var hasSiblings = node.previousSibling || node.nextSibling;\n    var isCodeBlock = node.parentNode.nodeName === 'PRE' && !hasSiblings;\n\n    return node.nodeName === 'CODE' && !isCodeBlock\n  },\n\n  replacement: function (content) {\n    if (!content.trim()) return ''\n\n    var delimiter = '`';\n    var leadingSpace = '';\n    var trailingSpace = '';\n    var matches = content.match(/`+/gm);\n    if (matches) {\n      if (/^`/.test(content)) leadingSpace = ' ';\n      if (/`$/.test(content)) trailingSpace = ' ';\n      while (matches.indexOf(delimiter) !== -1) delimiter = delimiter + '`';\n    }\n\n    return delimiter + leadingSpace + content + trailingSpace + delimiter\n  }\n};\n\nrules.image = {\n  filter: 'img',\n\n  replacement: function (content, node) {\n    var alt = node.alt || '';\n    var src = node.getAttribute('src') || '';\n    var title = node.title || '';\n    var titlePart = title ? ' \"' + title + '\"' : '';\n    return src ? '![' + alt + ']' + '(' + src + titlePart + ')' : ''\n  }\n};\n\n/**\n * Manages a collection of rules used to convert HTML to Markdown\n */\n\nfunction Rules (options) {\n  this.options = options;\n  this._keep = [];\n  this._remove = [];\n\n  this.blankRule = {\n    replacement: options.blankReplacement\n  };\n\n  this.keepReplacement = options.keepReplacement;\n\n  this.defaultRule = {\n    replacement: options.defaultReplacement\n  };\n\n  this.array = [];\n  for (var key in options.rules) this.array.push(options.rules[key]);\n}\n\nRules.prototype = {\n  add: function (key, rule) {\n    this.array.unshift(rule);\n  },\n\n  keep: function (filter) {\n    this._keep.unshift({\n      filter: filter,\n      replacement: this.keepReplacement\n    });\n  },\n\n  remove: function (filter) {\n    this._remove.unshift({\n      filter: filter,\n      replacement: function () {\n        return ''\n      }\n    });\n  },\n\n  forNode: function (node) {\n    if (node.isBlank) return this.blankRule\n    var rule;\n\n    if ((rule = findRule(this.array, node, this.options))) return rule\n    if ((rule = findRule(this._keep, node, this.options))) return rule\n    if ((rule = findRule(this._remove, node, this.options))) return rule\n\n    return this.defaultRule\n  },\n\n  forEach: function (fn) {\n    for (var i = 0; i < this.array.length; i++) fn(this.array[i], i);\n  }\n};\n\nfunction findRule (rules, node, options) {\n  for (var i = 0; i < rules.length; i++) {\n    var rule = rules[i];\n    if (filterValue(rule, node, options)) return rule\n  }\n  return void 0\n}\n\nfunction filterValue (rule, node, options) {\n  var filter = rule.filter;\n  if (typeof filter === 'string') {\n    if (filter === node.nodeName.toLowerCase()) return true\n  } else if (Array.isArray(filter)) {\n    if (filter.indexOf(node.nodeName.toLowerCase()) > -1) return true\n  } else if (typeof filter === 'function') {\n    if (filter.call(rule, node, options)) return true\n  } else {\n    throw new TypeError('`filter` needs to be a string, array, or function')\n  }\n}\n\n/**\n * The collapseWhitespace function is adapted from collapse-whitespace\n * by Luc Thevenard.\n *\n * The MIT License (MIT)\n *\n * Copyright (c) 2014 Luc Thevenard <lucthevenard@gmail.com>\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * collapseWhitespace(options) removes extraneous whitespace from an the given element.\n *\n * @param {Object} options\n */\nfunction collapseWhitespace (options) {\n  var element = options.element;\n  var isBlock = options.isBlock;\n  var isVoid = options.isVoid;\n  var isPre = options.isPre || function (node) {\n    return node.nodeName === 'PRE'\n  };\n\n  if (!element.firstChild || isPre(element)) return\n\n  var prevText = null;\n  var prevVoid = false;\n\n  var prev = null;\n  var node = next(prev, element, isPre);\n\n  while (node !== element) {\n    if (node.nodeType === 3 || node.nodeType === 4) { // Node.TEXT_NODE or Node.CDATA_SECTION_NODE\n      var text = node.data.replace(/[ \\r\\n\\t]+/g, ' ');\n\n      if ((!prevText || / $/.test(prevText.data)) &&\n          !prevVoid && text[0] === ' ') {\n        text = text.substr(1);\n      }\n\n      // `text` might be empty at this point.\n      if (!text) {\n        node = remove(node);\n        continue\n      }\n\n      node.data = text;\n\n      prevText = node;\n    } else if (node.nodeType === 1) { // Node.ELEMENT_NODE\n      if (isBlock(node) || node.nodeName === 'BR') {\n        if (prevText) {\n          prevText.data = prevText.data.replace(/ $/, '');\n        }\n\n        prevText = null;\n        prevVoid = false;\n      } else if (isVoid(node)) {\n        // Avoid trimming space around non-block, non-BR void elements.\n        prevText = null;\n        prevVoid = true;\n      }\n    } else {\n      node = remove(node);\n      continue\n    }\n\n    var nextNode = next(prev, node, isPre);\n    prev = node;\n    node = nextNode;\n  }\n\n  if (prevText) {\n    prevText.data = prevText.data.replace(/ $/, '');\n    if (!prevText.data) {\n      remove(prevText);\n    }\n  }\n}\n\n/**\n * remove(node) removes the given node from the DOM and returns the\n * next node in the sequence.\n *\n * @param {Node} node\n * @return {Node} node\n */\nfunction remove (node) {\n  var next = node.nextSibling || node.parentNode;\n\n  node.parentNode.removeChild(node);\n\n  return next\n}\n\n/**\n * next(prev, current, isPre) returns the next node in the sequence, given the\n * current and previous nodes.\n *\n * @param {Node} prev\n * @param {Node} current\n * @param {Function} isPre\n * @return {Node}\n */\nfunction next (prev, current, isPre) {\n  if ((prev && prev.parentNode === current) || isPre(current)) {\n    return current.nextSibling || current.parentNode\n  }\n\n  return current.firstChild || current.nextSibling || current.parentNode\n}\n\n/*\n * Set up window for Node.js\n */\n\nvar root = (typeof window !== 'undefined' ? window : {});\n\n/*\n * Parsing HTML strings\n */\n\nfunction canParseHTMLNatively () {\n  var Parser = root.DOMParser;\n  var canParse = false;\n\n  // Adapted from https://gist.github.com/1129031\n  // Firefox/Opera/IE throw errors on unsupported types\n  try {\n    // WebKit returns null on unsupported types\n    if (new Parser().parseFromString('', 'text/html')) {\n      canParse = true;\n    }\n  } catch (e) {}\n\n  return canParse\n}\n\nfunction createHTMLParser () {\n  var Parser = function () {};\n\n  {\n    var JSDOM = __webpack_require__(9).JSDOM;\n    Parser.prototype.parseFromString = function (string) {\n      return new JSDOM(string).window.document\n    };\n  }\n  return Parser\n}\n\nvar HTMLParser = canParseHTMLNatively() ? root.DOMParser : createHTMLParser();\n\nfunction RootNode (input) {\n  var root;\n  if (typeof input === 'string') {\n    var doc = htmlParser().parseFromString(\n      // DOM parsers arrange elements in the <head> and <body>.\n      // Wrapping in a custom element ensures elements are reliably arranged in\n      // a single element.\n      '<x-turndown id=\"turndown-root\">' + input + '</x-turndown>',\n      'text/html'\n    );\n    root = doc.getElementById('turndown-root');\n  } else {\n    root = input.cloneNode(true);\n  }\n  collapseWhitespace({\n    element: root,\n    isBlock: isBlock,\n    isVoid: isVoid\n  });\n\n  return root\n}\n\nvar _htmlParser;\nfunction htmlParser () {\n  _htmlParser = _htmlParser || new HTMLParser();\n  return _htmlParser\n}\n\nfunction Node (node) {\n  node.isBlock = isBlock(node);\n  node.isCode = node.nodeName.toLowerCase() === 'code' || node.parentNode.isCode;\n  node.isBlank = isBlank(node);\n  node.flankingWhitespace = flankingWhitespace(node);\n  return node\n}\n\nfunction isBlank (node) {\n  return (\n    ['A', 'TH', 'TD', 'IFRAME', 'SCRIPT', 'AUDIO', 'VIDEO'].indexOf(node.nodeName) === -1 &&\n    /^\\s*$/i.test(node.textContent) &&\n    !isVoid(node) &&\n    !hasVoid(node)\n  )\n}\n\nfunction flankingWhitespace (node) {\n  var leading = '';\n  var trailing = '';\n\n  if (!node.isBlock) {\n    var hasLeading = /^\\s/.test(node.textContent);\n    var hasTrailing = /\\s$/.test(node.textContent);\n    var blankWithSpaces = node.isBlank && hasLeading && hasTrailing;\n\n    if (hasLeading && !isFlankedByWhitespace('left', node)) {\n      leading = ' ';\n    }\n\n    if (!blankWithSpaces && hasTrailing && !isFlankedByWhitespace('right', node)) {\n      trailing = ' ';\n    }\n  }\n\n  return { leading: leading, trailing: trailing }\n}\n\nfunction isFlankedByWhitespace (side, node) {\n  var sibling;\n  var regExp;\n  var isFlanked;\n\n  if (side === 'left') {\n    sibling = node.previousSibling;\n    regExp = / $/;\n  } else {\n    sibling = node.nextSibling;\n    regExp = /^ /;\n  }\n\n  if (sibling) {\n    if (sibling.nodeType === 3) {\n      isFlanked = regExp.test(sibling.nodeValue);\n    } else if (sibling.nodeType === 1 && !isBlock(sibling)) {\n      isFlanked = regExp.test(sibling.textContent);\n    }\n  }\n  return isFlanked\n}\n\nvar reduce = Array.prototype.reduce;\nvar leadingNewLinesRegExp = /^\\n*/;\nvar trailingNewLinesRegExp = /\\n*$/;\nvar escapes = [\n  [/\\\\/g, '\\\\\\\\'],\n  [/\\*/g, '\\\\*'],\n  [/^-/g, '\\\\-'],\n  [/^\\+ /g, '\\\\+ '],\n  [/^(=+)/g, '\\\\$1'],\n  [/^(#{1,6}) /g, '\\\\$1 '],\n  [/`/g, '\\\\`'],\n  [/^~~~/g, '\\\\~~~'],\n  [/\\[/g, '\\\\['],\n  [/\\]/g, '\\\\]'],\n  [/^>/g, '\\\\>'],\n  [/_/g, '\\\\_'],\n  [/^(\\d+)\\. /g, '$1\\\\. ']\n];\n\nfunction TurndownService (options) {\n  if (!(this instanceof TurndownService)) return new TurndownService(options)\n\n  var defaults = {\n    rules: rules,\n    headingStyle: 'setext',\n    hr: '* * *',\n    bulletListMarker: '*',\n    codeBlockStyle: 'indented',\n    fence: '```',\n    emDelimiter: '_',\n    strongDelimiter: '**',\n    linkStyle: 'inlined',\n    linkReferenceStyle: 'full',\n    br: '  ',\n    blankReplacement: function (content, node) {\n      return node.isBlock ? '\\n\\n' : ''\n    },\n    keepReplacement: function (content, node) {\n      return node.isBlock ? '\\n\\n' + node.outerHTML + '\\n\\n' : node.outerHTML\n    },\n    defaultReplacement: function (content, node) {\n      return node.isBlock ? '\\n\\n' + content + '\\n\\n' : content\n    }\n  };\n  this.options = extend({}, defaults, options);\n  this.rules = new Rules(this.options);\n}\n\nTurndownService.prototype = {\n  /**\n   * The entry point for converting a string or DOM node to Markdown\n   * @public\n   * @param {String|HTMLElement} input The string or DOM node to convert\n   * @returns A Markdown representation of the input\n   * @type String\n   */\n\n  turndown: function (input) {\n    if (!canConvert(input)) {\n      throw new TypeError(\n        input + ' is not a string, or an element/document/fragment node.'\n      )\n    }\n\n    if (input === '') return ''\n\n    var output = process.call(this, new RootNode(input));\n    return postProcess.call(this, output)\n  },\n\n  /**\n   * Add one or more plugins\n   * @public\n   * @param {Function|Array} plugin The plugin or array of plugins to add\n   * @returns The Turndown instance for chaining\n   * @type Object\n   */\n\n  use: function (plugin) {\n    if (Array.isArray(plugin)) {\n      for (var i = 0; i < plugin.length; i++) this.use(plugin[i]);\n    } else if (typeof plugin === 'function') {\n      plugin(this);\n    } else {\n      throw new TypeError('plugin must be a Function or an Array of Functions')\n    }\n    return this\n  },\n\n  /**\n   * Adds a rule\n   * @public\n   * @param {String} key The unique key of the rule\n   * @param {Object} rule The rule\n   * @returns The Turndown instance for chaining\n   * @type Object\n   */\n\n  addRule: function (key, rule) {\n    this.rules.add(key, rule);\n    return this\n  },\n\n  /**\n   * Keep a node (as HTML) that matches the filter\n   * @public\n   * @param {String|Array|Function} filter The unique key of the rule\n   * @returns The Turndown instance for chaining\n   * @type Object\n   */\n\n  keep: function (filter) {\n    this.rules.keep(filter);\n    return this\n  },\n\n  /**\n   * Remove a node that matches the filter\n   * @public\n   * @param {String|Array|Function} filter The unique key of the rule\n   * @returns The Turndown instance for chaining\n   * @type Object\n   */\n\n  remove: function (filter) {\n    this.rules.remove(filter);\n    return this\n  },\n\n  /**\n   * Escapes Markdown syntax\n   * @public\n   * @param {String} string The string to escape\n   * @returns A string with Markdown syntax escaped\n   * @type String\n   */\n\n  escape: function (string) {\n    return escapes.reduce(function (accumulator, escape) {\n      return accumulator.replace(escape[0], escape[1])\n    }, string)\n  }\n};\n\n/**\n * Reduces a DOM node down to its Markdown string equivalent\n * @private\n * @param {HTMLElement} parentNode The node to convert\n * @returns A Markdown representation of the node\n * @type String\n */\n\nfunction process (parentNode) {\n  var self = this;\n  return reduce.call(parentNode.childNodes, function (output, node) {\n    node = new Node(node);\n\n    var replacement = '';\n    if (node.nodeType === 3) {\n      replacement = node.isCode ? node.nodeValue : self.escape(node.nodeValue);\n    } else if (node.nodeType === 1) {\n      replacement = replacementForNode.call(self, node);\n    }\n\n    return join(output, replacement)\n  }, '')\n}\n\n/**\n * Appends strings as each rule requires and trims the output\n * @private\n * @param {String} output The conversion output\n * @returns A trimmed version of the ouput\n * @type String\n */\n\nfunction postProcess (output) {\n  var self = this;\n  this.rules.forEach(function (rule) {\n    if (typeof rule.append === 'function') {\n      output = join(output, rule.append(self.options));\n    }\n  });\n\n  return output.replace(/^[\\t\\r\\n]+/, '').replace(/[\\t\\r\\n\\s]+$/, '')\n}\n\n/**\n * Converts an element node to its Markdown equivalent\n * @private\n * @param {HTMLElement} node The node to convert\n * @returns A Markdown representation of the node\n * @type String\n */\n\nfunction replacementForNode (node) {\n  var rule = this.rules.forNode(node);\n  var content = process.call(this, node);\n  var whitespace = node.flankingWhitespace;\n  if (whitespace.leading || whitespace.trailing) content = content.trim();\n  return (\n    whitespace.leading +\n    rule.replacement(content, node, this.options) +\n    whitespace.trailing\n  )\n}\n\n/**\n * Determines the new lines between the current output and the replacement\n * @private\n * @param {String} output The current conversion output\n * @param {String} replacement The string to append to the output\n * @returns The whitespace to separate the current output and the replacement\n * @type String\n */\n\nfunction separatingNewlines (output, replacement) {\n  var newlines = [\n    output.match(trailingNewLinesRegExp)[0],\n    replacement.match(leadingNewLinesRegExp)[0]\n  ].sort();\n  var maxNewlines = newlines[newlines.length - 1];\n  return maxNewlines.length < 2 ? maxNewlines : '\\n\\n'\n}\n\nfunction join (string1, string2) {\n  var separator = separatingNewlines(string1, string2);\n\n  // Remove trailing/leading newlines and replace with separator\n  string1 = string1.replace(trailingNewLinesRegExp, '');\n  string2 = string2.replace(leadingNewLinesRegExp, '');\n\n  return string1 + separator + string2\n}\n\n/**\n * Determines whether an input can be converted\n * @private\n * @param {String|HTMLElement} input Describe this parameter\n * @returns Describe what it returns\n * @type String|Object|Array|Boolean|Number\n */\n\nfunction canConvert (input) {\n  return (\n    input != null && (\n      typeof input === 'string' ||\n      (input.nodeType && (\n        input.nodeType === 1 || input.nodeType === 9 || input.nodeType === 11\n      ))\n    )\n  )\n}\n\n/* harmony default export */ __webpack_exports__[\"a\"] = (TurndownService);\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony export (immutable) */ __webpack_exports__[\"getDriver\"] = getDriver;\n/* harmony export (immutable) */ __webpack_exports__[\"getPublicAccounts\"] = getPublicAccounts;\n/* harmony export (immutable) */ __webpack_exports__[\"getMeta\"] = getMeta;\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__jianshu__ = __webpack_require__(3);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__zhihu__ = __webpack_require__(4);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__wordpress__ = __webpack_require__(5);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__toutiao__ = __webpack_require__(6);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__weibo__ = __webpack_require__(7);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__segmentfault__ = __webpack_require__(8);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__juejin__ = __webpack_require__(10);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__csdn__ = __webpack_require__(11);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__cnblog__ = __webpack_require__(12);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9__weixin__ = __webpack_require__(13);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_10__yidian__ = __webpack_require__(14);\n\n\n\n\n\n\n\n\n\n\n\n\nfunction getDriver(account) {\n  if (account.type == 'wordpress') {\n    return new __WEBPACK_IMPORTED_MODULE_2__wordpress__[\"a\" /* default */](\n      account.params.wpUrl,\n      account.params.wpUser,\n      account.params.wpPwd\n    )\n  }\n\n  if (account.type == 'zhihu') {\n    return new __WEBPACK_IMPORTED_MODULE_1__zhihu__[\"a\" /* default */]()\n  }\n\n  if (account.type == 'jianshu') {\n    return new __WEBPACK_IMPORTED_MODULE_0__jianshu__[\"a\" /* default */]()\n  }\n\n  if (account.type == 'typecho') {\n    return new __WEBPACK_IMPORTED_MODULE_2__wordpress__[\"a\" /* default */](\n      account.params.wpUrl,\n      account.params.wpUser,\n      account.params.wpPwd,\n      true\n    )\n  }\n\n  if (account.type == 'toutiao') {\n    return new __WEBPACK_IMPORTED_MODULE_3__toutiao__[\"a\" /* default */]()\n  }\n\n  if (account.type == 'weibo') {\n    return new __WEBPACK_IMPORTED_MODULE_4__weibo__[\"a\" /* default */]()\n  }\n\n  if (account.type == 'segmentfault') {\n    return new __WEBPACK_IMPORTED_MODULE_5__segmentfault__[\"a\" /* default */](account)\n  }\n\n  if (account.type == 'juejin') {\n    return new __WEBPACK_IMPORTED_MODULE_6__juejin__[\"a\" /* default */](account)\n  }\n\n  if (account.type == 'csdn') {\n    return new __WEBPACK_IMPORTED_MODULE_7__csdn__[\"a\" /* default */](account)\n  }\n\n  if (account.type == 'cnblog') {\n    return new __WEBPACK_IMPORTED_MODULE_8__cnblog__[\"a\" /* default */](account)\n  }\n  if (account.type == 'weixin') {\n    return new __WEBPACK_IMPORTED_MODULE_9__weixin__[\"a\" /* default */](account)\n  }\n\n  if (account.type == 'yidian') {\n    return new __WEBPACK_IMPORTED_MODULE_10__yidian__[\"a\" /* default */](account)\n  }\n\n  throw Error('not supprt account type')\n}\n\nasync function getPublicAccounts() {\n  console.log('getPublicAccounts')\n  var drivers = [\n    new __WEBPACK_IMPORTED_MODULE_5__segmentfault__[\"a\" /* default */](),\n    new __WEBPACK_IMPORTED_MODULE_7__csdn__[\"a\" /* default */](),\n    new __WEBPACK_IMPORTED_MODULE_6__juejin__[\"a\" /* default */](),\n    new __WEBPACK_IMPORTED_MODULE_8__cnblog__[\"a\" /* default */](),\n    new __WEBPACK_IMPORTED_MODULE_4__weibo__[\"a\" /* default */](),\n    new __WEBPACK_IMPORTED_MODULE_1__zhihu__[\"a\" /* default */](),\n    new __WEBPACK_IMPORTED_MODULE_0__jianshu__[\"a\" /* default */](),\n    new __WEBPACK_IMPORTED_MODULE_3__toutiao__[\"a\" /* default */](),\n    new __WEBPACK_IMPORTED_MODULE_9__weixin__[\"a\" /* default */](),\n    new __WEBPACK_IMPORTED_MODULE_10__yidian__[\"a\" /* default */](),\n  ]\n  var users = []\n  for (let index = 0; index < drivers.length; index++) {\n    const driver = drivers[index]\n    try {\n      var user = await driver.getMetaData()\n      users.push(user)\n    } catch (e) {\n      console.log(e)\n    }\n  }\n  return users\n}\n\nfunction getMeta() {\n  return {\n    version: '0.0.7',\n    versionNumber: 7,\n    log: '',\n  }\n}\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nvar NoteVersionCaches = {}\nvar defaultNoteBookId\n\nclass JianShuDriver {\n  constructor() {\n    this.name = 'jianshu'\n    // chrome.cookies.getAll({ domain: \"zhihu.com\"},  function(cookies){\n    //     console.log(cookies)\n    // })\n  }\n\n  async getMetaData() {\n    var res = await $.ajax({\n      url: 'https://www.jianshu.com/settings/basic.json',\n    })\n    var notebooks = await $.get('https://www.jianshu.com/author/notebooks')\n    // console.log(res);\n    // https://upload.jianshu.io/users/upload_avatars/12192974/d02c5033-7f82-458f-9b3e-f4c4dbaa1221?imageMogr2/auto-orient/strip|imageView2/1/w/96/h/96\n    return {\n      uid: res.data.avatar.split('/')[5],\n      title: res.data.nickname,\n      avatar: res.data.avatar,\n      type: 'jianshu',\n      displayName: '简书',\n      supportTypes: ['html'],\n      home: 'https://www.jianshu.com/settings/basic',\n      icon: 'https://www.jianshu.com/favicon.ico',\n      notebooks: notebooks,\n    }\n  }\n\n  async addPost(post) {\n    var notebooks = await $.get('https://www.jianshu.com/author/notebooks')\n    var firstNoteBook = notebooks[0]\n    defaultNoteBookId = firstNoteBook.id\n    var res = await $.ajax({\n      url: 'https://www.jianshu.com/author/notes',\n      type: 'POST',\n      dataType: 'JSON',\n      headers: {\n        accept: 'application/json',\n      },\n      contentType: 'application/json',\n      data: JSON.stringify({\n        at_bottom: false,\n        notebook_id: firstNoteBook.id,\n        title: post.post_title,\n      }),\n    })\n    console.log(res)\n    return {\n      status: 'success',\n      post_id: res.id,\n      notebook_id: firstNoteBook.id,\n    }\n  }\n\n  async editPost(post_id, post) {\n    var cacheVerions = NoteVersionCaches[post_id]\n    var notebook_id = post.notebook_id ? post.notebook_id : defaultNoteBookId\n\n    if (!cacheVerions) {\n      var bookNotes = await $.get(\n        'https://www.jianshu.com/author/notebooks/' + notebook_id + '/notes'\n      )\n      var currentNote = bookNotes.filter((t) => {\n        return t.id == post_id\n      })[0]\n\n      console.log(post_id, bookNotes)\n      NoteVersionCaches[post_id] = currentNote.autosave_control\n      NoteVersionCaches[post_id]++\n      cacheVerions = NoteVersionCaches[post_id]\n    } else {\n      NoteVersionCaches[post_id]++\n      cacheVerions = NoteVersionCaches[post_id]\n    }\n\n    console.log('currentNote', cacheVerions)\n    var requestData = {\n      autosave_control: cacheVerions,\n    }\n\n    if (post.post_content) {\n      requestData.content = post.post_content\n    }\n\n    if (post_id) {\n      requestData.id = post_id\n    }\n\n    if (post.post_title) {\n      requestData.title = post.post_title\n    }\n\n    // https://www.jianshu.com/author/notebooks/108908/notes\n    var res = await $.ajax({\n      url: 'https://www.jianshu.com/author/notes/' + post_id,\n      type: 'PUT',\n      dataType: 'JSON',\n      contentType: 'application/json',\n      headers: {\n        accept: 'application/json',\n      },\n      data: JSON.stringify(requestData),\n    })\n\n    return {\n      status: 'success',\n      notebook_id: notebook_id,\n      post_id: post_id,\n      draftLink:\n        'https://www.jianshu.com/writer#/notebooks/' +\n        notebook_id +\n        '/notes/' +\n        post_id,\n    }\n  }\n\n  async uploadFile(file) {\n    var src = file.src\n    try {\n      // jianshu not support webp\n      if (src.indexOf('xitu.io') > -1) {\n        src = src.replace('webp', 'png')\n      }\n\n      var res = await $.ajax({\n        url: 'https://www.jianshu.com/upload_images/fetch',\n        type: 'POST',\n        contentType: 'application/json',\n        xhrFields: {\n          withCredentials: true,\n        },\n        headers: {\n          accept: 'application/json',\n        },\n        data: JSON.stringify({\n          url: src,\n        }),\n      })\n\n      // http only\n      console.log('uploadFile', res)\n      return [res]\n    } catch (e) {\n      console.log('JianShuDriver.uploadFile', e)\n      var error = e.responseJSON.error[0].message\n      throw new Error(error)\n    }\n  }\n\n  async preEditPost(post) {\n    var div = $('<div>')\n    $('body').append(div)\n    div.html(post.content)\n    var doc = div\n    var processEmptyLine = function (idx, el) {\n      var $obj = $(this)\n      var originalText = $obj.text()\n      var img = $obj.find('img')\n      var brs = $obj.find('br')\n      if (originalText == '') {\n        ;(function () {\n          if (img.length) return\n          if (!brs.length) return\n          $obj.remove()\n        })()\n      }\n\n      // try to replace as h2;\n      var strongTag = $obj.find('strong').eq(0)\n      var childStrongText = strongTag.text()\n      if (originalText == childStrongText) {\n        var strongSize = null\n        var tagStart = strongTag\n        var align = null\n        for (let index = 0; index < 4; index++) {\n          var fontSize = tagStart.css('font-size')\n          var textAlign = tagStart.css('text-align')\n          if (fontSize) {\n            strongSize = fontSize\n          }\n          if (textAlign) {\n            align = textAlign\n          }\n          if (align && strongSize) break\n          if (tagStart == $obj) {\n            console.log('near top')\n            break\n          }\n          tagStart = tagStart.parent()\n        }\n        if (strongSize) {\n          var theFontSize = parseInt(strongSize)\n          if (theFontSize > 17 && align == 'center') {\n            var newTag = $('<h2></h2>').append($obj.html())\n            $obj.after(newTag).remove()\n          }\n        }\n      }\n    }\n\n    // remove empty break line\n    doc.find('p').each(processEmptyLine)\n    doc.find('section').each(processEmptyLine)\n\n    var processBr = function (idx, el) {\n      var $obj = $(this)\n      if (!$obj.next().length) {\n        $obj.remove()\n      }\n    }\n    doc.find('br').each(processBr)\n    // table {\n    //     margin-bottom: 10px;\n    //     border-collapse: collapse;\n    //     display: table;\n    //     width: 100%!important;\n    // }\n    // td, th {\n    //     word-wrap: break-word;\n    //     word-break: break-all;\n    //     padding: 5px 10px;\n    //     border: 1px solid #DDD;\n    // }\n\n    // console.log('found table', doc.find('table'))\n    var tempDoc = $('<div>').append(doc.clone())\n    post.content =\n      tempDoc.children('div').length == 1\n        ? tempDoc.children('div').html()\n        : tempDoc.html()\n    // div.remove();\n  }\n}\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = JianShuDriver;\n\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nfunction escapeHtml(text) {\n  return text\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;')\n}\n\nfunction getChildren(obj, count) {\n  count++\n  if (count > 4) return null\n  if (obj.children().length > 1) return obj\n  return getChildren(obj.children().eq(0), count)\n}\n\nfunction CodeBlockToPlainTextOther(pre) {\n  var text = []\n  var minSub = getChildren(pre, 0)\n  var lines = minSub.children()\n  for (let index = 0; index < lines.length; index++) {\n    const element = lines.eq(index)\n    const codeStr = element.text()\n    text.push('<code>' + escapeHtml(codeStr) + '</code>')\n  }\n  return text.join('\\n')\n}\n\nfunction CodeBlockToPlainText(pre) {\n  var text = []\n  var minSub = getChildren(pre, 0)\n  var lines = pre.find('code')\n  if (lines.length > 1) {\n    return CodeBlockToPlainTextOther(pre)\n  }\n\n  for (let index = 0; index < lines.length; index++) {\n    const element = lines.eq(index)\n    const codeStr = element[0].innerText\n    console.log('codeStr', codeStr)\n    var codeLines = codeStr.split('\\n')\n    codeLines.forEach((codeLine) => {\n      text.push('<code>' + escapeHtml(codeLine) + '</code>')\n    })\n  }\n  return text.join('\\n')\n}\n\nclass ZhiHuDriver {\n  constructor() {\n    // this.skipReadImage = true\n    this.version = '0.0.1'\n    this.name = 'zhihu'\n  }\n\n  async getMetaData() {\n    var res = await $.ajax({\n      url:\n        'https://www.zhihu.com/api/v4/me?include=account_status%2Cis_bind_phone%2Cis_force_renamed%2Cemail%2Crenamed_fullname',\n    })\n    // console.log(res);\n    return {\n      uid: res.uid,\n      title: res.name,\n      avatar: res.avatar_url,\n      supportTypes: ['html'],\n      type: 'zhihu',\n      displayName: '知乎',\n      home: 'https://www.zhihu.com/settings/account',\n      icon: 'https://static.zhihu.com/static/favicon.ico',\n    }\n  }\n\n  async addPost(post) {\n    var res = await $.ajax({\n      url: 'https://zhuanlan.zhihu.com/api/articles/drafts',\n      type: 'POST',\n      dataType: 'JSON',\n      contentType: 'application/json',\n      data: JSON.stringify({\n        title: post.post_title,\n        // content: post.post_content\n      }),\n    })\n    console.log(res)\n    return {\n      status: 'success',\n      post_id: res.id,\n    }\n    //\n  }\n\n  async editPost(post_id, post) {\n    console.log('editPost', post.post_thumbnail)\n    var res = await $.ajax({\n      url: 'https://zhuanlan.zhihu.com/api/articles/' + post_id + '/draft',\n      type: 'PATCH',\n      contentType: 'application/json',\n      data: JSON.stringify({\n        title: post.post_title,\n        content: post.post_content,\n        isTitleImageFullScreen: false,\n        titleImage: 'https://pic1.zhimg.com/' + post.post_thumbnail + '.png',\n      }),\n    })\n\n    return {\n      status: 'success',\n      post_id: post_id,\n      draftLink: 'https://zhuanlan.zhihu.com/p/' + post_id + '/edit',\n    }\n    // https://zhuanlan.zhihu.com/api/articles/68769713/draft\n  }\n\n  untiImageDone(image_id) {\n    return new Promise(function(resolve, reject) {\n      function waitToNext() {\n        console.log('untiImageDone', image_id);\n        (async () => {\n          var imgDetail = await $.ajax({\n            url: 'https://api.zhihu.com/images/' + image_id,\n            type: 'GET',\n          })\n          console.log('imgDetail', imgDetail)\n          if (imgDetail.status != 'processing') {\n            console.log('all done')\n            resolve(imgDetail)\n          } else {\n            console.log('go next', waitToNext)\n            setTimeout(waitToNext, 300)\n          }\n        })()\n      }\n      waitToNext()\n    })\n  }\n\n  async _uploadFile(file) {\n    var src = file.src\n    var res = await $.ajax({\n      url: 'https://zhuanlan.zhihu.com/api/uploaded_images',\n      type: 'POST',\n      headers: {\n        accept: '*/*',\n        'x-requested-with': 'fetch',\n      },\n      data: {\n        url: src,\n        source: 'article',\n      },\n    })\n\n    return [\n      {\n        id: res.hash,\n        object_key: res.hash,\n        url: res.src,\n      },\n    ]\n  }\n\n  async uploadFile(file) {\n    console.log('ZhiHuDriver.uploadFile', file, md5)\n    var updateData = JSON.stringify({\n      image_hash: md5(file.bits),\n      source: 'article',\n    })\n    console.log('upload', updateData)\n    var fileResp = await $.ajax({\n      url: 'https://api.zhihu.com/images',\n      type: 'POST',\n      dataType: 'JSON',\n      contentType: 'application/json',\n      data: updateData,\n    })\n\n    console.log('upload', fileResp)\n\n    var upload_file = fileResp.upload_file\n    if (fileResp.upload_file.state == 1) {\n      var imgDetail = await this.untiImageDone(upload_file.image_id)\n      console.log('imgDetail', imgDetail)\n      upload_file.object_key = imgDetail.original_hash\n    } else {\n      var token = fileResp.upload_token\n      let client = new OSS({\n        endpoint: 'https://zhihu-pics-upload.zhimg.com',\n        accessKeyId: token.access_id,\n        accessKeySecret: token.access_key,\n        stsToken: token.access_token,\n        cname: true,\n        bucket: 'zhihu-pics',\n      })\n      var finalUrl = await client.put(\n        upload_file.object_key,\n        new Blob([file.bits])\n      )\n      console.log(client, finalUrl)\n    }\n    console.log(file, fileResp)\n    return [\n      {\n        id: upload_file.object_key,\n        object_key: upload_file.object_key,\n        url: 'https://pic4.zhimg.com/' + upload_file.object_key,\n        // url: 'https://pic1.zhimg.com/80/' + upload_file.object_key + '_hd.png',\n      },\n    ]\n  }\n\n  async preEditPost(post) {\n    var div = $('<div>')\n    $('body').append(div)\n\n    // post.content = post.content.replace(/\\>\\s+\\</g,'');\n    div.html(post.content)\n\n    // var org = $(post.content);\n    // var doc = $('<div>').append(org.clone());\n    var doc = div\n    var pres = doc.find('pre')\n    console.log('find code blocks', pres.length, post)\n    for (let mindex = 0; mindex < pres.length; mindex++) {\n      const pre = pres.eq(mindex)\n      try {\n        var newHtml = CodeBlockToPlainText(pre, 0)\n        if (newHtml) {\n          console.log(newHtml)\n          pre.html(newHtml)\n        }\n      } catch (e) {}\n    }\n\n    var processEmptyLine = function (idx, el) {\n      var $obj = $(this)\n      var originalText = $obj.text()\n      var img = $obj.find('img')\n      var brs = $obj.find('br')\n      if (originalText == '') {\n        ;(function () {\n          if (img.length) return\n          if (!brs.length) return\n          $obj.remove()\n        })()\n      }\n\n      // try to replace as h2;\n      var strongTag = $obj.find('strong').eq(0)\n      var childStrongText = strongTag.text()\n      if (originalText == childStrongText) {\n        var strongSize = null\n        var tagStart = strongTag\n        var align = null\n        for (let index = 0; index < 4; index++) {\n          var fontSize = tagStart.css('font-size')\n          var textAlign = tagStart.css('text-align')\n          if (fontSize) {\n            strongSize = fontSize\n          }\n          if (textAlign) {\n            align = textAlign\n          }\n          if (align && strongSize) break\n          if (tagStart == $obj) {\n            console.log('near top')\n            break\n          }\n          tagStart = tagStart.parent()\n        }\n        if (strongSize) {\n          var theFontSize = parseInt(strongSize)\n          if (theFontSize > 17 && align == 'center') {\n            var newTag = $('<h2></h2>').append($obj.html())\n            $obj.after(newTag).remove()\n          }\n        }\n      }\n    }\n\n    // remove empty break line\n    doc.find('p').each(processEmptyLine)\n    doc.find('section').each(processEmptyLine)\n\n    var processBr = function (idx, el) {\n      var $obj = $(this)\n      if (!$obj.next().length) {\n        $obj.remove()\n      }\n    }\n    doc.find('br').each(processBr)\n    // table {\n    //     margin-bottom: 10px;\n    //     border-collapse: collapse;\n    //     display: table;\n    //     width: 100%!important;\n    // }\n    // td, th {\n    //     word-wrap: break-word;\n    //     word-break: break-all;\n    //     padding: 5px 10px;\n    //     border: 1px solid #DDD;\n    // }\n\n    // console.log('found table', doc.find('table'))\n    var tempDoc = $('<div>').append(doc.clone())\n    post.content =\n      tempDoc.children('div').length == 1\n        ? tempDoc.children('div').html()\n        : tempDoc.html()\n    // div.remove();\n  }\n}\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = ZhiHuDriver;\n\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nfunction xmlrpcWrapper(conf) {\n  return new Promise((resolve, reject) => {\n    $.xmlrpc(conf).then(\n      function (response, status, xhr) {\n        resolve({\n          response,\n          status,\n          xhr,\n        })\n      },\n      function (jqXHR, status, error) {\n        reject({\n          jqXHR,\n          status,\n          error,\n        })\n      }\n    )\n  })\n}\n\nclass WordpressDriver {\n  constructor(url, user, pwd, isTypecho) {\n    this.url = url\n    this.user = user\n    this.pwd = pwd\n    this.isTypecho = isTypecho\n  }\n\n  getRPC() {\n    var endPoint = this.url + '/xmlrpc.php'\n    if (this.isTypecho) {\n      endPoint = this.url + '/action/xmlrpc'\n    }\n    return endPoint\n  }\n\n  async getMetaData() {\n    var params = [this.user, this.pwd]\n    var res = await xmlrpcWrapper({\n      url: this.getRPC(),\n      methodName: 'wp.getUsersBlogs',\n      params: params,\n    })\n    res.icon = chrome.extension.getURL('images/wordpress.ico')\n    return res\n  }\n\n  addPost(post) {\n    if (this.isTypecho) {\n      return {\n        status: 'success',\n        post_id: '1',\n      }\n    }\n\n    var params = [0, this.user, this.pwd, post]\n    var end = this.url\n    return xmlrpcWrapper({\n      url: this.getRPC(),\n      methodName: 'wp.newPost',\n      params: params,\n    })\n  }\n\n  editPost(post_id, post) {\n    var params = [0, this.user, this.pwd, post]\n    var endpoint = this.getRPC()\n    var isTypecho = this.isTypecho\n    if (isTypecho) {\n      params.push(false)\n      params[3] = {\n        title: post['post_title'],\n        // text: \"!!!\\n\" + post['post_content'].trim() + \"\\n!!!\",\n        description: post['post_content'].trim(),\n        // markdown: 1\n      }\n      console.log('params', params)\n    } else {\n      params[3] = post_id\n      params.push(post)\n    }\n    return new Promise((resolve, reject) => {\n      ;(async () => {\n        try {\n          var res = await xmlrpcWrapper({\n            url: endpoint,\n            methodName: isTypecho ? 'metaWeblog.newPost' : 'wp.editPost',\n            params: params,\n          })\n\n          res.draftLink = this.url + '?p=' + post_id\n          console.log('Wordpress', res)\n          resolve(res)\n        } catch (e) {\n          reject(e)\n        }\n      })()\n    })\n  }\n\n  //  'metaWeblog.getPost' => array($this, 'mwGetPost'),\n\n  uploadFile(file) {\n    if (this.isTypecho) {\n      file['bytes'] = file['bits']\n      delete file['bits']\n    }\n    var params = [0, this.user, this.pwd, file]\n\n    var end = this.url\n    return $.xmlrpc({\n      url: this.getRPC(),\n      methodName: 'wp.uploadFile',\n      params: params,\n    })\n  }\n}\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = WordpressDriver;\n\n\nwindow.WordpressDriver = WordpressDriver\n\n\n/***/ }),\n/* 6 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nclass ToutiaoDriver {\n  constructor() {\n    this.skipReadImage = true\n    this.name = 'toutiao'\n  }\n\n  async getMetaData() {\n    var res = await $.ajax({\n      url: 'https://mp.toutiao.com/get_media_info/',\n    })\n    // console.log(res);\n    return {\n      uid: res.data.user.id,\n      title: res.data.user.screen_name,\n      avatar: res.data.user.https_avatar_url,\n      supportTypes: ['html'],\n      type: 'toutiao',\n      displayName: '头条',\n      home: 'https://mp.toutiao.com/profile_v3/graphic/publish',\n      icon: 'https://sf1-ttcdn-tos.pstatp.com/obj/ttfe/pgcfe/sz/mp_logo.png',\n    }\n  }\n\n  async addPost(post) {\n    return {\n      status: 'success',\n      post_id: 0,\n    }\n  }\n\n  async editPost(post_id, post) {\n    var pgc_feed_covers = []\n    if (post.post_thumbnail_raw && post.post_thumbnail_raw.images) {\n      pgc_feed_covers.push({\n        id: 0,\n        url: post.post_thumbnail_raw.url,\n        uri: post.post_thumbnail_raw.images[0].origin_web_uri,\n        origin_uri: post.post_thumbnail_raw.images[0].origin_web_uri,\n        ic_uri: '',\n        thumb_width: post.post_thumbnail_raw.images[0].width,\n        thumb_height: post.post_thumbnail_raw.images[0].height,\n      })\n    }\n\n    await $.get('https://mp.toutiao.com/profile_v3/graphic/publish')\n\n    var res = await $.ajax({\n      url:\n        'https://mp.toutiao.com/core/article/edit_article_post/?source=mp&type=article',\n      type: 'POST',\n      dataType: 'JSON',\n      data: {\n        title: post.post_title,\n        article_ad_type: 3,\n        article_type: 0,\n        from_diagnosis: 0,\n        origin_debut_check_pgc_normal: 0,\n        tree_plan_article: 0,\n        save: 0,\n        pgc_id: 0,\n        content: post.post_content,\n        pgc_feed_covers: JSON.stringify(pgc_feed_covers),\n      },\n    })\n\n    if (!res.data) {\n      throw new Error(res.message)\n    }\n\n    return {\n      status: 'success',\n      post_id: res.data.pgc_id,\n      draftLink:\n        'https://mp.toutiao.com/profile_v3/graphic/publish?pgc_id=' +\n        res.data.pgc_id,\n    }\n  }\n\n  async uploadFile(file) {\n    var src = file.src\n    var res = await $.ajax({\n      url: 'https://mp.toutiao.com/tools/catch_picture/',\n      type: 'POST',\n      headers: {\n        accept: '*/*',\n      },\n      data: {\n        upfile: src,\n        version: 2,\n      },\n    })\n\n    // throw new Error('fuck');\n\n    if (res.images && !res.images.length) {\n      throw new Error('图片上传失败 ' + src)\n    }\n\n    // http only\n    console.log('uploadFile', res)\n    return [res]\n  }\n\n  async preEditPost(post) {\n    var div = $('<div>')\n    $('body').append(div)\n\n    div.html(post.content)\n\n    // var org = $(post.content);\n    // var doc = $('<div>').append(org.clone());\n\n    var doc = div\n    var pres = doc.find('a')\n    for (let mindex = 0; mindex < pres.length; mindex++) {\n      const pre = pres.eq(mindex)\n      try {\n        pre.after(pre.html()).remove()\n      } catch (e) {}\n    }\n\n    var pres = doc.find('iframe')\n    for (let mindex = 0; mindex < pres.length; mindex++) {\n      const pre = pres.eq(mindex)\n      try {\n        pre.remove()\n      } catch (e) {}\n    }\n\n    try {\n      const images = doc.find('img')\n      for (let index = 0; index < images.length; index++) {\n        const image = images.eq(index)\n        const imgSrc = image.attr('src')\n        if (imgSrc && imgSrc.indexOf('.svg') > -1) {\n          console.log('remove svg Image')\n          image.remove()\n        }\n      }\n      const qqm = doc.find('qqmusic')\n      qqm.next().remove()\n      qqm.remove()\n    } catch (e) {}\n\n    post.content = $('<div>').append(doc.clone()).html()\n    console.log('post', post)\n  }\n\n  editImg(img, source) {\n    img.attr('web_uri', source.images[0].origin_web_uri)\n  }\n  //   <img class=\"\" src=\"http://p2.pstatp.com/large/pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" data-ic=\"false\" data-ic-uri=\"\" data-height=\"1333\" data-width=\"1000\" image_type=\"1\" web_uri=\"pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" img_width=\"1000\" img_height=\"1333\"></img>\n}\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = ToutiaoDriver;\n\n\n\n/***/ }),\n/* 7 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nvar cacheWeiboUser = null\n// var Readability = require(\"../reader/Readability\");\n\n// fetch(\"https://card.weibo.com/article/v3/aj/editor/draft/save?uid=1820387812&id=402\", { \"credentials\": \"include\", \"headers\": { \"accept\": \"application/json, text/plain, */*\", \"accept-language\": \"zh-CN,zh;q=0.9\", \"content-type\": \"application/x-www-form-urlencoded\" }, \"referrer\": \"https://card.weibo.com/article/v3/editor\", \"referrerPolicy\": \"no-referrer-when-downgrade\", \"body\": \"id=402&title=aaaaaaaaaaa&updated=2019-10-10%2016%3A06%3A43&subtitle=&type=&status=0&publish_at=&error_msg=&error_code=0&collection=%5B%5D&free_content=&content=%3Cp%20align%3D%22justify%22%3Eaaaaaaaaaaaaa%3C%2Fp%3E&cover=https%3A%2F%2Fwx3.sinaimg.cn%2Flarge%2F6c80e9e4ly1g7t62jq7uzj202s01kdfz.jpg&summary=aaa&writer=&extra=null&is_word=0&article_recommend=%5B%5D&follow_to_read=1&isreward=1&pay_setting=%7B%22ispay%22%3A0%2C%22isvclub%22%3A0%7D&source=0&action=1&save=1\", \"method\": \"POST\", \"mode\": \"cors\" });\n\nclass WeiboDriver {\n  constructor() {\n    this.name = 'weibo'\n  }\n\n  async getMetaData() {\n    var html = await $.get('https://card.weibo.com/article/v3/editor')\n    var configIndx = html.indexOf('$CONFIG')\n    var lastIndex = html.indexOf('</script>', configIndx)\n    var configStr = html.substring(configIndx - 12, lastIndex)\n\n    if (configStr.indexOf('CONFIG') > -1) {\n      var res = new Function(configStr + ' return $CONFIG;')()\n      cacheWeiboUser = res\n      return {\n        uid: res.uid,\n        title: res.nick,\n        avatar: res.avatar_large,\n        supportTypes: ['html'],\n        displayName: '微博',\n        type: 'weibo',\n        home: 'https://card.weibo.com/article/v3/editor',\n        icon: 'https://weibo.com/favicon.ico',\n      }\n    } else {\n      throw new Error('not found')\n    }\n  }\n\n  async addPost(post) {\n    var res = await $.post(\n      'https://card.weibo.com/article/v3/aj/editor/draft/create?uid=' +\n        cacheWeiboUser.uid\n    )\n    if (res.code != 100000) {\n      throw new Error(res.msg)\n      return\n    }\n\n    console.log(res)\n    var post_id = res.data.id\n\n    var res = await $.ajax({\n      url:\n        'https://card.weibo.com/article/v3/aj/editor/draft/save?uid=' +\n        cacheWeiboUser.uid +\n        '&id=' +\n        post_id,\n      type: 'POST',\n      dataType: 'JSON',\n      headers: {\n        accept: 'application/json',\n      },\n      data: {\n        id: post_id,\n        title: post.post_title,\n        subtitle: '',\n        type: '',\n        status: '0',\n        publish_at: '',\n        error_msg: '',\n        error_code: '0',\n        collection: '[]',\n        free_content: '',\n        content: post.post_content,\n        cover: '',\n        summary: '',\n        writer: '',\n        extra: 'null',\n        is_word: '0',\n        article_recommend: '[]',\n        follow_to_read: '1',\n        isreward: '1',\n        pay_setting: '{\"ispay\":0,\"isvclub\":0}',\n        source: '0',\n        action: '1',\n        content_type: '0',\n        save: '1',\n      },\n      // data: {\n      //   id: post_id,\n      //   title: post.post_title,\n      //   status: 0,\n      //   error_code: 0,\n      //   content: post.post_content,\n      //   cover: \"\",\n      //   // summary: 'aaaab',\n      //   writer: \"\",\n      //   is_word: 0,\n      //   article_recommend: [],\n      //   follow_to_read: 1,\n      //   isreward: 1,\n      //   pay_setting: JSON.stringify({ ispay: 0, isvclub: 0 }),\n      //   source: 0,\n      //   action: 1,\n      //   save: 1\n      // }\n    })\n    console.log(res)\n    return {\n      status: 'success',\n      post_id: post_id,\n    }\n  }\n\n  async preEditPost(post) {\n    // var div = $('<div>');\n    // $('body').append(div);\n    // div.html(post.content);\n\n    // // var doc = div;\n    // // doc.clone()\n    // var documentClone = document.cloneNode(true);\n    // var article = new Readability(documentClone).parse();\n\n    // div.remove();\n    // console.log(article);\n    var rexp = new RegExp('>[\\ts ]*<', 'g')\n    var result = post.content.replace(rexp, '><')\n    post.content = result\n  }\n\n  async editPost(post_id, post) {\n    var res = await $.ajax({\n      url:\n        'https://card.weibo.com/article/v3/aj/editor/draft/save?uid=' +\n        cacheWeiboUser.uid +\n        '&id=' +\n        post_id,\n      type: 'POST',\n      dataType: 'JSON',\n      headers: {\n        accept: 'application/json',\n      },\n      data: {\n        id: post_id,\n        title: post.post_title,\n        subtitle: '',\n        type: '',\n        status: '0',\n        publish_at: '',\n        error_msg: '',\n        error_code: '0',\n        collection: '[]',\n        free_content: '',\n        content: post.post_content,\n        cover: post.post_thumbnail_raw ? post.post_thumbnail_raw.url : '',\n        summary: '',\n        writer: '',\n        extra: 'null',\n        is_word: '0',\n        article_recommend: '[]',\n        follow_to_read: '1',\n        isreward: '1',\n        pay_setting: '{\"ispay\":0,\"isvclub\":0}',\n        source: '0',\n        action: '1',\n        content_type: '0',\n        save: '1',\n      },\n      // data: {\n      //   id: post_id,\n      //   title: post.post_title,\n      //   status: 0,\n      //   error_code: 0,\n      //   content: post.post_content,\n      //   cover: post.post_thumbnail_raw ? post.post_thumbnail_raw.url : \"\",\n      //   // summary: 'aaaab',\n      //   writer: \"\",\n      //   is_word: 0,\n      //   article_recommend: [],\n      //   follow_to_read: 1,\n      //   isreward: 1,\n      //   pay_setting: JSON.stringify({ ispay: 0, isvclub: 0 }),\n      //   source: 0,\n      //   action: 1,\n      //   save: 1\n      // }\n    })\n    console.log(res)\n    return {\n      status: 'success',\n      post_id: post_id,\n      draftLink: 'https://card.weibo.com/article/v3/editor#/draft/' + post_id,\n    }\n  }\n\n  untiImageDone(src) {\n    return new Promise((resolve, reject) => {\n      ;(async function loop() {\n        var res = await $.ajax({\n          url:\n            'https://card.weibo.com/article/v3/aj/editor/plugins/asyncimginfo?uid=' +\n            cacheWeiboUser.uid,\n          type: 'POST',\n          headers: {\n            accept: '*/*',\n            'x-requested-with': 'fetch',\n          },\n          data: {\n            'urls[0]': src,\n          },\n        })\n\n        var done = res.data[0].task_status_code == 1\n        if (done) {\n          resolve(res.data[0])\n        } else {\n          setTimeout(loop, 1000)\n        }\n      })()\n    })\n  }\n\n  async uploadFile(file) {\n    var src = file.src\n    var res = await $.ajax({\n      url:\n        'https://card.weibo.com/article/v3/aj/editor/plugins/asyncuploadimg?uid=' +\n        cacheWeiboUser.uid,\n      type: 'POST',\n      headers: {\n        accept: '*/*',\n        'x-requested-with': 'fetch',\n      },\n      data: {\n        'urls[0]': src,\n      },\n    })\n\n    // https://card.weibo.com/article/v3/aj/editor/plugins/asyncuploadimg?uid=1820387812\n    var imgDetail = await this.untiImageDone(src)\n    return [\n      {\n        id: imgDetail.pid,\n        object_key: imgDetail.pid,\n        url: imgDetail.url,\n      },\n    ]\n  }\n\n  async uploadFileOld(file) {\n    var blob = new Blob([file.bits])\n    console.log('uploadFile', file, blob)\n    var fileResp = await $.ajax({\n      url:\n        'https://picupload.weibo.com/interface/pic_upload.php?app=miniblog&s=json&p=1&data=1&url=&markpos=1&logo=0&nick=',\n      type: 'POST',\n      processData: false,\n      data: new Blob([file.bits]),\n    })\n\n    console.log(file, fileResp)\n    return [\n      {\n        id: fileResp.data.pics.pic_1.pid,\n        object_key: fileResp.data.pics.pic_1.pid,\n        url:\n          'https://wx3.sinaimg.cn/large/' +\n          fileResp.data.pics.pic_1.pid +\n          '.jpg',\n      },\n    ]\n  }\n}\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = WeiboDriver;\n\n\n\n/***/ }),\n/* 8 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_turndown__ = __webpack_require__(1);\nconst { processDocCode, makeImgVisible } = __webpack_require__(0)\n\n\nvar segIframe = null\nvar abb = {}\n\nwindow.onmessage = (e) => {\n  var action = JSON.parse(e.data)\n  if (action.eventId && abb[action.eventId]) {\n    abb[action.eventId](action.err, action.data)\n  }\n}\n\nfunction requestFrameMethod(d) {\n  return new Promise((resolve, reject) => {\n    var evtId = Date.now() + Math.random()\n    d.eventId = evtId\n    abb[evtId] = function (err, data) {\n      if (err) {\n        reject(err)\n      } else {\n        resolve(data)\n      }\n    }\n\n    segIframe.contentWindow.postMessage(JSON.stringify(d), '*')\n  })\n}\n\nclass Segmentfault {\n  constructor() {\n    this.name = 'segmentfault'\n  }\n\n  async getMetaData() {\n    var res = await $.get('https://segmentfault.com/user/settings')\n    var parser = new DOMParser()\n    var htmlDoc = parser.parseFromString(res, 'text/html')\n    var link = htmlDoc.getElementsByClassName('user-avatar')[0]\n    if (!link) {\n      throw Error('not found')\n    }\n\n    var uid = link.href.split('/').pop()\n    var avatar = link.style['background-image']\n      .replace('url(\"', '')\n      .replace('\")', '')\n    console.log(\n      link.href,\n      link.style['background-image'].replace('url(\"', '').replace('\")', '')\n    )\n\n    if (!segIframe) {\n      segIframe = document.createElement('iframe')\n      segIframe.src = 'https://segmentfault.com/write?freshman=1'\n      document.body.append(segIframe)\n    }\n\n    return {\n      uid: uid,\n      title: uid,\n      avatar: avatar,\n      type: 'segmentfault',\n      displayName: 'Segmentfault',\n      supportTypes: ['markdown', 'html'],\n      home: 'https://segmentfault.com/user/draft',\n      icon:\n        'https://assets.segmentfault.com/v-5f7db51e/global/img/static/touch-icon.png',\n    }\n  }\n\n  async addPost(post) {\n    console.log('addPost', segIframe)\n\n    var turndownService = new __WEBPACK_IMPORTED_MODULE_0_turndown__[\"a\" /* default */]()\n    turndownService.addRule('codefor', {\n      filter: ['pre'],\n      replacement: function (content) {\n        // content = content.replace(new RegExp(\"` \", \"g\"), \"\\n\");\n        // content = content.replace(new RegExp(\"`\", \"g\"), \"\");\n        return ['```', content, '```'].join('\\n')\n      },\n    })\n\n    var markdown = turndownService.turndown(post.post_content)\n    post.markdown = markdown\n    console.log(markdown)\n\n    var data = await requestFrameMethod({\n      type: 'sendPost',\n      data: {\n        type: 1,\n        url: '',\n        blogId: 0,\n        isTiming: 0,\n        created: '',\n        weibo: 0,\n        license: 0,\n        tags: '',\n        title: post.post_title,\n        text: post.markdown,\n        articleId: '',\n        draftId: '',\n        id: '',\n      },\n    })\n\n    console.log('data', data)\n    return {\n      status: 'success',\n      post_id: data.data,\n    }\n  }\n\n  async editPost(post_id, post) {\n    return {\n      status: 'success',\n      post_id: post_id,\n      draftLink: 'https://segmentfault.com/write?draftId=' + post_id,\n    }\n  }\n\n  async uploadFile(file) {\n    var formdata = new FormData()\n    var blob = new Blob([file.bits])\n    formdata.append('image', blob)\n    var res = await axios({\n      url: 'https://segmentfault.com/img/upload/image',\n      method: 'post',\n      data: formdata,\n      headers: { 'Content-Type': 'multipart/form-data' },\n    })\n    var url = 'https://image-static.segmentfault.com/' + res.data[2]\n    //  return url;\n    return [\n      {\n        id: res.data[2],\n        object_key: res.data[2],\n        url: url,\n      },\n    ]\n  }\n\n  async preEditPost(post) {\n    var div = $('<div>')\n    $('body').append(div)\n\n    try {\n      // post.content = post.content.replace(/\\>\\s+\\</g,'');\n      console.log('zihu.Juejin')\n      div.html(post.content)\n\n      // var org = $(post.content);\n      // var doc = $('<div>').append(org.clone());\n      var doc = div\n      // var pres = doc.find(\"pre\");\n      processDocCode(div)\n      makeImgVisible(div)\n\n      var tempDoc = $('<div>').append(doc.clone())\n      post.content =\n        tempDoc.children('div').length == 1\n          ? tempDoc.children('div').html()\n          : tempDoc.html()\n\n      console.log('after.predEdit', post.content)\n    } catch (e) {\n      console.log('preEdit.error', e)\n    }\n  }\n\n  async uploadFileByForm($file) {\n    var formdata = new FormData()\n    formdata.append('image', $file)\n    var res = await axios({\n      url: 'https://segmentfault.com/img/upload/image',\n      method: 'post',\n      data: formdata,\n      headers: { 'Content-Type': 'multipart/form-data' },\n    })\n    var url = 'https://image-static.segmentfault.com/' + res.data[2]\n    return url\n  }\n}\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = Segmentfault;\n\n\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports) {\n\n/* (ignored) */\n\n/***/ }),\n/* 10 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_turndown__ = __webpack_require__(1);\nconst { processDocCode, makeImgVisible } = __webpack_require__(0)\n\n\nclass Juejin {\n  constructor(ac) {\n    this.version = '0.0.1'\n    this.name = 'juejin'\n    this.account = ac\n    this.skipUpload = true\n    console.log('Juejin', 'initliaze', ac, this)\n  }\n\n  async getMetaData() {\n    var data = await $.get('https://juejin.im/auth')\n    console.log(data)\n    return {\n      uid: data.userId,\n      title: data.user.username,\n      avatar: data.user.avatarLarge,\n      type: 'juejin',\n      displayName: '掘金',\n      raw: data,\n      supportTypes: ['markdown', 'html'],\n      home: 'https://juejin.im/editor/drafts',\n      icon: 'https://gold-cdn.xitu.io/favicons/favicon.ico',\n    }\n  }\n\n  async addPost(post, _instance) {\n    // https://post-storage-api-ms.juejin.im/v1/draftStorage\n    console.log('addPost', _instance)\n    console.log(_instance.account, post.markdown)\n    // var post_id = res.data.id;\n    console.log('TurndownService', __WEBPACK_IMPORTED_MODULE_0_turndown__[\"a\" /* default */])\n    var turndownService = new __WEBPACK_IMPORTED_MODULE_0_turndown__[\"a\" /* default */]()\n    turndownService.addRule('codefor', {\n      filter: ['pre'],\n      replacement: function (content) {\n        // content = content.replace(new RegExp(\"` \", \"g\"), \"\\n\");\n        // content = content.replace(new RegExp(\"`\", \"g\"), \"\");\n        return ['```', content, '```'].join('\\n')\n      },\n    })\n\n    var markdown = turndownService.turndown(post.post_content)\n    console.log(markdown)\n\n    var res = await $.ajax({\n      url: 'https://post-storage-api-ms.juejin.im/v1/draftStorage',\n      type: 'POST',\n      dataType: 'JSON',\n      headers: {\n        accept: 'application/json',\n      },\n      data: {\n        uid: _instance.account.uid,\n        device_id: _instance.account.raw.clientId,\n        token: _instance.account.raw.token,\n        src: 'web',\n        category: '5562b428e4b00c57d9b94b9d',\n        content: '',\n        // html: post.post_content,\n        html: ``,\n        markdown: markdown,\n        screenshot: '',\n        isTitleImageFullscreen: 0,\n        tags: '',\n        title: post.post_title,\n        type: 'markdown',\n      },\n    })\n    console.log(res)\n    return {\n      status: 'success',\n      post_id: res.d[0],\n    }\n  }\n\n  async editPost(post_id, post) {\n    return {\n      status: 'success',\n      post_id: post_id,\n      draftLink: 'https://juejin.im/editor/drafts/' + post_id,\n    }\n  }\n\n  async uploadFile(file) {\n    var src = file.src\n    var res = await $.ajax({\n      url: 'https://cdn-ms.juejin.im/v1/fetch',\n      type: 'POST',\n      contentType: 'application/json',\n      xhrFields: {\n        withCredentials: true,\n      },\n      headers: {\n        accept: 'application/json',\n      },\n      data: JSON.stringify({\n        bucket: 'gold-user-assets',\n        url: src,\n      }),\n    })\n\n    console.log(res)\n    return [\n      {\n        id: res.dkey,\n        object_key: res.dkey,\n        url: res.d.url.https,\n      },\n    ]\n  }\n\n  async preEditPost(post) {\n    var div = $('<div>')\n    $('body').append(div)\n\n    try {\n      // post.content = post.content.replace(/\\>\\s+\\</g,'');\n      console.log('zihu.Juejin')\n      div.html(post.content)\n\n      // var org = $(post.content);\n      // var doc = $('<div>').append(org.clone());\n      var doc = div\n      // var pres = doc.find(\"pre\");\n      processDocCode(div)\n      makeImgVisible(div)\n\n      var tempDoc = $('<div>').append(doc.clone())\n      post.content =\n        tempDoc.children('div').length == 1\n          ? tempDoc.children('div').html()\n          : tempDoc.html()\n\n      console.log('after.predEdit', post.content)\n    } catch (e) {\n      console.log('preEdit.error', e)\n    }\n  }\n\n  async uploadFileByForm($file) {\n    var formdata = new FormData()\n    formdata.append('file', $file)\n    var res = await axios({\n      url: 'https://cdn-ms.juejin.im/v1/upload?bucket=gold-user-assets',\n      method: 'post',\n      data: formdata,\n      headers: { 'Content-Type': 'multipart/form-data' },\n    })\n\n    return res.data.d.url.http\n  }\n}\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = Juejin;\n\n\n\n/***/ }),\n/* 11 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// https://mp.csdn.net/mdeditor/saveArticle\n// title: 996.ICU项目Stars构成分析\n// markdowncontent:\n// 996.ICU项目Stars构成分析\n// content: <p>996.ICU项目Stars构成分析</p>\n// id:\n// readType: public\n// tags:\n// status: 2\n// categories:\n// type:\n// original_link:\n// authorized_status: undefined\n// articleedittype: 1\n// Description:\n// resource_url:\n// csrf_token:\n\n// https://me.csdn.net/api/user/show\n\nclass CSDN {\n  constructor() {\n    this.name = 'csdn'\n  }\n\n  async getMetaData() {\n    var res = await $.get('https://me.csdn.net/api/user/show')\n    return {\n      uid: res.data.csdnid,\n      title: res.data.username,\n      avatar: res.data.avatarurl,\n      type: 'csdn',\n      displayName: 'CSDN',\n      supportTypes: ['markdown'],\n      home: 'https://mp.csdn.net/',\n      icon: 'https://csdnimg.cn/public/favicon.ico',\n    }\n  }\n\n  async addPost(post) {\n    var res = await $.ajax({\n      url: 'https://mp.csdn.net/mdeditor/saveArticle',\n      type: 'POST',\n      dataType: 'JSON',\n      headers: {\n        accept: 'application/json',\n      },\n      data: {\n        title: post.post_title,\n        markdowncontent: post.markdown,\n        content: post.post_content,\n        id: '',\n        readType: 'public',\n        tags: '',\n        status: 2,\n        categories: '',\n        type: '',\n        original_link: '',\n        authorized_status: 'undefined',\n        articleedittype: 1,\n        Description: '',\n        resource_url: '',\n        csrf_token: '',\n      },\n    })\n    console.log(res)\n    return {\n      status: 'success',\n      post_id: res.data.id,\n    }\n  }\n\n  async editPost(post_id, post) {\n    return {\n      status: 'success',\n      post_id: post_id,\n      draftLink: 'https://mp.csdn.net/mdeditor/' + post_id,\n    }\n  }\n}\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = CSDN;\n\n\n\n\n/***/ }),\n/* 12 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// https://mp.csdn.net/mdeditor/saveArticle\n// title: 996.ICU项目Stars构成分析\n// markdowncontent:\n// 996.ICU项目Stars构成分析\n// content: <p>996.ICU项目Stars构成分析</p>\n// id:\n// readType: public\n// tags:\n// status: 2\n// categories:\n// type:\n// original_link:\n// authorized_status: undefined\n// articleedittype: 1\n// Description:\n// resource_url:\n// csrf_token:\n// https://me.csdn.net/api/user/show\n// https://passport.cnblogs.com/user/LoginInfo?callback=jQuery17083998854357229_1570784103705&_=1570784103764\n\nclass Cnblog {\n  constructor() {\n    this.name = 'cnblog'\n  }\n\n  async getMetaData() {\n    var res = await $.get('https://home.cnblogs.com/user/CurrentUserInfo')\n    var parser = new DOMParser()\n    var htmlDoc = parser.parseFromString(res, 'text/html')\n    var img = htmlDoc.getElementsByClassName('pfs')[0]\n    var link = img.parentNode.href\n    var pie = link.split('/')\n    pie.pop()\n    var uid = pie.pop()\n    console.log(link)\n    return {\n      uid: uid,\n      title: uid,\n      avatar: img.src,\n      type: 'cnblog',\n      displayName: 'CnBlog',\n      supportTypes: ['markdown'],\n      home: 'https://i.cnblogs.com/EditArticles.aspx?IsDraft=1',\n      icon: 'https://common.cnblogs.com/favicon.ico',\n    }\n  }\n\n  async addPost(post) {\n    var postId = null\n    try {\n      var res = await $.ajax({\n        url: 'https://i.cnblogs.com/EditArticles.aspx?opt=1',\n        type: 'POST',\n        dataType: 'JSON',\n        headers: {},\n        data: {\n          __VIEWSTATE: '',\n          __VIEWSTATEGENERATOR: '',\n          Editor$Edit$txbTitle: post.post_title,\n          Editor$Edit$EditorBody: post.markdown,\n          Editor$Edit$Advanced$ckbPublished: 'on',\n          Editor$Edit$Advanced$chkDisplayHomePage: 'on',\n          Editor$Edit$Advanced$chkComments: 'on',\n          Editor$Edit$Advanced$chkMainSyndication: 'on',\n          Editor$Edit$Advanced$txbEntryName: '',\n          Editor$Edit$Advanced$txbExcerpt: '',\n          Editor$Edit$Advanced$txbTag: '',\n          Editor$Edit$Advanced$tbEnryPassword: '',\n          Editor$Edit$lkbDraft: '存为草稿',\n        },\n      })\n      console.log('CNBLOG addPost', res)\n    } catch (e) {\n      var parser = new DOMParser()\n      var htmlDoc = parser.parseFromString(e.responseText, 'text/html')\n      var editLink = htmlDoc.getElementById('TipsPanel_LinkEdit')\n      var ErrorPanel = htmlDoc.getElementsByClassName('ErrorPanel')[0]\n      if (editLink) {\n        postId = editLink.href.split('postid=')[1]\n        console.log('CNBLOG error', editLink, editLink.href.query)\n      } else {\n        if (ErrorPanel) {\n          throw Error(ErrorPanel.innerText)\n        }\n      }\n      console.log('CNBLOG error', e.responseText, htmlDoc, editLink)\n    }\n\n    return {\n      status: 'success',\n      post_id: postId,\n    }\n  }\n\n  async editPost(post_id, post) {\n    return {\n      status: 'success',\n      post_id: post_id,\n      draftLink:\n        'https://i.cnblogs.com/EditArticles.aspx?postid=' +\n        post_id +\n        '&update=1',\n    }\n  }\n}\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = Cnblog;\n\n\n\n\n/***/ }),\n/* 13 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nvar weixinMetaCache = null\n\nclass WeixinDriver {\n  constructor() {\n    this.meta = weixinMetaCache\n    this.name = 'weixin'\n  }\n\n  async getMetaData() {\n    var res = await $.ajax({ url: 'https://mp.weixin.qq.com/' })\n    var innerDoc = $(res)\n    var doc = $('<div>').append(innerDoc.clone())\n    // console.log('WeixinDriver', res);\n    var code = doc.find('script').eq(0).text()\n    code = code.substring(code.indexOf('window.wx.commonData'))\n    var wx = new Function(\n      'window.wx = {}; window.handlerNickname = function(){};' +\n        code +\n        '; return window.wx;'\n    )()\n    console.log(code, wx)\n    var commonData = Object.assign({}, wx.commonData)\n    delete window.wx\n    if (!commonData.data.t) {\n      throw new Error('未登录')\n    }\n    var metadata = {\n      uid: commonData.data.user_name,\n      title: commonData.data.nick_name,\n      token: commonData.data.t,\n      commonData: commonData,\n      avatar: doc.find('.weui-desktop-account__thumb').eq(0).attr('src'),\n      type: 'weixin',\n      supportTypes: ['html'],\n      home: 'https://mp.weixin.qq.com',\n      icon: 'https://mp.weixin.qq.com/favicon.ico',\n    }\n    weixinMetaCache = metadata\n    console.log('weixinMetaCache', weixinMetaCache)\n    return metadata\n  }\n\n  async addPost(post) {\n    return {\n      status: 'success',\n      post_id: 0,\n    }\n  }\n\n  async editPost(post_id, post) {\n    console.log('editPost', post.post_thumbnail)\n    var res = await $.ajax({\n      url:\n        'https://mp.weixin.qq.com/cgi-bin/operate_appmsg?t=ajax-response&sub=create&type=10&token=' +\n        weixinMetaCache.token +\n        '&lang=zh_CN',\n      type: 'POST',\n      dataType: 'JSON',\n      data: {\n        token: weixinMetaCache.token,\n        lang: 'zh_CN',\n        f: 'json',\n        ajax: '1',\n        random: Math.random(),\n        AppMsgId: '',\n        count: '1',\n        data_seq: '0',\n        operate_from: 'Chrome',\n        isnew: '0',\n        ad_video_transition0: '',\n        can_reward0: '0',\n        related_video0: '',\n        is_video_recommend0: '-1',\n        title0: post.post_title,\n        author0: '',\n        writerid0: '0',\n        fileid0: '',\n        digest0: post.post_title,\n        auto_gen_digest0: '1',\n        content0: post.post_content,\n        sourceurl0: '',\n        need_open_comment0: '1',\n        only_fans_can_comment0: '0',\n        cdn_url0: '',\n        cdn_235_1_url0: '',\n        cdn_1_1_url0: '',\n        cdn_url_back0: '',\n        crop_list0: '',\n        music_id0: '',\n        video_id0: '',\n        voteid0: '',\n        voteismlt0: '',\n        supervoteid0: '',\n        cardid0: '',\n        cardquantity0: '',\n        cardlimit0: '',\n        vid_type0: '',\n        show_cover_pic0: '0',\n        shortvideofileid0: '',\n        copyright_type0: '0',\n        releasefirst0: '',\n        platform0: '',\n        reprint_permit_type0: '',\n        allow_reprint0: '',\n        allow_reprint_modify0: '',\n        original_article_type0: '',\n        ori_white_list0: '',\n        free_content0: '',\n        fee0: '0',\n        ad_id0: '',\n        guide_words0: '',\n        is_share_copyright0: '0',\n        share_copyright_url0: '',\n        source_article_type0: '',\n        reprint_recommend_title0: '',\n        reprint_recommend_content0: '',\n        share_page_type0: '0',\n        share_imageinfo0: '{\"list\":[]}',\n        share_video_id0: '',\n        dot0: '{}',\n        share_voice_id0: '',\n        insert_ad_mode0: '',\n        categories_list0: '[]',\n        sections0:\n          '[{\"section_index\":1000000,\"text_content\":\"​kkk\",\"section_type\":9,\"ad_available\":false}]',\n        compose_info0:\n          '{\"list\":[{\"blockIdx\":1,\"content\":\"<p>​kkk<br></p>\",\"width\":574,\"height\":27,\"topMargin\":0,\"blockType\":9,\"background\":\"rgba(0, 0, 0, 0)\",\"text\":\"kkk\",\"textColor\":\"rgb(51, 51, 51)\",\"textFontSize\":\"17px\",\"textBackGround\":\"rgba(0, 0, 0, 0)\"}]}',\n      },\n    })\n\n    if (!res.appMsgId) {\n      var err = formatError(res)\n      console.log('error', err)\n      throw new Error(\n        '同步失败 错误内容：' + (err && err.errmsg ? err.errmsg : res.ret)\n      )\n    }\n    return {\n      status: 'success',\n      post_id: res.appMsgId,\n      draftLink:\n        'https://mp.weixin.qq.com/cgi-bin/appmsg?t=media/appmsg_edit&action=edit&type=10&appmsgid=' +\n        res.appMsgId +\n        '&token=' +\n        weixinMetaCache.token +\n        '&lang=zh_CN',\n    }\n    // https://zhuanlan.zhihu.com/api/articles/68769713/draft\n  }\n\n  async uploadFile(file) {\n    var src = file.src\n    var res = await $.ajax({\n      url:\n        'https://mp.weixin.qq.com/cgi-bin/uploadimg2cdn?lang=zh_CN&token=' +\n        weixinMetaCache.token +\n        '&t=' +\n        Math.random(),\n      type: 'POST',\n      dataType: 'JSON',\n      data: {\n        imgurl: src,\n        t: 'ajax-editor-upload-img',\n        token: weixinMetaCache.token,\n        lang: 'zh_CN',\n        f: 'json',\n        ajax: '1',\n      },\n    })\n\n    if (res.errcode != 0) {\n      throw new Error('图片上传失败' + src)\n    }\n    console.log(res)\n    return [\n      {\n        id: 'aaa',\n        object_key: 'aaa',\n        url: res.url,\n      },\n    ]\n  }\n\n  async preEditPost(post) {\n    var div = $('<div>')\n    $('body').append(div)\n\n    if (post.inline_content) {\n      post.content = post.inline_content\n    }\n\n    div.html(post.content)\n\n    var doc = div\n    var tags = doc.find('p')\n    for (let mindex = 0; mindex < tags.length; mindex++) {\n      const tag = tags.eq(mindex)\n      try {\n        var nextHasImage = tag.next().children('img').length\n        var span = $('<span></span>')\n        span.html(tag.html())\n        tag.html('')\n        tag.append(span)\n        // if (!tag.children(\"br\").length) tag.css(\"margin-bottom\", \"20px\");\n        // tag.after(\"<p><br></p>\");\n        // span.css(\"color\", \"rgb(68, 68, 68)\");\n        // span.css(\"font-size\", \"16px\");\n      } catch (e) {}\n    }\n\n    var tags = doc.find('img')\n    for (let mindex = 0; mindex < tags.length; mindex++) {\n      const tag = tags.eq(mindex)\n      const wraperTag = tag.parent()\n      try {\n        tag.removeAttr('_src')\n        tag.attr('style', '')\n        wraperTag.replaceWith('<p>' + wraperTag.html() + '</p>')\n      } catch (e) {}\n    }\n\n    var pres = doc.find('a')\n    for (let mindex = 0; mindex < pres.length; mindex++) {\n      const pre = pres.eq(mindex)\n      try {\n        pre.after(pre.html()).remove()\n      } catch (e) {}\n    }\n\n    var processEmptyLine = function (idx, el) {\n      var $obj = $(this)\n      var originalText = $obj.text()\n      var img = $obj.find('img')\n      var brs = $obj.find('br')\n      if (originalText == '') {\n        ;(function () {\n          if (img.length) return\n          if (!brs.length) return\n          $obj.remove()\n        })()\n      }\n    }\n\n    var processListItem = function (idx, el) {\n      var $obj = $(this)\n      $obj.html($('<p></p>').append($obj.html()))\n    }\n\n    doc.find('li').each(processListItem)\n    // remove empty break line\n    doc.find('p').each(processEmptyLine)\n\n    var processBr = function (idx, el) {\n      var $obj = $(this)\n      if (!$obj.next().length) {\n        $obj.remove()\n      }\n    }\n\n    doc.find('br').each(processBr)\n    post.content = $('<div>')\n      .append(\n        \"<section style='margin-left: 6px;margin-right: 6px;line-height: 1.75em;'>\" +\n          doc.clone().html() +\n          '</section>'\n      )\n      .html()\n\n    console.log('post.content', post.content)\n    var inlineCssHTML = juice.inlineContent(\n      post.content,\n      `\n    /**\n    * common style\n    */\n\n   html, address,\n   blockquote,\n   body, dd, div,\n   dl, dt, fieldset, form,\n   frame, frameset,\n   h1, h2, h3, h4,\n   h5, h6, noframes,\n   ol, p, ul, center,\n   dir, hr, menu, pre   { display: block; unicode-bidi: embed }\n   li              { display: list-item }\n   head            { display: none }\n   table           { display: table }\n   tr              { display: table-row }\n   thead           { display: table-header-group }\n   tbody           { display: table-row-group }\n   tfoot           { display: table-footer-group }\n   col             { display: table-column }\n   colgroup        { display: table-column-group }\n   td, th          { display: table-cell }\n   caption         { display: table-caption }\n   th              { font-weight: bolder; text-align: center }\n   caption         { text-align: center }\n   body            { margin: 8px }\n   h1              { font-size: 2em; margin: .67em 0 }\n   h2              { font-size: 1.5em; margin: .75em 0 }\n   h3              { font-size: 1.17em; margin: .83em 0 }\n   h4, p,\n   blockquote, ul,\n   fieldset, form,\n   ol, dl, dir,\n   menu            { margin: 1.12em 0 }\n   h5              { font-size: .83em; margin: 1.5em 0 }\n   h6              { font-size: .75em; margin: 1.67em 0 }\n   h1, h2, h3, h4,\n   h5, h6, b,\n   strong          { font-weight: bolder }\n   blockquote      { margin-left: 40px; margin-right: 40px }\n   i, cite, em,\n   var, address    { font-style: italic }\n   pre, tt, code,\n   kbd, samp       { font-family: monospace }\n   pre             { white-space: pre }\n   button, textarea,\n   input, select   { display: inline-block }\n   big             { font-size: 1.17em }\n   small, sub, sup { font-size: .83em }\n   sub             { vertical-align: sub }\n   sup             { vertical-align: super }\n   table           { border-spacing: 2px; }\n   thead, tbody,\n   tfoot           { vertical-align: middle }\n   td, th, tr      { vertical-align: inherit }\n   s, strike, del  { text-decoration: line-through }\n   hr              { border: 1px inset }\n   ol, ul, dir,\n   menu, dd        { margin-left: 40px }\n   ol              { list-style-type: decimal }\n   ol ul, ul ol,\n   ul ul, ol ol    { margin-top: 0; margin-bottom: 0 }\n   u, ins          { text-decoration: underline }\n   br:before       { content: \"\\A\"; white-space: pre-line }\n   center          { text-align: center }\n   :link, :visited { text-decoration: underline }\n   :focus          { outline: thin dotted invert }\n   \n   /* Begin bidirectionality settings (do not change) */\n   BDO[DIR=\"ltr\"]  { direction: ltr; unicode-bidi: bidi-override }\n   BDO[DIR=\"rtl\"]  { direction: rtl; unicode-bidi: bidi-override }\n   \n   *[DIR=\"ltr\"]    { direction: ltr; unicode-bidi: embed }\n   *[DIR=\"rtl\"]    { direction: rtl; unicode-bidi: embed }\n   \n   @media print {\n     h1            { page-break-before: always }\n     h1, h2, h3,\n     h4, h5, h6    { page-break-after: avoid }\n     ul, ol, dl    { page-break-before: avoid }\n   }\n   h1,\n   h2,\n   h3,\n   h4,\n   h5,\n   h6 {\n     font-weight: bold;\n   }\n   \n   h1 {\n     font-size: 1.25em;\n     line-height: 1.4em;\n   }\n   \n   h2 {\n     font-size: 1.125em;\n   }\n   \n   h3 {\n     font-size: 1.05em;\n   }\n   \n   h4,\n   h5,\n   h6 {\n     font-size: 1em;\n     margin: 1em 0;\n   }\n\n    p {\n      color: rgb(51, 51, 51);\n      font-size: 15px;\n    }\n\n    li p {\n      margin: 0;\n    }\n   `\n    )\n    console.log('inlineCssHTML new', inlineCssHTML)\n    post.content = inlineCssHTML\n  }\n}\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = WeixinDriver;\n\n\nfunction formatError(e) {\n  var r,\n    a = {\n      errmsg: '',\n      index: !1,\n    }\n  switch (\n    ('undefined' != typeof e.ret\n      ? (r = 1 * e.ret)\n      : e.base_resp &&\n        'undefined' != typeof e.base_resp.ret &&\n        (r = 1 * e.base_resp.ret),\n    1 * r)\n  ) {\n    case -8:\n    case -6:\n      ;(e.ret = '-6'), (a.errmsg = '请输入验证码')\n      break\n\n    case 62752:\n      a.errmsg = '可能含有具备安全风险的链接，请检查'\n      break\n\n    case 64505:\n      a.errmsg = '发送预览失败，请稍后再试'\n      break\n\n    case 64504:\n      a.errmsg = '保存图文消息发送错误，请稍后再试'\n      break\n\n    case 64518:\n      a.errmsg = '正文只能包含一个投票'\n      break\n\n    case 10704:\n    case 10705:\n      a.errmsg = '该素材已被删除'\n      break\n\n    case 10701:\n      a.errmsg = '用户已被加入黑名单，无法向其发送消息'\n      break\n\n    case 10703:\n      a.errmsg = '对方关闭了接收消息'\n      break\n\n    case 10700:\n    case 64503:\n      a.errmsg =\n        '1.接收预览消息的微信尚未关注公众号，请先扫码关注<br /> 2.如果已经关注公众号，请查看微信的隐私设置（在手机微信的“我->设置->隐私->添加我的方式”中），并开启“可通过以下方式找到我”的“手机号”、“微信号”、“QQ号”，否则可能接收不到预览消息'\n      break\n\n    case 64502:\n      a.errmsg = '你输入的微信号不存在，请重新输入'\n      break\n\n    case 64501:\n      a.errmsg = '你输入的帐号不存在，请重新输入'\n      break\n\n    case 412:\n      a.errmsg = '图文中含非法外链'\n      break\n\n    case 64515:\n      a.errmsg = '当前素材非最新内容，请重新打开并编辑'\n      break\n\n    case 320001:\n      a.errmsg = '该素材已被删除，无法保存'\n      break\n\n    case 64702:\n      a.errmsg = '标题超出64字长度限制'\n      break\n\n    case 64703:\n      a.errmsg = '摘要超出120字长度限制'\n      break\n\n    case 64704:\n      a.errmsg = '推荐语超出300字长度限制'\n      break\n\n    case 64708:\n      a.errmsg = '推荐语超出140字长度限制'\n      break\n\n    case 64515:\n      a.errmsg = '当前素材非最新内容'\n      break\n\n    case 200041:\n      a.errmsg = '此素材有文章存在违规，无法编辑'\n      break\n\n    case 64506:\n      a.errmsg = '保存失败,链接不合法'\n      break\n\n    case 64507:\n      a.errmsg =\n        '内容不能包含外部链接，请输入http://或https://开头的公众号相关链接'\n      break\n\n    case 64510:\n      a.errmsg = '内容不能包含音频，请调整'\n      break\n\n    case 64511:\n      a.errmsg = '内容不能包多个音频，请调整'\n      break\n\n    case 64512:\n      a.errmsg = '文章中音频错误,请使用音频添加按钮重新添加。'\n      break\n\n    case 64508:\n      a.errmsg = '查看原文链接可能具备安全风险，请检查'\n      break\n\n    case 64550:\n      a.errmsg = '请勿插入不合法的图文消息链接'\n      break\n\n    case 64558:\n      a.errmsg = '请勿插入图文消息临时链接，链接会在短期失效'\n      break\n\n    case 64559:\n      a.errmsg = '请勿插入未群发的图文消息链接'\n      break\n\n    case -99:\n      a.errmsg = '内容超出字数，请调整'\n      break\n\n    case 64705:\n      a.errmsg = '内容超出字数，请调整'\n      break\n\n    case -1:\n      a.errmsg = '系统错误，请注意备份内容后重试'\n      break\n\n    case -2:\n    case 200002:\n      a.errmsg = '参数错误，请注意备份内容后重试'\n      break\n\n    case 64509:\n      a.errmsg = '正文中不能包含超过3个视频，请重新编辑正文后再保存。'\n      break\n\n    case -5:\n      a.errmsg = '服务错误，请注意备份内容后重试。'\n      break\n\n    case 64513:\n      a.errmsg = '请从正文中选择封面，再尝试保存。'\n      break\n\n    case -206:\n      a.errmsg = '目前，服务负荷过大，请稍后重试。'\n      break\n\n    case 10801:\n      ;(a.errmsg =\n        '标题不能有违反公众平台协议、相关法律法规和政策的内容，请重新编辑。'),\n        (a.index = 1 * e.msg)\n      break\n\n    case 10802:\n      ;(a.errmsg =\n        '作者不能有违反公众平台协议、相关法律法规和政策的内容，请重新编辑。'),\n        (a.index = 1 * e.msg)\n      break\n\n    case 10803:\n      ;(a.errmsg = '敏感链接，请重新添加。'), (a.index = 1 * e.msg)\n      break\n\n    case 10804:\n      ;(a.errmsg =\n        '摘要不能有违反公众平台协议、相关法律法规和政策的内容，请重新编辑。'),\n        (a.index = 1 * e.msg)\n      break\n\n    case 10806:\n      ;(a.errmsg =\n        '正文不能有违反公众平台协议、相关法律法规和政策的内容，请重新编辑。'),\n        (a.index = 1 * e.msg)\n      break\n\n    case 10808:\n      ;(a.errmsg =\n        '推荐语不能有违反公众平台协议、相关法律法规和政策的内容，请重新编辑。'),\n        (a.index = 1 * e.msg)\n      break\n\n    case 10807:\n      a.errmsg = '内容不能违反公众平台协议、相关法律法规和政策，请重新编辑。'\n      break\n\n    case 200003:\n      a.errmsg = '登录态超时，请重新登录。'\n      break\n\n    case 64513:\n      a.errmsg = '封面必须存在正文中，请检查封面'\n      break\n\n    case 64551:\n      a.errmsg = '请检查图文消息中的微视链接后重试。'\n      break\n\n    case 64552:\n      a.errmsg = '请检查阅读原文中的链接后重试。'\n      break\n\n    case 64553:\n      a.errmsg = '请不要在图文消息中插入超过5张卡券。请删减卡券后重试。'\n      break\n\n    case 64554:\n      a.errmsg = '在当前情况下不允许在图文消息中插入卡券，请删除卡券后重试。'\n      break\n\n    case 64555:\n      a.errmsg = '请检查图文消息卡片跳转的链接后重试。'\n      break\n\n    case 64556:\n      a.errmsg = '卡券不属于该公众号，请删除后重试'\n      break\n\n    case 64557:\n      a.errmsg = '卡券无效，请删除后重试。'\n      break\n\n    case 13002:\n      ;(a.errmsg = '该广告卡片已过期，删除后才可保存成功'),\n        (a.index = 1 * e.msg)\n      break\n\n    case 13003:\n      ;(a.errmsg = '已有文章插入过该广告卡片，一个广告卡片仅可插入一篇文章'),\n        (a.index = 1 * e.msg)\n      break\n\n    case 13004:\n      ;(a.errmsg = '该广告卡片与图文消息位置不一致'), (a.index = 1 * e.msg)\n      break\n\n    case 15801:\n    case 15802:\n    case 15803:\n    case 15804:\n    case 15805:\n    case 15806:\n      a.errmsg =\n        e.remind_wording ||\n        '你所编辑的内容可能含有违反微信公众平台平台协议、相关法律法规和政策的内容'\n      break\n\n    case 1530503:\n      a.errmsg = '请勿添加其他公众号的主页链接'\n      break\n\n    case 1530504:\n      a.errmsg = '请勿添加其他公众号的主页链接'\n      break\n\n    case 1530510:\n      a.errmsg = '链接已失效，请在手机端重新复制链接'\n      break\n\n    case 153007:\n    case 153008:\n    case 153009:\n    case 153010:\n      a.errmsg =\n        '很抱歉，原创声明不成功|你的文章内容未达到声明原创的要求，满足以下任一条件可发起声明：<br />1、文章文字字数大于300字，且自己创作的内容大于引用内容<br />2、文章文字字数小于300字，无视频，且图片（包括封面图）均为你已成功声明原创的图片<br />说明：上述要求中，文章文字字数不包含标点符号和空格，请知悉。'\n      break\n\n    case 153200:\n      a.errmsg = '无权限声明原创，取消声明后重试'\n      break\n\n    case 1530511:\n      a.errmsg = '链接已失效，请在手机端重新复制链接'\n      break\n\n    case 220001:\n      a.errmsg = '\"素材管理\"中的存储数量已达到上限，请删除后再操作。'\n      break\n\n    case 220002:\n      a.errmsg = '你的图片库已达到存储上限，请进行清理。'\n      break\n\n    case 153012:\n      a.errmsg = '请设置转载类型'\n      break\n\n    case 200042:\n      a.errmsg = '图文中包含的小程序素材不能多于50个、小程序帐号不能多于10个'\n      break\n\n    case 200043:\n      a.errmsg = '图文中包含没有关联的小程序，请删除后再保存'\n      break\n\n    case 64601:\n      a.errmsg = '一篇文章只能插入一个广告卡片'\n      break\n\n    case 64602:\n      a.errmsg = '尚未开通文中广告位，但文章中有广告'\n      break\n\n    case 64603:\n      a.errmsg = '文中广告前不足300字'\n      break\n\n    case 64604:\n      a.errmsg = '文中广告后不足300字'\n      break\n\n    case 64605:\n      a.errmsg = '文中不能同时插入文中广告和互选广告'\n      break\n\n    case 65101:\n      a.errmsg = '图文模版数量已达到上限，请删除后再操作'\n      break\n\n    case 64560:\n      a.errmsg = '请勿插入历史图文消息页链接'\n      break\n\n    case 64561:\n      a.errmsg = '请勿插入mp.weixin.qq.com域名下的非图文消息链接'\n      break\n\n    case 64562:\n      a.errmsg = '请勿插入非mp.weixin.qq.com域名的链接'\n      break\n\n    case 153013:\n      a.errmsg = '文章内含有投票，不能设置为开放转载'\n      break\n\n    case 153014:\n      a.errmsg = '文章内含有卡券，不能设置为开放转载'\n      break\n\n    case 153015:\n      a.errmsg = '文章内含有小程序链接，不能设置为开放转载'\n      break\n\n    case 153016:\n      a.errmsg = '文章内含有小程序链接，不能设置为开放转载'\n      break\n\n    case 153017:\n      a.errmsg = '文章内含有小程序卡片，不能设置为开放转载'\n      break\n\n    case 153018:\n      a.errmsg = '文章内含有商品，不能设置为开放转载'\n      break\n\n    case 153019:\n      a.errmsg = '文章内含有广告卡片，不能设置为开放转载'\n      break\n\n    case 153020:\n      a.errmsg = '文章内含有广告卡片，不能设置为开放转载'\n      break\n\n    case 153021:\n      a.errmsg = '文章内含有广告卡片，不能设置为开放转载'\n      break\n\n    case 153101:\n      a.errmsg = '含有原文已删除的转载文章，请删除后重试'\n      break\n\n    case 64707:\n      a.errmsg = '赞赏账户授权失效或者状态异常'\n      break\n\n    case 420001:\n      a.errmsg = '封面图不支持GIF，请更换'\n      break\n\n    case 353004:\n      a.errmsg = '不支持添加商品，请删除后重试'\n      break\n\n    case 442001:\n      a.errmsg = '帐号新建/编辑素材能力已被封禁，暂不可使用。'\n      break\n\n    default:\n      a.errmsg = '系统繁忙，请稍后重试'\n  }\n  return a\n}\n\n\n/***/ }),\n/* 14 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nclass YiDian {\n  constructor() {\n    this.skipReadImage = true\n  }\n\n  async getMetaData() {\n    var res = await $.ajax({ url: 'https://mp.yidianzixun.com' })\n    var innerDoc = $(res)\n    var doc = $('<div>').append(innerDoc.clone())\n    var code = doc.find('#__val_').text()\n    console.log('YiDian', code)\n    // code = code.substring(code.indexOf(\"window.mpuser\"));\n    // eval(code);\n    var mpuser = new Function(code + '; return window.mpuser;')()\n    var commonData = Object.assign({}, mpuser)\n    console.log(commonData)\n    if (!commonData.id) {\n      throw new Error('未登录')\n    }\n    var metadata = {\n      uid: commonData.id,\n      title: commonData.media_name,\n      commonData: commonData,\n      avatar: commonData.media_pic,\n      type: 'yidian',\n      supportTypes: ['html'],\n      home: 'https://mp.yidianzixun.com',\n      icon: 'https://www.yidianzixun.com/favicon.ico',\n    }\n    return metadata\n  }\n\n  async addPost(post) {\n    return {\n      status: 'success',\n      post_id: 0,\n    }\n  }\n\n  async editPost(post_id, post) {\n    var res = await $.ajax({\n      url: 'https://mp.yidianzixun.com/model/Article',\n      type: 'POST',\n      dataType: 'JSON',\n      data: {\n        title: post.post_title,\n        cate: '',\n        cateB: '',\n        coverType: 'default',\n        covers: [],\n        content: post.post_content,\n        hasSubTitle: 0,\n        subTitle: '',\n        original: 0,\n        reward: 0,\n        videos: [],\n        audios: [],\n        votes: {\n          vote_id: '',\n          vote_options: [],\n          vote_end_time: '',\n          vote_title: '',\n          vote_type: 1,\n          isAdded: false,\n        },\n        images: [],\n        goods: [],\n        is_mobile: 0,\n        status: 0,\n        import_url: '',\n        import_hash: '',\n        image_urls: {},\n        minTimingHour: 3,\n        maxTimingDay: 7,\n        tags: [],\n        isPubed: false,\n        lastSaveTime: '',\n        dirty: false,\n        editorType: 'articleEditor',\n        activity_id: 0,\n        join_activity: 0,\n        notSaveToStore: true,\n      },\n    })\n\n    if (!res.id) {\n      throw new Error('同步错误' + JSON.stringify(res))\n    }\n    return {\n      status: 'success',\n      post_id: res.id,\n      draftLink: 'https://mp.yidianzixun.com/#/Writing/' + res.id,\n    }\n  }\n\n  async uploadFile(file) {\n    var src = file.src\n    var res = await $.get(\n      'https://mp.yidianzixun.com/api/getImageFromUrl?src=' +\n        encodeURIComponent(src)\n    )\n    // throw new Error('fuck');\n    if (res.status != 'success') {\n      throw new Error('图片上传失败 ' + src)\n    }\n    // http only\n    console.log('uploadFile', res)\n    return [\n      {\n        id: '',\n        object_key: '',\n        url: res.inner_addr,\n      },\n    ]\n  }\n\n  async preEditPost(post) {\n    // var div = $(\"<div>\");\n    // $(\"body\").append(div);\n    // div.html(post.content);\n    // // var org = $(post.content);\n    // // var doc = $('<div>').append(org.clone());\n    // var doc = div;\n    // var pres = doc.find(\"a\");\n    // for (let mindex = 0; mindex < pres.length; mindex++) {\n    //   const pre = pres.eq(mindex);\n    //   try {\n    //     pre.after(pre.html()).remove();\n    //   } catch (e) {}\n    // }\n    // var pres = doc.find(\"iframe\");\n    // for (let mindex = 0; mindex < pres.length; mindex++) {\n    //   const pre = pres.eq(mindex);\n    //   try {\n    //     pre.remove();\n    //   } catch (e) {}\n    // }\n    // post.content = $(\"<div>\")\n    //   .append(doc.clone())\n    //   .html();\n    // console.log(\"post\", post);\n  }\n\n  //   editImg(img, source) {\n  //     img.attr(\"web_uri\", source.images[0].origin_web_uri);\n  //   }\n  //   <img class=\"\" src=\"http://p2.pstatp.com/large/pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" data-ic=\"false\" data-ic-uri=\"\" data-height=\"1333\" data-width=\"1000\" image_type=\"1\" web_uri=\"pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" img_width=\"1000\" img_height=\"1333\"></img>\n}\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = YiDian;\n\n\n\n/***/ })\n/******/ ]);for (var k in modules) exports[k] = modules[k];"