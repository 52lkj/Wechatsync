window.driver = "var modules;\n/******/ (() => { // webpackBootstrap\n/******/ \tvar __webpack_modules__ = ({\n\n/***/ 150:\n/***/ (() => {\n\n\r\nclass Mp163 {\r\n  constructor() {\r\n    this.version = '0.0.1'\r\n        // modify origin headers\r\n    modifyRequestHeaders('mp.sohu.com/mpbp', {\r\n        Origin: 'https://mp.sohu.com',\r\n      Referer: 'https://mp.sohu.com/'\r\n    }, [\r\n        '*://mp.sohu.com/mpbp/*',\r\n    ])\r\n  }\r\n\r\n  async getMetaData() {\r\n    const { data } = await axios.get('https://mp.163.com/wemedia/navinfo.do?_=' + Date.now())\r\n    console.log(data)\r\n    if(data.code != 1) {\r\n        throw new Error('not found')\r\n    }\r\n    const accountInfo = data.data\r\n    _souhuCacheMeta = accountInfo\r\n    return {\r\n      uid: accountInfo.wemediaId,\r\n      title: accountInfo.tname,\r\n      avatar: accountInfo.icon,\r\n      type: '163',\r\n      displayName: '网易号',\r\n      supportTypes: ['html'],\r\n      home: 'https://mp.163.com/index.html#/article/manage',\r\n      icon: 'https://mp.163.com/favicon.ico',\r\n    }\r\n  }\r\n\r\n  async addPost(post, _instance) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n\r\n    // todo\r\n    return {\r\n      status: 'success',\r\n      post_id: post_id,\r\n      draftLink: 'https://mp.sohu.com/mpfe/v3/main/news/addarticle?spm=smmp.articlelist.0.0&contentStatus=2&id=' + post_id,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var uploadUrl = 'https://upload.ws.126.net/picupload?_=1615878815133&wemediaId='\r\n    var file = new File([file.bits], 'temp', {\r\n      type: file.type\r\n    });\r\n    var formdata = new FormData()\r\n    formdata.append('file', file)\r\n    formdata.append('from', 'neteasecode_mp')\r\n    var res = await axios({\r\n      url: uploadUrl,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    return [\r\n      {\r\n        url: res.data.data.url,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n    try {\r\n      console.log('zihu.Juejin')\r\n      div.html(post.content)\r\n      var doc = div\r\n      processDocCode(div)\r\n      makeImgVisible(div)\r\n\r\n      var tempDoc = $('<div>').append(doc.clone())\r\n      post.content =\r\n        tempDoc.children('div').length == 1\r\n          ? tempDoc.children('div').html()\r\n          : tempDoc.html()\r\n\r\n      console.log('after.predEdit', post.content)\r\n    } catch (e) {\r\n      console.log('preEdit.error', e)\r\n    }\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 258:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ _51CtoAdapter)\n/* harmony export */ });\nvar _cacheMeta = null\n\nclass _51CtoAdapter {\n  constructor(config) {\n    // this.skipReadImage = true\n    this.config = config\n    this.name = '51cto'\n  }\n\n  async getMetaData() {\n    var res = await $.get('https://blog.51cto.com/blogger/publish')\n    var parser = new DOMParser()\n    var htmlDoc = parser.parseFromString(res, 'text/html')\n    var img = htmlDoc.querySelector('li.more.user > a > img')\n    var link = img.parentNode.href\n    var pie = link.split('/')\n    // pie.pop()\n    var uid = pie.pop()\n    console.log(link)\n    var scrs = [].slice\n      .call(htmlDoc.querySelectorAll('script'))\n      .filter(_ => _.innerText.indexOf('sign') > -1)\n\n    var uploadSign = null;\n    if (scrs.length) {\n      try {\n        var dataStr = scrs[0].innerText\n        var rawStr = dataStr.substring(\n          dataStr.indexOf('sign'),\n          dataStr.indexOf('uploadUrl', dataStr.indexOf('sign'))\n        )\n        var signStr = rawStr\n          .replace('var', '')\n          .trim()\n          .replace(\"sign = '\", '')\n          .replace(\"';\", '')\n          .trim()\n          uploadSign = signStr\n      } catch (e) {\n        console.log('51cto', e)\n      }\n    }\n      _cacheMeta = {\n        rawStr: rawStr,\n        uploadSign: uploadSign,\n        csrf: htmlDoc\n          .querySelector('meta[name=csrf-token]')\n          .getAttribute('content'),\n      }\n    console.log('51cto', _cacheMeta)\n    return {\n      uid: uid,\n      title: uid,\n      avatar: img.src,\n      type: '51cto',\n      displayName: '51CTO',\n      supportTypes: ['markdown', 'html'],\n      home: 'https://blog.51cto.com/blogger/publish',\n      icon: 'https://blog.51cto.com/favicon.ico',\n    }\n  }\n\n  async addPost(post) {\n    return {\n      status: 'success',\n      post_id: 0,\n    }\n  }\n\n  async editPost(post_id, post) {\n    var postStruct = {}\n\n    if (post.markdown) {\n      postStruct = {\n        title: post.post_title,\n        copy_code: 1,\n        is_old: 0,\n        content: post.markdown,\n        _csrf: _cacheMeta.csrf,\n      }\n    } else {\n      postStruct = {\n        blog_type: null,\n        title: post.post_title,\n        copy_code: 1,\n        content: post.post_content,\n        pid: '',\n        cate_id: '',\n        custom_id: '',\n        tag: '',\n        abstract:'',\n        is_hide: 0,\n        did: '',\n        blog_id: '',\n        is_old: 1,\n        _csrf: _cacheMeta.csrf,\n        // editorValue: null,\n      }\n    }\n\n    var res = await $.ajax({\n      url: 'https://blog.51cto.com/blogger/draft',\n      type: 'POST',\n      dataType: 'JSON',\n      data: postStruct,\n    })\n\n    if (!res.data) {\n      throw new Error(res.message)\n    }\n\n    return {\n      status: 'success',\n      post_id: res.data.did,\n      draftLink: 'https://blog.51cto.com/blogger/draft/' + res.data.did,\n    }\n  }\n\n  async uploadFile(file) {\n    var src = file.src\n    // var csrf = this.config.state.csrf\n    var uploadUrl = 'https://upload.51cto.com/index.php?c=upload&m=upimg&orig=b'\n    var file = new File([file.bits], 'temp', {\n      type: file.type,\n    })\n    var formdata = new FormData()\n\n    formdata.append('sign', _cacheMeta.uploadSign)\n    // formdata.append('file', file)\n    formdata.append('file', file, new Date().getTime() + '.jpg')\n    formdata.append('type', file.type)\n    formdata.append('id', 'WU_FILE_1')\n    formdata.append('fileid', `uploadm-` + Math.floor(Math.random() * 1000000))\n    // formdata.append('name', new Date().getTime() + '.jpg')\n    formdata.append('lastModifiedDate', new Date().toString())\n    formdata.append('size', file.size)\n    var res = await axios({\n      url: uploadUrl,\n      method: 'post',\n      data: formdata,\n      headers: { 'Content-Type': 'multipart/form-data' },\n    })\n\n    if (res.data.status === false) {\n      throw new Error('图片上传失败 ' + src)\n    }\n    // http only\n    console.log('uploadFile', res)\n    var id = Math.floor(Math.random() * 100000)\n    return [\n      {\n        id: id,\n        object_key: id,\n        url: `https://s4.51cto.com/` + res.data.data,\n        // size: res.data.data.size,\n        // images: [res.data],\n      },\n    ]\n  }\n\n  async preEditPost(post) {\n    var div = $('<div>')\n    $('body').append(div)\n\n    div.html(post.content)\n    // var org = $(post.content);\n    // var doc = $('<div>').append(org.clone());\n    var doc = div\n    var pres = doc.find('a')\n    for (let mindex = 0; mindex < pres.length; mindex++) {\n      const pre = pres.eq(mindex)\n      try {\n        pre.after(pre.html()).remove()\n      } catch (e) {}\n    }\n\n    var pres = doc.find('iframe')\n    for (let mindex = 0; mindex < pres.length; mindex++) {\n      const pre = pres.eq(mindex)\n      try {\n        pre.remove()\n      } catch (e) {}\n    }\n\n    try {\n      const images = doc.find('img')\n      for (let index = 0; index < images.length; index++) {\n        const image = images.eq(index)\n        const imgSrc = image.attr('src')\n        if (imgSrc && imgSrc.indexOf('.svg') > -1) {\n          console.log('remove svg Image')\n          image.remove()\n        }\n      }\n      const qqm = doc.find('qqmusic')\n      qqm.next().remove()\n      qqm.remove()\n    } catch (e) {}\n\n    post.content = $('<div>')\n      .append(doc.clone())\n      .html()\n    console.log('post', post)\n  }\n\n  // editImg(img, source) {\n  //   img.attr('size', source.size)\n  // }\n  //   <img class=\"\" src=\"http://p2.pstatp.com/large/pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" data-ic=\"false\" data-ic-uri=\"\" data-height=\"1333\" data-width=\"1000\" image_type=\"1\" web_uri=\"pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" img_width=\"1000\" img_height=\"1333\"></img>\n}\n\n\n/***/ }),\n\n/***/ 174:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ BaseAdapter)\n/* harmony export */ });\nclass BaseAdapter {\r\n\r\n  async getMetaData () {\r\n    // 组装元数据：调用平台 api 获取用户信息和平台信息，并返回组装数据\r\n\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    // 内容预处理：预处理平台无法兼容的文本内容\r\n  }\r\n\r\n  async addPost(post) {\r\n    // 创建文章：调用平台 api 创建草稿\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    // 上传图片：调用平台 api 上传图片\r\n  }\r\n\r\n  async editPost (postId, post) {\r\n    // 更新文章：调用平台 api 更新文章（同步助手内部通过该接口替换文章内图片地址）\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 617:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ CSDNAdapter)\n/* harmony export */ });\n\n\n// const TurndownService = turndown\n\nfunction createUuid() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    var r = Math.random() * 16 | 0;\n    var v = c === 'x' ? r : r & 0x3 | 0x8;\n    return v.toString(16);\n  });\n};\n\nfunction signCSDN(apiPath, contentType = 'application/json') {\n\tvar once = createUuid()\n  var signStr = `POST\n*/*\n\napplication/json\n\nx-ca-key:203803574\nx-ca-nonce:${once}\n${apiPath}`\n\tvar hash = CryptoJS.HmacSHA256(signStr, \"9znpamsyl2c7cdrr9sas0le9vbc3r6ba\");\n\tvar hashInBase64 = CryptoJS.enc.Base64.stringify(hash);\n  return {\n    accept: '*/*',\n    'content-type': contentType,\n    'x-ca-key': 203803574,\n    'x-ca-nonce': once,\n    'x-ca-signature': hashInBase64,\n    'x-ca-signature-headers':'x-ca-key,x-ca-nonce'\n  }\n}\n\nclass CSDNAdapter {\n  constructor() {\n    this.name = 'csdn'\n    modifyRequestHeaders('bizapi.csdn.net/', {\n    \tOrigin: 'https://editor.csdn.net',\n      Referer: 'https://editor.csdn.net/'\n    }, [\n    \t'*://bizapi.csdn.net/*',\n    ])\n  }\n\n  async getMetaData() {\n    var res = await $.get('https://me.csdn.net/api/user/show')\n    return {\n      uid: res.data.csdnid,\n      title: res.data.username,\n      avatar: res.data.avatarurl,\n      type: 'csdn',\n      displayName: 'CSDN',\n      supportTypes: ['markdown', 'html'],\n      home: 'https://mp.csdn.net/',\n      icon: 'https://g.csdnimg.cn/static/logo/favicon32.ico',\n    }\n  }\n\n  async uploadFile(file) {\n    //\n    return [\n      {\n        url: file.src,\n      }\n    ]\n    var headers = signCSDN('/blog-console-api/v3/upload/img?shuiyin=2', 'multipart/form-data')\n    var uploadUrl = 'https://bizapi.csdn.net/blog-console-api/v3/upload/img?shuiyin=2'\n    var file = new File([file.bits], 'temp', {\n      type: file.type\n    });\n    var formdata = new FormData()\n    formdata.append('file', file)\n    var res = await axios({\n      url: uploadUrl,\n      method: 'post',\n      data: formdata,\n      headers: Object.assign(headers, {\n        'Content-Type': 'multipart/form-data'\n      }),\n    })\n\n\n  \treturn [\n      {\n        url: file.src,\n      }\n    ]\n  }\n\n  async addPost(post) {\n    return {\n      status: 'success',\n      post_id: 0,\n    }\n  }\n  async editPost(post_id, post) {\n\t\t// 支持HTML\n    if(!post.markdown) {\n      var turndownService = new turndown()\n    \tturndownService.addRule('codefor', {\n        filter: ['pre'],\n        replacement: function (content) {\n          return ['```', content, '```'].join('\\n')\n        },\n      })\n    \tvar markdown = turndownService.turndown(post.post_content)\n    \tconsole.log(markdown);\n    \tpost.markdown = markdown\n    }\n\n\t\tvar postStruct = {\n    \t    content: post.post_content,\n          markdowncontent: post.markdown,\n          not_auto_saved: \"1\",\n          readType: \"public\",\n          source: \"pc_mdeditor\",\n          status: 2,\n          title: post.post_title,\n    }\n\t\tvar headers = signCSDN('/blog-console-api/v3/mdeditor/saveArticle')\n    var res = await axios.post(\n      'https://bizapi.csdn.net/blog-console-api/v3/mdeditor/saveArticle',\n      postStruct,\n      {\n        headers: headers\n    })\n  \tpost_id = res.data.data.id\n    console.log(res)\n    return {\n      status: 'success',\n      post_id: post_id,\n      draftLink: 'https://editor.csdn.net/md?articleId=' + post_id,\n    }\n  }\n\n  async preEditPost(post) {\n    var div = $('<div>')\n    $('body').append(div)\n    try {\n      div.html(post.content)\n      var doc = div\n      tools.processDocCode(div)\n      tools.makeImgVisible(div)\n      var tempDoc = $('<div>').append(doc.clone())\n      post.content =\n        tempDoc.children('div').length == 1\n          ? tempDoc.children('div').html()\n          : tempDoc.html()\n\n      console.log('after.predEdit', post.content)\n    } catch (e) {\n      console.log('preEdit.error', e)\n    }\n  }\n}\n\n\n/***/ }),\n\n/***/ 308:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ CnblogAdapter)\n/* harmony export */ });\n\nfunction getCookie(name, cookieStr) {\n  let arr,\n    reg = new RegExp('(^| )' + name + '=([^;]*)(;|$)')\n  if ((arr = cookieStr.match(reg))) {\n    return unescape(arr[2])\n  } else {\n    return ''\n  }\n}\n\nfunction parseTokenAndToHeaders(details, cookieKey, headerKey) {\n  var cookieHeader = details.requestHeaders.filter(h => {\n    return h.name.toLowerCase() == 'cookie'\n  })\n  if (cookieHeader.length) {\n    var cookieStr = cookieHeader[0].value\n    var _xsrf = getCookie(cookieKey, cookieStr)\n    if (_xsrf) {\n      details.requestHeaders.push({\n        name: headerKey,\n        value: _xsrf,\n      })\n    }\n  }\n}\n\n\nclass CnblogAdapter {\n  constructor() {\n    this.name = 'cnblog'\n    //\n    this.skipReadImage = true\n    modifyRequestHeaders('i.cnblogs.com/', {\n    \tOrigin: 'https://i.cnblogs.com',\n      Referer: 'https://i.cnblogs.com/'\n    }, [\n    \t'*://i.cnblogs.com/*',\n    ], function(details) {\n\t\t\t// parse token from cookie inject to headers\n      if (details.url.indexOf('i.cnblogs.com/api') > -1) {\n        parseTokenAndToHeaders(details, 'XSRF-TOKEN', 'x-xsrf-token')\n      }\n    })\n  }\n\n  async getMetaData() {\n    var res = await $.get('https://home.cnblogs.com/user/CurrentUserInfo')\n    var parser = new DOMParser()\n    var htmlDoc = parser.parseFromString(res, 'text/html')\n    var img = htmlDoc.getElementsByClassName('pfs')[0]\n    var link = img.parentNode.href\n    var pie = link.split('/')\n    pie.pop()\n    var uid = pie.pop()\n    console.log(link)\n    return {\n      uid: uid,\n      title: uid,\n      avatar: img.src,\n      type: 'cnblog',\n      displayName: 'CnBlog',\n      supportTypes: ['markdown', 'html'],\n      home: 'https://i.cnblogs.com/EditArticles.aspx?IsDraft=1',\n      icon: 'https://i.cnblogs.com/favicon.ico',\n    }\n  }\n\n  async uploadFile(file) {\n    //\n    return [\n      {\n        url: file.src,\n      }\n    ]\n  }\n\n  async addPost(post) {\n    if(!post.markdown) {\n      var turndownService = new turndown()\n    \tturndownService.addRule('codefor', {\n        filter: ['pre'],\n        replacement: function (content) {\n          return ['```', content, '```'].join('\\n')\n        },\n      })\n    \tvar markdown = turndownService.turndown(post.post_content)\n    \tconsole.log(markdown);\n    \tpost.markdown = markdown\n    }\n    var postId = null\n    try {\n      var res = await axios.post('https://i.cnblogs.com/api/posts', {\n          \"id\": null,\n          \"postType\": 2,\n          \"accessPermission\": 0,\n          \"title\": post.post_title,\n          \"url\": null,\n          \"postBody\": post.markdown,\n          \"categoryIds\": null,\n          \"inSiteCandidate\": false,\n          \"inSiteHome\": false,\n          \"siteCategoryId\": null,\n          \"blogTeamIds\": null,\n          \"isPublished\": false,\n          \"displayOnHomePage\": false,\n          \"isAllowComments\": true,\n          \"includeInMainSyndication\": true,\n          \"isPinned\": false,\n          \"isOnlyForRegisterUser\": false,\n          \"isUpdateDateAdded\": false,\n          \"entryName\": null,\n          \"description\": null,\n          \"tags\": null,\n          \"password\": null,\n          \"datePublished\": new Date().toISOString(),\n          \"isMarkdown\": true,\n          \"isDraft\": true,\n          \"autoDesc\": null,\n          \"changePostType\": false,\n          \"blogId\": 0,\n          \"author\": null,\n          \"removeScript\": false,\n          \"clientInfo\": null,\n          \"changeCreatedTime\": false,\n          \"canChangeCreatedTime\": false\n        })\n      console.log('CNBLOG addPost', res)\n      postId = res.data.id\n    } catch (e) {\n    }\n\n    return {\n      status: 'success',\n      post_id: postId,\n    }\n  }\n\n  async editPost(post_id, post) {\n    return {\n      status: 'success',\n      post_id: post_id,\n      draftLink:\n        'https://i.cnblogs.com/articles/edit;postId=' + post_id,\n    }\n  }\n\n  async preEditPost(post) {\n    var div = $('<div>')\n    $('body').append(div)\n    try {\n      div.html(post.content)\n      var doc = div\n      tools.processDocCode(div)\n      tools.makeImgVisible(div)\n      var tempDoc = $('<div>').append(doc.clone())\n      post.content =\n        tempDoc.children('div').length == 1\n          ? tempDoc.children('div').html()\n          : tempDoc.html()\n\n      console.log('after.predEdit', post.content)\n    } catch (e) {\n      console.log('preEdit.error', e)\n    }\n  }\n}\n\n\n\n/***/ }),\n\n/***/ 159:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ DiscuzAdapter)\n/* harmony export */ });\n// https://www.51hanghai.com/portal.php?mod=portalcp&ac=article\r\nvar _cacheMeta = null;\r\n\r\nclass DiscuzAdapter {\r\n  constructor(config) {\r\n    this.config = config || {}\r\n    var url = this.config.url\r\n    this.pubUrl = `${url}/portal.php?mod=portalcp&ac=article`\r\n    // this.upUrl = `${url}/misc.php?mod=swfupload&action=swfupload&operation=portal`\r\n    this.upUrl = `${url}/misc.php?mod=swfupload&action=swfupload&operation=upload`\r\n    this.name = 'discuz'\r\n\r\n    // this.skipReadImage = true\r\n  }\r\n\r\n  async getMetaData() {\r\n    var url = this.config.url;\r\n    console.log('disduz', this.config)\r\n    var postUrl = `${url}/portal.php?mod=portalcp&ac=article`\r\n    var favIcon = `${url}/favicon.ico`\r\n    var res = await $.get(postUrl)\r\n    var parser = new DOMParser()\r\n    var htmlDoc = parser.parseFromString(res, 'text/html')\r\n    var nickname = htmlDoc.querySelector('.vwmy').innerText\r\n    var img = htmlDoc.querySelector('.avt img').src\r\n\r\n    _cacheMeta = {\r\n      uid: img.split('uid=')[1].split('&size')[0],\r\n      title: nickname,\r\n      avatar: img,\r\n      type: 'discuz',\r\n      displayName: 'Discuz',\r\n      supportTypes: ['html'],\r\n      config: this.config,\r\n      home: postUrl,\r\n      icon: favIcon,\r\n    }\r\n\r\n    var uploadSrciptBlocks = [].slice.apply(htmlDoc.querySelectorAll('script')).filter(_ => _.innerText.indexOf('SWFUpload') > -1);\r\n    if(uploadSrciptBlocks.length) {\r\n      var scripText = uploadSrciptBlocks[0].innerText\r\n      var startTag = 'post_params:'\r\n      var strIndex =  scripText.indexOf(startTag)\r\n      var dataStr = scripText.substring(strIndex + startTag.length, scripText.indexOf('},', strIndex) + 1);\r\n      var post_params = new Function(\r\n        'var config = ' +\r\n        dataStr +\r\n          '; return config;'\r\n      )();\r\n      _cacheMeta.uploadToken = post_params.hash\r\n      _cacheMeta.raw = post_params\r\n    }\r\n    // var parser = new DOMParser()\r\n    // var htmlDoc = parser.parseFromString(res, 'text/html')\r\n    // var img = htmlDoc.querySelector('li.more.user > a > img')\r\n    return _cacheMeta\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    var postStruct = {}\r\n\r\n    if (post.markdown) {\r\n      postStruct = {\r\n        title: post.post_title,\r\n        catid: 24,\r\n        content: post.markdown,\r\n        romotepic: 1,\r\n      }\r\n    } else {\r\n      postStruct = {\r\n        title: post.post_title,\r\n        catid: 24,\r\n        romotepic: 1,\r\n        content: post.post_content,\r\n      }\r\n    }\r\n\r\n    // title: test\r\n    // highlight_style[0]:\r\n    // highlight_style[1]:\r\n    // highlight_style[2]:\r\n    // highlight_style[3]:\r\n    // htmlname:\r\n    // oldhtmlname:\r\n    // pagetitle:\r\n    // catid: 24\r\n    // from:\r\n    postStruct.fromurl = null\r\n    postStruct.dateline = null\r\n    postStruct.from_idtyp = `tid`\r\n    postStruct.from_id = 0\r\n    postStruct.id = 0\r\n    postStruct.idtype = `tid`;\r\n    postStruct.url = null;\r\n    postStruct.author = null;\r\n    // conver: a:3:{s:3:\"pic\";s:0:\"\";s:5:\"thumb\";i:0;s:6:\"remote\";i:0;}\r\n    // file: (binary)\r\n    // file: (binary)\r\n    // content: test\r\n    // romotepic: 1\r\n    // summary:\r\n    // aid:\r\n    // cid:\r\n    // attach_ids:\r\n    // articlesubmit: true\r\n    postStruct.articlesubmit = true;\r\n    postStruct.formhash = `caa4c6cb`\r\n    postStruct.conver = `a:3:{s:3:\"pic\";s:0:\"\";s:5:\"thumb\";i:0;s:6:\"remote\";i:0;}`;\r\n    // var res = await $.ajax({\r\n    //   url: this.pubUrl,\r\n    //   type: 'POST',\r\n    //   dataType: 'JSON',\r\n    //   data: postStruct,\r\n    // })\r\n    // if (!res.data) {\r\n    //   throw new Error(res.message)\r\n    // }\r\n    setCache('discuz_cache', JSON.stringify(postStruct))\r\n\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n      draftLink: `${this.config.url}/forum.php?mod=guide&view=my&loaddraft`,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var id = Date.now() + Math.floor(Math.random()* 1000);\r\n    return [\r\n      {\r\n        id: id,\r\n        object_key: id,\r\n        url: file.src,\r\n      },\r\n    ]\r\n    var src = file.src\r\n    // var file = new File([file.bits], 'temp', {\r\n    //   type: file.type,\r\n    // })\r\n    var blob = new Blob([file.bits], {\r\n      type: file.type,\r\n    })\r\n    var formdata = new FormData()\r\n\r\n    formdata.append('uid', _cacheMeta.uid)\r\n    formdata.append('hash', _cacheMeta.uploadToken)\r\n    formdata.append('filetype', '.jpg')\r\n    formdata.append('type', 'image')\r\n    formdata.append('aid', '0')\r\n    // formdata.append('catid', '19')\r\n    // formdata.append('Filedata', blob)\r\n    formdata.append('Filedata', blob, new Date().getTime() + '.jpg')\r\n    formdata.append('size', blob.size)\r\n    formdata.append('id', 'WU_FILE_1')\r\n    var res = await axios({\r\n      url: this.upUrl,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    var imageHtmlRes = await axios.get(`${this.config.url}/forum.php?mod=ajax&action=imagelist&type=single&pid=0&aids=` + res.data)\r\n    var parser = new DOMParser()\r\n    var htmlDoc = parser.parseFromString(imageHtmlRes.data, 'text/html')\r\n    var imgSrc = `${this.config.url}/` + htmlDoc.querySelector(\"img\").getAttribute('src')\r\n    console.log('upload.res', imageHtmlRes)\r\n    var imageId = Date.now() +Math.floor( Math.random() * 10);\r\n    // if (res.data.aid === false) {\r\n    //   throw new Error('图片上传失败 ' + src)\r\n    // }\r\n    // http only\r\n    console.log('uploadFile', res)\r\n    return [\r\n       {\r\n        id: imageId,\r\n        object_key: imageId,\r\n        url: imgSrc\r\n      },\r\n      // {\r\n      //   id: res.data.aid,\r\n      //   object_key: res.data.aid,\r\n      //   url: res.data.bigimg,\r\n      //   // size: res.data.data.size,\r\n      //   // images: [res.data],\r\n      // },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n\r\n    div.html(post.content)\r\n    // var org = $(post.content);\r\n    // var doc = $('<div>').append(org.clone());\r\n    var doc = div\r\n    var pres = doc.find('a')\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        pre.after(pre.html()).remove()\r\n      } catch (e) {}\r\n    }\r\n\r\n    var pres = doc.find('iframe')\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        pre.remove()\r\n      } catch (e) {}\r\n    }\r\n\r\n    try {\r\n      const images = doc.find('img')\r\n      for (let index = 0; index < images.length; index++) {\r\n        const image = images.eq(index)\r\n        const imgSrc = image.attr('src')\r\n        if (imgSrc && imgSrc.indexOf('.svg') > -1) {\r\n          console.log('remove svg Image')\r\n          image.remove()\r\n        }\r\n      }\r\n      const qqm = doc.find('qqmusic')\r\n      qqm.next().remove()\r\n      qqm.remove()\r\n    } catch (e) {}\r\n\r\n    post.content = $('<div>')\r\n      .append(doc.clone())\r\n      .html()\r\n    console.log('post', post)\r\n  }\r\n\r\n  editImg(img, source) {\r\n    img.removeAttr('crossorigin')\r\n    img.attr('referrerpolicy', \"no-referrer\")\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 341:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ JuejinAdapter)\n/* harmony export */ });\nclass JuejinAdapter {\r\n  constructor(ac) {\r\n    this.version = '0.0.2'\r\n    this.name = 'juejin'\r\n\r\n\t\t// modify origin headers\r\n    modifyRequestHeaders('api.juejin.cn', {\r\n    \tOrigin: 'https://juejin.cn',\r\n      Referer: 'https://juejin.cn/'\r\n    }, [\r\n    \t'*://api.juejin.cn/*',\r\n    ])\r\n  }\r\n\r\n  async getMetaData() {\r\n    var data = await $.get('https://api.juejin.cn/user_api/v1/user/get')\r\n    console.log(data)\r\n    return {\r\n      uid: data.data.user_id,\r\n      title: data.data.user_name,\r\n      avatar: data.data.avatar_large,\r\n      type: 'juejin',\r\n      displayName: '掘金',\r\n      raw: data.data,\r\n      supportTypes: ['markdown', 'html'],\r\n      home: 'https://juejin.cn/editor/drafts',\r\n      icon: 'https://gold-cdn.xitu.io/favicons/favicon.ico',\r\n    }\r\n  }\r\n\r\n  async addPost(post, _instance) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    console.log('TurndownService', turndown)\r\n    var turndownService = new turndown()\r\n    turndownService.addRule('codefor', {\r\n      filter: ['pre'],\r\n      replacement: function (content) {\r\n        return ['```', content, '```'].join('\\n')\r\n      },\r\n    })\r\n\r\n    var markdown = turndownService.turndown(post.post_content)\r\n    console.log(markdown);\r\n    const { data } = await axios.post('https://api.juejin.cn/content_api/v1/article_draft/create', {\r\n        brief_content: '',\r\n      \tcategory_id: '0',\r\n        cover_image: '',\r\n      \tedit_type: 10,\r\n      \thtml_content: \"deprecated\",\r\n      \tlink_url: \"\",\r\n      \tmark_content: markdown,\r\n      \ttag_ids: [],\r\n      \ttitle: post.post_title\r\n    })\r\n    var post_id = data.data.id\r\n    console.log(data)\r\n    return {\r\n      status: 'success',\r\n      post_id: post_id,\r\n      draftLink: 'https://juejin.cn/editor/drafts/' + post_id,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var src = file.src\r\n    var imageId = Date.now() + Math.floor(Math.random() * 1000)\r\n    const { data } = await axios.post('https://juejin.cn/image/urlSave', {\r\n    \turl: src\r\n    })\r\n    return [\r\n      {\r\n        id: imageId,\r\n        object_key: imageId,\r\n        url: data.data,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n    try {\r\n      console.log('zihu.Juejin')\r\n      div.html(post.content)\r\n      var doc = div\r\n      tools.processDocCode(div)\r\n      tools.makeImgVisible(div)\r\n\r\n      var tempDoc = $('<div>').append(doc.clone())\r\n      post.content =\r\n        tempDoc.children('div').length == 1\r\n          ? tempDoc.children('div').html()\r\n          : tempDoc.html()\r\n\r\n      console.log('after.predEdit', post.content)\r\n    } catch (e) {\r\n      console.log('preEdit.error', e)\r\n    }\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 920:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ SegmentfaultAdapter)\n/* harmony export */ });\nclass SegmentfaultAdapter {\n  constructor() {\n    this.name = 'segmentfault'\n    modifyRequestHeaders('gateway.segmentfault.com/', {\n    \tOrigin: 'https://segmentfault.com',\n      Referer: 'https://segmentfault.com/'\n    }, [\n    \t'*://gateway.segmentfault.com/*',\n    ])\n  }\n\n  async getMetaData() {\n    var res = await $.get('https://segmentfault.com/user/settings')\n    var parser = new DOMParser()\n    var htmlDoc = parser.parseFromString(res, 'text/html')\n    var link = htmlDoc.getElementsByClassName('user-avatar')[0]\n    if (!link) {\n      throw Error('not found')\n    }\n\n    var uid = link.href.split('/').pop()\n    var avatar = link.style['background-image']\n      .replace('url(\"', '')\n      .replace('\")', '')\n    console.log(\n      link.href,\n      link.style['background-image'].replace('url(\"', '').replace('\")', '')\n    )\n\n    return {\n      uid: uid,\n      title: uid,\n      avatar: avatar,\n      type: 'segmentfault',\n      displayName: 'Segmentfault',\n      supportTypes: ['markdown', 'html'],\n      home: 'https://segmentfault.com/user/draft',\n      icon:\n        'https://imgcache.iyiou.com/Company/2016-05-11/cf-segmentfault.jpg',\n    }\n  }\n\n  async addPost(post) {\n    return {\n      status: 'success',\n      post_id: 0\n    }\n  }\n\n  async editPost(post_id, post) {\n    if(!post.markdown) {\n      var turndownService = new turndown()\n      turndownService.addRule('codefor', {\n        filter: ['pre'],\n        replacement: function (content) {\n          return ['```', content, '```'].join('\\n')\n        },\n      })\n\n      var markdown = turndownService.turndown(post.post_content)\n      post.markdown = markdown\n      console.log(markdown)\n    }\n\n    const pageHtml = await $.get('https://segmentfault.com/write')\n    const markStr = 'window.g_initialProps = '\n    const authIndex = pageHtml.indexOf(markStr)\n    if(authIndex == -1) {\n    \tthrow new Error('登录失效 authIndex=' + authIndex)\n    }\n\n    const authTokenStr = pageHtml.substring(authIndex + markStr.length, pageHtml.indexOf(`;\n\t</script>`, authIndex))\n\n    const pageConfig = new Function(\n      'var config = ' +\n        authTokenStr +\n        '; return config;'\n    )();\n\n    const token = pageConfig.global.sessionInfo.key\n\n    var postStruct = {\n      \"title\":post.post_title,\n      \"tags\":[],\n      \"text\": post.markdown,\n      \"object_id\":\"\",\n      \"type\":\"article\"\n    }\n\n    var res = await axios.post('https://gateway.segmentfault.com/draft', postStruct, {\n    \theaders: {\n      \ttoken: token,\n        accept: '*/*',\n    \t\t'content-type': 'application/json',\n      }\n    })\n    post_id = res.data.id\n    return {\n      status: 'success',\n      post_id: post_id,\n      draftLink: 'https://segmentfault.com/write?draftId=' + post_id,\n    }\n  }\n\n  async uploadFile(file) {\n    var formdata = new FormData()\n    var blob = new Blob([file.bits])\n    formdata.append('image', blob)\n    var res = await axios({\n      url: 'https://segmentfault.com/img/upload/image',\n      method: 'post',\n      data: formdata,\n      headers: { 'Content-Type': 'multipart/form-data' },\n    })\n    var url = res.data[1]\n    return [\n      {\n        id: res.data[2],\n        object_key: res.data[2],\n        url: url,\n      },\n    ]\n  }\n\n  async preEditPost(post) {\n    var div = $('<div>')\n    $('body').append(div)\n\n    try {\n      // post.content = post.content.replace(/\\>\\s+\\</g,'');\n      console.log('zihu.Juejin')\n      div.html(post.content)\n      // var org = $(post.content);\n      // var doc = $('<div>').append(org.clone());\n      var doc = div\n      // var pres = doc.find(\"pre\");\n      tools.processDocCode(div)\n      tools.makeImgVisible(div)\n\n      var tempDoc = $('<div>').append(doc.clone())\n      post.content =\n        tempDoc.children('div').length == 1\n          ? tempDoc.children('div').html()\n          : tempDoc.html()\n\n      console.log('after.predEdit', post.content)\n    } catch (e) {\n      console.log('preEdit.error', e)\n    }\n  }\n\n  async uploadFileByForm($file) {\n    var formdata = new FormData()\n    formdata.append('image', $file)\n    var res = await axios({\n      url: 'https://segmentfault.com/img/upload/image',\n      method: 'post',\n      data: formdata,\n      headers: { 'Content-Type': 'multipart/form-data' },\n    })\n    var url = 'https://image-static.segmentfault.com/' + res.data[2]\n    return url\n  }\n}\n\n\n/***/ }),\n\n/***/ 836:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ WeiboAdapter)\n/* harmony export */ });\nvar cacheWeiboUser = null\r\n// var Readability = require(\"../reader/Readability\");\r\n\r\n// fetch(\"https://card.weibo.com/article/v3/aj/editor/draft/save?uid=1820387812&id=402\", { \"credentials\": \"include\", \"headers\": { \"accept\": \"application/json, text/plain, */*\", \"accept-language\": \"zh-CN,zh;q=0.9\", \"content-type\": \"application/x-www-form-urlencoded\" }, \"referrer\": \"https://card.weibo.com/article/v3/editor\", \"referrerPolicy\": \"no-referrer-when-downgrade\", \"body\": \"id=402&title=aaaaaaaaaaa&updated=2019-10-10%2016%3A06%3A43&subtitle=&type=&status=0&publish_at=&error_msg=&error_code=0&collection=%5B%5D&free_content=&content=%3Cp%20align%3D%22justify%22%3Eaaaaaaaaaaaaa%3C%2Fp%3E&cover=https%3A%2F%2Fwx3.sinaimg.cn%2Flarge%2F6c80e9e4ly1g7t62jq7uzj202s01kdfz.jpg&summary=aaa&writer=&extra=null&is_word=0&article_recommend=%5B%5D&follow_to_read=1&isreward=1&pay_setting=%7B%22ispay%22%3A0%2C%22isvclub%22%3A0%7D&source=0&action=1&save=1\", \"method\": \"POST\", \"mode\": \"cors\" });\r\n\r\nclass WeiboAdapter {\r\n  constructor() {\r\n    this.name = 'weibo'\r\n  }\r\n\r\n  async getMetaData() {\r\n    var html = await $.get('https://card.weibo.com/article/v3/editor')\r\n    var configIndx = html.indexOf('$CONFIG')\r\n    var lastIndex = html.indexOf('</script>', configIndx)\r\n    var configStr = html.substring(configIndx - 12, lastIndex)\r\n\r\n    if (configStr.indexOf('CONFIG') > -1) {\r\n      var res = new Function(configStr + ' return $CONFIG;')()\r\n      cacheWeiboUser = res\r\n      return {\r\n        uid: res.uid,\r\n        title: res.nick,\r\n        avatar: res.avatar_large,\r\n        supportTypes: ['html'],\r\n        displayName: '微博',\r\n        type: 'weibo',\r\n        home: 'https://card.weibo.com/article/v3/editor',\r\n        icon: 'https://weibo.com/favicon.ico',\r\n      }\r\n    } else {\r\n      throw new Error('not found')\r\n    }\r\n  }\r\n\r\n  async addPost(post) {\r\n    var res = await $.post(\r\n      'https://card.weibo.com/article/v3/aj/editor/draft/create?uid=' +\r\n        cacheWeiboUser.uid\r\n    )\r\n    if (res.code != 100000) {\r\n      throw new Error(res.msg)\r\n      return\r\n    }\r\n\r\n    console.log(res)\r\n    var post_id = res.data.id\r\n\r\n    var res = await $.ajax({\r\n      url:\r\n        'https://card.weibo.com/article/v3/aj/editor/draft/save?uid=' +\r\n        cacheWeiboUser.uid +\r\n        '&id=' +\r\n        post_id,\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      headers: {\r\n        accept: 'application/json',\r\n      },\r\n      data: {\r\n        id: post_id,\r\n        title: post.post_title,\r\n        subtitle: '',\r\n        type: '',\r\n        status: '0',\r\n        publish_at: '',\r\n        error_msg: '',\r\n        error_code: '0',\r\n        collection: '[]',\r\n        free_content: '',\r\n        content: post.post_content,\r\n        cover: '',\r\n        summary: '',\r\n        writer: '',\r\n        extra: 'null',\r\n        is_word: '0',\r\n        article_recommend: '[]',\r\n        follow_to_read: '1',\r\n        isreward: '1',\r\n        pay_setting: '{\"ispay\":0,\"isvclub\":0}',\r\n        source: '0',\r\n        action: '1',\r\n        content_type: '0',\r\n        save: '1',\r\n      },\r\n      // data: {\r\n      //   id: post_id,\r\n      //   title: post.post_title,\r\n      //   status: 0,\r\n      //   error_code: 0,\r\n      //   content: post.post_content,\r\n      //   cover: \"\",\r\n      //   // summary: 'aaaab',\r\n      //   writer: \"\",\r\n      //   is_word: 0,\r\n      //   article_recommend: [],\r\n      //   follow_to_read: 1,\r\n      //   isreward: 1,\r\n      //   pay_setting: JSON.stringify({ ispay: 0, isvclub: 0 }),\r\n      //   source: 0,\r\n      //   action: 1,\r\n      //   save: 1\r\n      // }\r\n    })\r\n    console.log(res)\r\n    return {\r\n      status: 'success',\r\n      post_id: post_id,\r\n    }\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var rexp = new RegExp('>[\\ts ]*<', 'g')\r\n    var result = post.content.replace(rexp, '><')\r\n    post.content = result\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    var res = await $.ajax({\r\n      url:\r\n        'https://card.weibo.com/article/v3/aj/editor/draft/save?uid=' +\r\n        cacheWeiboUser.uid +\r\n        '&id=' +\r\n        post_id,\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      headers: {\r\n        accept: 'application/json',\r\n      },\r\n      data: {\r\n        id: post_id,\r\n        title: post.post_title,\r\n        subtitle: '',\r\n        type: '',\r\n        status: '0',\r\n        publish_at: '',\r\n        error_msg: '',\r\n        error_code: '0',\r\n        collection: '[]',\r\n        free_content: '',\r\n        content: post.post_content,\r\n        cover: post.post_thumbnail_raw ? post.post_thumbnail_raw.url : '',\r\n        summary: '',\r\n        writer: '',\r\n        extra: 'null',\r\n        is_word: '0',\r\n        article_recommend: '[]',\r\n        follow_to_read: '1',\r\n        isreward: '1',\r\n        pay_setting: '{\"ispay\":0,\"isvclub\":0}',\r\n        source: '0',\r\n        action: '1',\r\n        content_type: '0',\r\n        save: '1',\r\n      },\r\n      // data: {\r\n      //   id: post_id,\r\n      //   title: post.post_title,\r\n      //   status: 0,\r\n      //   error_code: 0,\r\n      //   content: post.post_content,\r\n      //   cover: post.post_thumbnail_raw ? post.post_thumbnail_raw.url : \"\",\r\n      //   // summary: 'aaaab',\r\n      //   writer: \"\",\r\n      //   is_word: 0,\r\n      //   article_recommend: [],\r\n      //   follow_to_read: 1,\r\n      //   isreward: 1,\r\n      //   pay_setting: JSON.stringify({ ispay: 0, isvclub: 0 }),\r\n      //   source: 0,\r\n      //   action: 1,\r\n      //   save: 1\r\n      // }\r\n    })\r\n    console.log(res)\r\n    return {\r\n      status: 'success',\r\n      post_id: post_id,\r\n      draftLink: 'https://card.weibo.com/article/v3/editor#/draft/' + post_id,\r\n    }\r\n  }\r\n\r\n  untiImageDone(src) {\r\n    return new Promise((resolve, reject) => {\r\n      ;(async function loop() {\r\n        var res = await $.ajax({\r\n          url:\r\n            'https://card.weibo.com/article/v3/aj/editor/plugins/asyncimginfo?uid=' +\r\n            cacheWeiboUser.uid,\r\n          type: 'POST',\r\n          headers: {\r\n            accept: '*/*',\r\n            'x-requested-with': 'fetch',\r\n          },\r\n          data: {\r\n            'urls[0]': src,\r\n          },\r\n        })\r\n\r\n        var done = res.data[0].task_status_code == 1\r\n        if (done) {\r\n          resolve(res.data[0])\r\n        } else {\r\n          setTimeout(loop, 1000)\r\n        }\r\n      })()\r\n    })\r\n  }\r\n\r\n  async uploadFileByUrl(file) {\r\n    var src = file.src\r\n    var res = await $.ajax({\r\n      url:\r\n        'https://card.weibo.com/article/v3/aj/editor/plugins/asyncuploadimg?uid=' +\r\n        cacheWeiboUser.uid,\r\n      type: 'POST',\r\n      headers: {\r\n        accept: '*/*',\r\n        'x-requested-with': 'fetch',\r\n      },\r\n      data: {\r\n        'urls[0]': src,\r\n      },\r\n    })\r\n\r\n    // https://card.weibo.com/article/v3/aj/editor/plugins/asyncuploadimg?uid=1820387812\r\n    var imgDetail = await this.untiImageDone(src)\r\n    return [\r\n      {\r\n        id: imgDetail.pid,\r\n        object_key: imgDetail.pid,\r\n        url: imgDetail.url,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var blob = new Blob([file.bits])\r\n    console.log('uploadFile', file, blob)\r\n    var uploadurl1 = `https://picupload.weibo.com/interface/pic_upload.php?app=miniblog&s=json&p=1&data=1&url=&markpos=1&logo=0&nick=&file_source=4`\r\n    var uploadurl2 = 'https://picupload.weibo.com/interface/pic_upload.php?app=miniblog&s=json&p=1&data=1&url=&markpos=1&logo=0&nick='\r\n    var fileResp = await $.ajax({\r\n      url:\r\n      uploadurl1,\r\n      type: 'POST',\r\n      processData: false,\r\n      data: new Blob([file.bits]),\r\n    })\r\n    console.log(file, fileResp)\r\n    return [\r\n      {\r\n        id: fileResp.data.pics.pic_1.pid,\r\n        object_key: fileResp.data.pics.pic_1.pid,\r\n        url:\r\n          'https://wx3.sinaimg.cn/large/' +\r\n          fileResp.data.pics.pic_1.pid +\r\n          '.jpg',\r\n      },\r\n    ]\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 522:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ YiDianAdapter)\n/* harmony export */ });\nclass YiDianAdapter {\r\n  constructor() {\r\n    this.skipReadImage = true\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.ajax({ url: 'https://mp.yidianzixun.com' })\r\n    var innerDoc = $(res)\r\n    var doc = $('<div>').append(innerDoc.clone())\r\n    var code = doc.find('#__val_').text()\r\n    console.log('YiDian', code)\r\n    // code = code.substring(code.indexOf(\"window.mpuser\"));\r\n    // eval(code);\r\n    var mpuser = new Function(code + '; return window.mpuser;')()\r\n    var commonData = Object.assign({}, mpuser)\r\n    console.log(commonData)\r\n    if (!commonData.id) {\r\n      throw new Error('未登录')\r\n    }\r\n    var metadata = {\r\n      uid: commonData.id,\r\n      title: commonData.media_name,\r\n      commonData: commonData,\r\n      avatar: commonData.media_pic,\r\n      type: 'yidian',\r\n      supportTypes: ['html'],\r\n      home: 'https://mp.yidianzixun.com',\r\n      icon: 'https://www.yidianzixun.com/favicon.ico',\r\n    }\r\n    return metadata\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    var res = await $.ajax({\r\n      url: 'https://mp.yidianzixun.com/model/Article',\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      data: {\r\n        title: post.post_title,\r\n        cate: '',\r\n        cateB: '',\r\n        coverType: 'default',\r\n        covers: [],\r\n        content: post.post_content,\r\n        hasSubTitle: 0,\r\n        subTitle: '',\r\n        original: 0,\r\n        reward: 0,\r\n        videos: [],\r\n        audios: [],\r\n        votes: {\r\n          vote_id: '',\r\n          vote_options: [],\r\n          vote_end_time: '',\r\n          vote_title: '',\r\n          vote_type: 1,\r\n          isAdded: false,\r\n        },\r\n        images: [],\r\n        goods: [],\r\n        is_mobile: 0,\r\n        status: 0,\r\n        import_url: '',\r\n        import_hash: '',\r\n        image_urls: {},\r\n        minTimingHour: 3,\r\n        maxTimingDay: 7,\r\n        tags: [],\r\n        isPubed: false,\r\n        lastSaveTime: '',\r\n        dirty: false,\r\n        editorType: 'articleEditor',\r\n        activity_id: 0,\r\n        join_activity: 0,\r\n        notSaveToStore: true,\r\n      },\r\n    })\r\n\r\n    if (!res.id) {\r\n      throw new Error('同步错误' + JSON.stringify(res))\r\n    }\r\n    return {\r\n      status: 'success',\r\n      post_id: res.id,\r\n      draftLink: 'https://mp.yidianzixun.com/#/Writing/' + res.id,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var src = file.src\r\n    var res = await $.get(\r\n      'https://mp.yidianzixun.com/api/getImageFromUrl?src=' +\r\n        encodeURIComponent(src)\r\n    )\r\n    // throw new Error('fuck');\r\n    if (res.status != 'success') {\r\n      throw new Error('图片上传失败 ' + src)\r\n    }\r\n    // http only\r\n    console.log('uploadFile', res)\r\n    return [\r\n      {\r\n        id: '',\r\n        object_key: '',\r\n        url: res.inner_addr,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    // var div = $(\"<div>\");\r\n    // $(\"body\").append(div);\r\n    // div.html(post.content);\r\n    // // var org = $(post.content);\r\n    // // var doc = $('<div>').append(org.clone());\r\n    // var doc = div;\r\n    // var pres = doc.find(\"a\");\r\n    // for (let mindex = 0; mindex < pres.length; mindex++) {\r\n    //   const pre = pres.eq(mindex);\r\n    //   try {\r\n    //     pre.after(pre.html()).remove();\r\n    //   } catch (e) {}\r\n    // }\r\n    // var pres = doc.find(\"iframe\");\r\n    // for (let mindex = 0; mindex < pres.length; mindex++) {\r\n    //   const pre = pres.eq(mindex);\r\n    //   try {\r\n    //     pre.remove();\r\n    //   } catch (e) {}\r\n    // }\r\n    // post.content = $(\"<div>\")\r\n    //   .append(doc.clone())\r\n    //   .html();\r\n    // console.log(\"post\", post);\r\n  }\r\n\r\n  //   editImg(img, source) {\r\n  //     img.attr(\"web_uri\", source.images[0].origin_web_uri);\r\n  //   }\r\n  //   <img class=\"\" src=\"http://p2.pstatp.com/large/pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" data-ic=\"false\" data-ic-uri=\"\" data-height=\"1333\" data-width=\"1000\" image_type=\"1\" web_uri=\"pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" img_width=\"1000\" img_height=\"1333\"></img>\r\n}\r\n\n\n/***/ }),\n\n/***/ 386:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ BaiJiaHaoAdapter)\n/* harmony export */ });\n\nclass BaiJiaHaoAdapter {\n  constructor() {\n    this.version = '0.0.1'\n    modifyRequestHeaders('baijiahao.baidu.com/', {\n    \tOrigin: 'https://baijiahao.baidu.com',\n      Referer: 'https://baijiahao.baidu.com/'\n    }, [\n    \t'*://baijiahao.baidu.com/*',\n    ])\n  }\n\n  async getMetaData() {\n    const { data } = await axios.get('https://baijiahao.baidu.com/builder/app/appinfo?_=' + Date.now())\n    console.log(data)\n    if(data.errmsg != 'success') {\n    \tthrow new Error('not found')\n    }\n    const accountInfo = data.data.user\n    return {\n      uid: accountInfo.userid,\n      title: accountInfo.name,\n      avatar: accountInfo.avatar,\n      type: 'baijiahao',\n      displayName: '百家号',\n      supportTypes: ['html'],\n      home: 'https://baijiahao.baidu.com/',\n      icon: 'https://www.baidu.com/favicon.ico?t=20171027',\n    }\n  }\n\n  async addPost(post, _instance) {\n    return {\n      status: 'success',\n      post_id: 0,\n    }\n  }\n\n  async editPost(post_id, post) {\n    // todo\n    const pageHtml = await $.get('https://baijiahao.baidu.com/builder/rc/edit')\n    const markStr = 'window.__BJH__INIT__AUTH__=\"'\n    const authIndex = pageHtml.indexOf(markStr)\n    if(authIndex == -1) {\n    \tthrow new Error('登录失效')\n    }\n\n    const authToken = pageHtml.substring(authIndex + markStr.length, pageHtml.indexOf('\",window.user_id', authIndex))\n    if(authToken.length < 30) {\n      throw new Error('登录失效')\n    }\n\n    const postStruct = {\n      title: post.post_title,\n      content: post.post_content,\n      feed_cat: 1,\n      len: post.post_content.length,\n      activity_list: [\n        {\n        \tid: 408,\n          is_checked: 0\n        }\n      ],\n      source_reprinted_allow: 0,\n      original_status: 0,\n      original_handler_status: 1,\n      isBeautify: false,\n      subtitle: '',\n      bjhtopic_id: '',\n      bjhtopic_info: '',\n      type: 'news',\n    }\n    const res = await $.ajax({\n    \turl: 'https://baijiahao.baidu.com/pcui/article/save?callback=_SAVE_DRAFT_',\n      type: 'POST',\n      dataType: 'JSON',\n      headers: {\n        token: authToken\n      },\n      data: postStruct,\n    })\n    if(res.errmsg != 'success') {\n    \tthrow new Error(res.errmsg)\n    }\n    post_id = res.ret.article_id\n    return {\n      status: 'success',\n      post_id: post_id,\n      draftLink: 'https://baijiahao.baidu.com/builder/rc/edit?type=news&article_id=' + post_id,\n    }\n  }\n\n  async uploadFile(file) {\n    var uploadUrl = 'https://baijiahao.baidu.com/builderinner/api/content/file/upload'\n    var file = new File([file.bits], 'temp', {\n      type: file.type\n    });\n    var formdata = new FormData()\n    formdata.append('media', file)\n    formdata.append('type', 'image')\n    formdata.append('app_id', '1589639493090963')\n    formdata.append('is_waterlog', '1')\n    formdata.append('save_material', '1')\n    formdata.append('no_compress', '0')\n    formdata.append('is_events', '')\n    formdata.append('article_type', 'news')\n\n    var res = await axios({\n      url: uploadUrl,\n      method: 'post',\n      data: formdata,\n      headers: { 'Content-Type': 'multipart/form-data' },\n    })\n\n    return [\n      {\n        url: res.data.ret.https_url,\n      },\n    ]\n  }\n\n  async preEditPost(post) {\n    var div = $('<div>')\n    $('body').append(div)\n    try {\n      div.html(post.content)\n      var doc = div\n      processDocCode(div)\n      makeImgVisible(div)\n      var tempDoc = $('<div>').append(doc.clone())\n      post.content =\n        tempDoc.children('div').length == 1\n          ? tempDoc.children('div').html()\n          : tempDoc.html()\n\n      console.log('after.predEdit', post.content)\n    } catch (e) {\n      console.log('preEdit.error', e)\n    }\n  }\n}\n\n\n/***/ }),\n\n/***/ 536:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ BilibiliAdapter)\n/* harmony export */ });\nclass BilibiliAdapter {\r\n  constructor(config) {\r\n    // this.skipReadImage = true\r\n    this.config = config\r\n    this.name = 'bilibili'\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.ajax({\r\n      url: 'https://api.bilibili.com/x/web-interface/nav?build=0&mobi_app=web',\r\n    })\r\n    if(!res.data.isLogin) {\r\n      throw new Error('not login')\r\n    }\r\n    // console.log(res);\r\n    return {\r\n      uid: res.data.mid,\r\n      title: res.data.uname,\r\n      avatar: res.data.face,\r\n      supportTypes: ['html'],\r\n      type: 'bilibili',\r\n      displayName: '哔哩哔哩',\r\n      home: 'https://member.bilibili.com/platform/upload/text',\r\n      icon: 'https://www.bilibili.com/favicon.ico',\r\n    }\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    // var pgc_feed_covers = []\r\n    // if (post.post_thumbnail_raw && post.post_thumbnail_raw.images) {\r\n    //   pgc_feed_covers.push({\r\n    //     id: 0,\r\n    //     url: post.post_thumbnail_raw.url,\r\n    //     uri: post.post_thumbnail_raw.images[0].origin_web_uri,\r\n    //     origin_uri: post.post_thumbnail_raw.images[0].origin_web_uri,\r\n    //     ic_uri: '',\r\n    //     thumb_width: post.post_thumbnail_raw.images[0].width,\r\n    //     thumb_height: post.post_thumbnail_raw.images[0].height,\r\n    //   })\r\n    // }\r\n\r\n    var csrf = this.config.state.csrf;\r\n    var res = await $.ajax({\r\n      url: 'https://api.bilibili.com/x/article/creative/draft/addupdate',\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      data: {\r\n        tid: 4,\r\n        title: post.post_title,\r\n        save: 0,\r\n        pgc_id: 0,\r\n        content: post.post_content,\r\n        csrf: csrf,\r\n        // pgc_feed_covers: JSON.stringify(pgc_feed_covers),\r\n      },\r\n    })\r\n\r\n    if (!res.data) {\r\n      throw new Error(res.message)\r\n    }\r\n\r\n    return {\r\n      status: 'success',\r\n      post_id: res.data.aid,\r\n      draftLink:\r\n        'https://member.bilibili.com/platform/upload/text/edit?aid=' +\r\n        res.data.aid,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var src = file.src\r\n    var csrf = this.config.state.csrf\r\n\r\n    var uploadUrl ='https://api.bilibili.com/x/article/creative/article/upcover'\r\n    var file = new File([file.bits], 'temp', {\r\n      type: file.type,\r\n    })\r\n    var formdata = new FormData()\r\n    formdata.append('binary', file)\r\n    formdata.append('csrf', csrf)\r\n    var res = await axios({\r\n      url: uploadUrl,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    if (res.data.code != 0) {\r\n      throw new Error('图片上传失败 ' + src)\r\n    }\r\n    // http only\r\n    console.log('uploadFile', res)\r\n    var id = Math.floor(Math.random() * 100000)\r\n    return [\r\n      {\r\n        id: id,\r\n        object_key: id,\r\n        url: res.data.data.url,\r\n        size: res.data.data.size,\r\n        // images: [res.data],\r\n      },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n\r\n    div.html(post.content)\r\n    // var org = $(post.content);\r\n    // var doc = $('<div>').append(org.clone());\r\n    var doc = div\r\n    var pres = doc.find('a')\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        pre.after(pre.html()).remove()\r\n      } catch (e) {}\r\n    }\r\n\r\n    var pres = doc.find('iframe')\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        pre.remove()\r\n      } catch (e) {}\r\n    }\r\n\r\n    try {\r\n      const images = doc.find('img')\r\n      for (let index = 0; index < images.length; index++) {\r\n        const image = images.eq(index)\r\n        const imgSrc = image.attr('src')\r\n        if (imgSrc && imgSrc.indexOf('.svg') > -1) {\r\n          console.log('remove svg Image')\r\n          image.remove()\r\n        }\r\n      }\r\n      const qqm = doc.find('qqmusic')\r\n      qqm.next().remove()\r\n      qqm.remove()\r\n    } catch (e) {}\r\n\r\n    post.content = $('<div>')\r\n      .append(doc.clone())\r\n      .html()\r\n    console.log('post', post)\r\n  }\r\n\r\n  editImg(img, source) {\r\n    img.attr('size', source.size)\r\n  }\r\n  //   <img class=\"\" src=\"http://p2.pstatp.com/large/pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" data-ic=\"false\" data-ic-uri=\"\" data-height=\"1333\" data-width=\"1000\" image_type=\"1\" web_uri=\"pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" img_width=\"1000\" img_height=\"1333\"></img>\r\n}\r\n\n\n/***/ }),\n\n/***/ 247:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ DoubanAdapter)\n/* harmony export */ });\nvar metaCache = null\n\n\nconst ImageRegexp = /^!\\[([^\\]]*)]\\s*\\(([^)\"]+)( \"([^)\"]+)\")?\\)/\nconst imageBlock = (remarkable) => {\n  remarkable.block.ruler.before('paragraph', 'image', (state, startLine, endLine, silent) => {\n    const pos = state.bMarks[startLine] + state.tShift[startLine]\n    const max = state.eMarks[startLine]\n\n    if (pos >= max) {\n      return false\n    }\n    if (!state.src) {\n      return false\n    }\n    if (state.src[pos] !== '!') {\n      return false\n    }\n\n    var match = ImageRegexp.exec(state.src.slice(pos))\n    if (!match) {\n      return false\n    }\n\n    // in silent mode it shouldn't output any tokens or modify pending\n    if (!silent) {\n      state.tokens.push({\n        type: 'image_open',\n        src: match[2],\n        alt: match[1],\n        lines: [ startLine, state.line ],\n        level: state.level\n      })\n\n      state.tokens.push({\n        type: 'image_close',\n        level: state.level\n      })\n    }\n\n    state.line = startLine + 1\n\n    return true\n  })\n}\n\n\n\nfunction getFormData(obj) {\n    var map = {};\n    obj.find('input').each(function() {\n        map[$(this).attr(\"name\")] = $(this).val();\n    });\n    return map\n}\n\n\nclass DoubanAdapter {\n  constructor(config) {\n    this.config = config\n    this.meta = metaCache\n    this.name = 'douban'\n\n    modifyRequestHeaders('www.douban.com/', {\n    \tOrigin: 'https://www.douban.com',\n      Referer: 'https://www.douban.com'\n    }, [\n    \t'*://www.douban.com/*',\n    ])\n  }\n\n  async getMetaData() {\n    var res = await $.ajax({ url: 'https://www.douban.com/note/create' })\n    var innerDoc = $(res)\n    var doc = $('<div>').append(innerDoc.clone())\n    var configScript = innerDoc.filter(function(index, el){ return $(el).text().indexOf('_POST_PARAMS') > -1 });\n    if(configScript.length == 0) {\n        throw new Error('未登录')\n    }\n    var code = configScript.text()\n    var wx = new Function(\n        'Do ={}; Do.add = function() {} '+ code +\n        '; return {_USER_AVATAR: _USER_AVATAR, _USER_NAME: _USER_NAME, _NOTE_ID: _NOTE_ID, _TAGS: _TAGS, _POST_PARAMS: _POST_PARAMS};'\n    )();\n    console.log(code, wx)\n\n    var metadata = {\n      uid: wx._USER_NAME,\n      title: wx._USER_NAME,\n      commonData: wx,\n      avatar: wx._USER_AVATAR,\n      type: 'douban',\n      supportTypes: ['html'],\n      home: 'https://www.douban.com/note/create',\n      icon: 'https://img3.doubanio.com/favicon.ico',\n      form: getFormData(doc.find('#note-editor-form')),\n      _POST_PARAMS: wx._POST_PARAMS\n    }\n    metaCache = metadata\n    this.meta = metaCache\n    console.log('metaCache', metaCache)\n    return metadata\n  }\n\n  async addPost(post) {\n    return {\n      status: 'success',\n      post_id: 0,\n    }\n  }\n\n  async editPost(post_id, post) {\n    // console.log('editPost', post.post_thumbnail)\n    var turndownService = new turndown()\n    var markdown = turndownService.turndown(post.post_content)\n    console\n      .log(markdown)\n\n    // 保证图片换行\n    markdown = markdown.split(\"\\n\").map(_ => {\n      const imageBlocks = _.split('![]');\n      return imageBlocks.length > 1 ? imageBlocks.join('\\n![]') : _\n    }).join(\"\\n\");\n\n    const draftjsState = JSON.stringify(tools.markdownToDraft(markdown, {\n      remarkablePlugins: [imageBlock],\n      blockTypes: {\n        image_open: function(item, generateUniqueKey) {\n          console.log('image_open', 'blockTypes', item)\n          var key = generateUniqueKey()\n          var blockEntities = {}\n          // ?#\n          var sourcePair =  item.src.split(\"?#\")\n          var rawSrc = sourcePair[0]\n          var sourceId = sourcePair[1]\n          if(sourcePair.length) {\n            item.src = rawSrc\n          }\n          var imageTemplate = {\n            id: sourceId,\n            src:  item.src,\n            thumb: item.src,\n            url: item.src,\n          }\n\n          blockEntities[key] = {\n            type: 'IMAGE',\n            mutability: 'IMMUTABLE',\n            data: imageTemplate,\n          }\n          return {\n            type: 'atomic',\n            blockEntities: blockEntities,\n            inlineStyleRanges: [],\n            // \"data\": {\n            //     \"page\": 0\n            // },\n            entityRanges: [\n              {\n                offset: 0,\n                length: 1,\n                key: key,\n              },\n            ],\n            text: ' ',\n          }\n        }\n      },\n      blockEntities: {\n        image: function (item) {\n          var sourcePair =  item.src.split(\"?#\")\n          if(sourcePair.length) {\n            var rawSrc = sourcePair[0]\n            var sourceId = sourcePair[1]\n            item.id = sourceId\n            item.src = rawSrc\n          }\n          console.log('image_open', 'blockEntities', item)\n          return {\n            type: 'IMAGE',\n            mutability: 'IMMUTABLE',\n            data: item\n          }\n        }\n      }\n    }));\n    console.log(draftjsState)\n\n    var state = this.config.state;\n\n    var requestUrl = 'https://www.douban.com/j/note/autosave';\n    var draftLink = 'https://www.douban.com/note/create';\n    var requestBody = {\n      is_rich: 1,\n      note_id: this.meta.form.note_id,\n      note_title: post.post_title,\n      note_text: draftjsState,\n      introduction: '',\n      note_privacy: 'P',\n      cannot_reply: null,\n      author_tags: null,\n      accept_donation: null,\n      donation_notice: null,\n      is_original: null,\n      ck: this.meta.form.ck\n    }\n\n    // https://music.douban.com/subject/24856133/new_review\n    // music review\n    // https://music.douban.com/j/review/create\n    // is_rich: 1\n    // topic_id:\n    // review[subject_id]: 24856133\n    // review[title]: aaa\n    // review[introduction]:\n    // review[text]: {\"entityMap\":{},\"blocks\":[{\"key\":\"9riq1\",\"text\":\"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{\"page\":0}}]}\n    // review[rating]:\n    // review[spoiler]:\n    // review[donate]:\n    // review[original]:\n    // ck: O4jk\n    if(state && state.is_review) {\n      if(state.subject == 'music') {\n        draftLink = state.url;\n        requestUrl = 'https://music.douban.com/j/review/create'\n        requestBody = {\n          is_rich: 1,\n          topic_id: '',\n          review: {\n            subject_id: state.id,\n            title:  post.post_title,\n            introduction: '',\n            text: draftjsState,\n            rating: '',\n            spoiler: '',\n            donate: '',\n            original: ''\n          },\n          ck: this.meta.form.ck\n        }\n      }\n    }\n    console.log('state', requestBody)\n    var res = await $.ajax({\n      url: requestUrl,\n      type: 'POST',\n      dataType: 'JSON',\n      data: requestBody,\n    })\n\n    if(res.url) {\n      draftLink = res.url\n    }\n\n    return {\n      status: 'success',\n      post_id: this.meta.form.note_id,\n      draftLink: draftLink,\n    }\n  }\n\n  editImg(img, source) {\n    img.attr('raw-data', JSON.stringify(source.raw))\n  }\n\n  async uploadFile(file) {\n\n    // https://music.douban.com/j/review/upload_image\n    var requestUrl = 'https://www.douban.com/j/note/add_photo';\n    var state = this.config.state;\n    var formdata = new FormData()\n    var blob = new Blob([file.bits], {\n      type: file.type\n    });\n\n    if(state && state.is_review) {\n      if(state.subject == 'music') {\n        requestUrl =  'https://music.douban.com/j/review/upload_image';\n        formdata.append('review_id', '')\n        formdata.append('picfile', blob)\n      }\n    } else {\n      formdata.append('note_id', this.meta.form.note_id)\n      formdata.append('image_file', blob)\n    }\n\n    formdata.append('ck', this.meta.form.ck)\n    formdata.append('upload_auth_token', this.meta._POST_PARAMS.siteCookie.value)\n\n    var res = await axios({\n      url: requestUrl,\n      method: 'post',\n      data: formdata,\n      headers: { 'Content-Type': 'multipart/form-data' },\n    })\n\n    var url = res.data.photo.url\n    if(!res.data.photo) {\n        console.log(res.data);\n        throw new Error('upload failed')\n    }\n    //  return url;\n    return [\n      {\n        id: res.data.photo.id,\n        object_key: res.data.photo.id,\n        url: url + \"?#\" + res.data.photo.id,\n        raw: res.data\n      },\n    ]\n  }\n}\n\n\n/***/ }),\n\n/***/ 754:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ FocusAdapter)\n/* harmony export */ });\n\r\nclass FocusAdapter {\r\n  constructor() {\r\n    this.name = 'weibo'\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.get('https://mp-fe-pc.focus.cn//user/status?')\r\n    return {\r\n        uid: res.data.uid,\r\n        title: res.data.accountName,\r\n        avatar: null,\r\n        supportTypes: ['html'],\r\n        displayName: '搜狐焦点',\r\n        type: 'sohufocus',\r\n        home: 'https://mp.focus.cn/fe/index.html#/info/draft',\r\n        icon: 'https://mp.focus.cn/favicon.ico',\r\n      }\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n\r\n  async preEditPost(post) {\r\n    var rexp = new RegExp('>[\\ts ]*<', 'g')\r\n    var result = post.content.replace(rexp, '><')\r\n    post.content = result\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    var res = await axios.post('https://mp-fe-pc.focus.cn/news/info/publishNewsInfo', {\r\n        \"projectIds\": [],\r\n        \"newsBasic\": {\r\n          \"id\": \"\",\r\n          \"cityId\": 0,\r\n          \"title\": post.post_title,\r\n          \"category\": 1,\r\n          \"headImg\": \"\",\r\n          \"newsAbstract\": \"\",\r\n          \"isGuide\": 0,\r\n          \"status\": 4\r\n        },\r\n        \"newsContent\": {\r\n          \"content\": post.post_content\r\n        },\r\n        \"videoIds\": []\r\n    })\r\n    // console.log(res)\r\n    var aId = res.data.data.id\r\n    return {\r\n      status: 'success',\r\n      post_id: aId,\r\n      draftLink: 'https://mp.focus.cn/fe/index.html#/info/subinfo/' + aId,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var formdata = new FormData()\r\n    var blob = new Blob([file.bits], {\r\n        type: file.type\r\n    });\r\n\r\n    formdata.append('image', blob, new Date().getTime() + '.jpg')\r\n    var res = await axios({\r\n      url: `https://mp-fe-pc.focus.cn/common/image/upload?type=2`,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    if(res.data.code != 200) {\r\n      console.log(res.data);\r\n      throw new Error('upload failed')\r\n    }\r\n    var url = `https://t-img.51f.com/sh740wsh${res.data.data}`\r\n    return [\r\n      {\r\n        id: res.data.data,\r\n        object_key: res.data.data,\r\n        url: url,\r\n      },\r\n    ]\r\n  }\r\n\r\n}\r\n\n\n/***/ }),\n\n/***/ 172:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ JianShuAdapter)\n/* harmony export */ });\nvar NoteVersionCaches = {}\r\nvar defaultNoteBookId\r\n\r\nclass JianShuAdapter {\r\n  constructor() {\r\n    this.name = 'jianshu'\r\n    // chrome.cookies.getAll({ domain: \"zhihu.com\"},  function(cookies){\r\n    //     console.log(cookies)\r\n    // })\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.ajax({\r\n      url: 'https://www.jianshu.com/settings/basic.json',\r\n    })\r\n    var notebooks = await $.get('https://www.jianshu.com/author/notebooks')\r\n    // console.log(res);\r\n    // https://upload.jianshu.io/users/upload_avatars/12192974/d02c5033-7f82-458f-9b3e-f4c4dbaa1221?imageMogr2/auto-orient/strip|imageView2/1/w/96/h/96\r\n    return {\r\n      uid: res.data.avatar.split('/')[5],\r\n      title: res.data.nickname,\r\n      avatar: res.data.avatar,\r\n      type: 'jianshu',\r\n      displayName: '简书',\r\n      supportTypes: ['html'],\r\n      home: 'https://www.jianshu.com/settings/basic',\r\n      icon: 'https://www.jianshu.com/favicon.ico',\r\n      notebooks: notebooks,\r\n    }\r\n  }\r\n\r\n  async addPost(post) {\r\n    var notebooks = await $.get('https://www.jianshu.com/author/notebooks')\r\n    var firstNoteBook = notebooks[0]\r\n    defaultNoteBookId = firstNoteBook.id\r\n    var res = await $.ajax({\r\n      url: 'https://www.jianshu.com/author/notes',\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      headers: {\r\n        accept: 'application/json',\r\n      },\r\n      contentType: 'application/json',\r\n      data: JSON.stringify({\r\n        at_bottom: false,\r\n        notebook_id: firstNoteBook.id,\r\n        title: post.post_title,\r\n      }),\r\n    })\r\n    console.log(res)\r\n    return {\r\n      status: 'success',\r\n      post_id: res.id,\r\n      notebook_id: firstNoteBook.id,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    var cacheVerions = NoteVersionCaches[post_id]\r\n    var notebook_id = post.notebook_id ? post.notebook_id : defaultNoteBookId\r\n\r\n    if (!cacheVerions) {\r\n      var bookNotes = await $.get(\r\n        'https://www.jianshu.com/author/notebooks/' + notebook_id + '/notes'\r\n      )\r\n      var currentNote = bookNotes.filter((t) => {\r\n        return t.id == post_id\r\n      })[0]\r\n\r\n      console.log(post_id, bookNotes)\r\n      NoteVersionCaches[post_id] = currentNote.autosave_control\r\n      NoteVersionCaches[post_id]++\r\n      cacheVerions = NoteVersionCaches[post_id]\r\n    } else {\r\n      NoteVersionCaches[post_id]++\r\n      cacheVerions = NoteVersionCaches[post_id]\r\n    }\r\n\r\n    console.log('currentNote', cacheVerions)\r\n    var requestData = {\r\n      autosave_control: cacheVerions,\r\n    }\r\n\r\n    if (post.post_content) {\r\n      requestData.content = post.post_content\r\n    }\r\n\r\n    if (post_id) {\r\n      requestData.id = post_id\r\n    }\r\n\r\n    if (post.post_title) {\r\n      requestData.title = post.post_title\r\n    }\r\n\r\n    // https://www.jianshu.com/author/notebooks/108908/notes\r\n    var res = await $.ajax({\r\n      url: 'https://www.jianshu.com/author/notes/' + post_id,\r\n      type: 'PUT',\r\n      dataType: 'JSON',\r\n      contentType: 'application/json',\r\n      headers: {\r\n        accept: 'application/json',\r\n      },\r\n      data: JSON.stringify(requestData),\r\n    })\r\n\r\n    return {\r\n      status: 'success',\r\n      notebook_id: notebook_id,\r\n      post_id: post_id,\r\n      draftLink:\r\n        'https://www.jianshu.com/writer#/notebooks/' +\r\n        notebook_id +\r\n        '/notes/' +\r\n        post_id,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    const tokenReq = await axios.get('https://www.jianshu.com/upload_images/token.json?filename='+ new Date().getTime() +'.png')\r\n    if(tokenReq.data.token) {\r\n      var blob = new Blob([file.bits], {\r\n        type: file.type\r\n      });\r\n      var formdata = new FormData()\r\n      formdata.append('token', tokenReq.data.token)\r\n      formdata.append('key', tokenReq.data.key)\r\n      formdata.append('x:protocol', 'https')\r\n      formdata.append('file', blob, new Date().getTime() + '.jpg')\r\n      var res = await axios({\r\n        url: 'https://upload.qiniup.com/',\r\n        method: 'post',\r\n        data: formdata,\r\n        headers: { 'Content-Type': 'multipart/form-data' },\r\n      })\r\n\r\n      if(!res.data.url) {\r\n        console.log(res.data);\r\n        throw new Error('upload failed')\r\n      }\r\n      var url = res.data.url\r\n      return [\r\n        {\r\n          id: tokenReq.data.key,\r\n          object_key: tokenReq.data.key,\r\n          url: url\r\n        }\r\n      ]\r\n    }\r\n    throw new Error('upload failed')\r\n  }\r\n\r\n  async uploadFileBySrc(file) {\r\n    var src = file.src\r\n    try {\r\n      // jianshu not support webp\r\n      if (src.indexOf('xitu.io') > -1) {\r\n        src = src.replace('webp', 'png')\r\n      }\r\n\r\n      var res = await $.ajax({\r\n        url: 'https://www.jianshu.com/upload_images/fetch',\r\n        type: 'POST',\r\n        contentType: 'application/json',\r\n        xhrFields: {\r\n          withCredentials: true,\r\n        },\r\n        headers: {\r\n          accept: 'application/json',\r\n        },\r\n        data: JSON.stringify({\r\n          url: src,\r\n        }),\r\n      })\r\n\r\n      // http only\r\n      console.log('uploadFile', res)\r\n      return [res]\r\n    } catch (e) {\r\n      console.log('JianShuDriver.uploadFile', e)\r\n      var error = e.responseJSON.error[0].message\r\n      throw new Error(error)\r\n    }\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n    div.html(post.content)\r\n    var doc = div\r\n    var processEmptyLine = function (idx, el) {\r\n      var $obj = $(this)\r\n      var originalText = $obj.text()\r\n      var img = $obj.find('img')\r\n      var brs = $obj.find('br')\r\n      if (originalText == '') {\r\n        ;(function () {\r\n          if (img.length) return\r\n          if (!brs.length) return\r\n          $obj.remove()\r\n        })()\r\n      }\r\n\r\n      // try to replace as h2;\r\n      var strongTag = $obj.find('strong').eq(0)\r\n      var childStrongText = strongTag.text()\r\n      if (originalText == childStrongText) {\r\n        var strongSize = null\r\n        var tagStart = strongTag\r\n        var align = null\r\n        for (let index = 0; index < 4; index++) {\r\n          var fontSize = tagStart.css('font-size')\r\n          var textAlign = tagStart.css('text-align')\r\n          if (fontSize) {\r\n            strongSize = fontSize\r\n          }\r\n          if (textAlign) {\r\n            align = textAlign\r\n          }\r\n          if (align && strongSize) break\r\n          if (tagStart == $obj) {\r\n            console.log('near top')\r\n            break\r\n          }\r\n          tagStart = tagStart.parent()\r\n        }\r\n        if (strongSize) {\r\n          var theFontSize = parseInt(strongSize)\r\n          if (theFontSize > 17 && align == 'center') {\r\n            var newTag = $('<h2></h2>').append($obj.html())\r\n            $obj.after(newTag).remove()\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // remove empty break line\r\n    doc.find('p').each(processEmptyLine)\r\n    doc.find('section').each(processEmptyLine)\r\n\r\n    var processBr = function (idx, el) {\r\n      var $obj = $(this)\r\n      if (!$obj.next().length) {\r\n        $obj.remove()\r\n      }\r\n    }\r\n    doc.find('br').each(processBr)\r\n    // table {\r\n    //     margin-bottom: 10px;\r\n    //     border-collapse: collapse;\r\n    //     display: table;\r\n    //     width: 100%!important;\r\n    // }\r\n    // td, th {\r\n    //     word-wrap: break-word;\r\n    //     word-break: break-all;\r\n    //     padding: 5px 10px;\r\n    //     border: 1px solid #DDD;\r\n    // }\r\n\r\n    // console.log('found table', doc.find('table'))\r\n    var tempDoc = $('<div>').append(doc.clone())\r\n    post.content =\r\n      tempDoc.children('div').length == 1\r\n        ? tempDoc.children('div').html()\r\n        : tempDoc.html()\r\n    // div.remove();\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 192:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ SoHuAdapter)\n/* harmony export */ });\nvar _souhuCacheMeta = null\r\n\r\nclass SoHuAdapter {\r\n  constructor() {\r\n    this.version = '0.0.1'\r\n    this.name = 'sohu'\r\n\r\n    // modify origin headers\r\n    modifyRequestHeaders('mp.sohu.com/mpbp', {\r\n        Origin: 'https://mp.sohu.com',\r\n        Referer: 'https://mp.sohu.com/'\r\n    }, [\r\n    \t'*://mp.sohu.com/mpbp/*',\r\n    ])\r\n  }\r\n\r\n  async getMetaData() {\r\n    const { data } = await axios.get('https://mp.sohu.com/mpbp/bp/account/register-info?_=' + Date.now())\r\n    console.log(data)\r\n    if(data.code != 2000000) {\r\n    \tthrow new Error('not found')\r\n    }\r\n    const accountInfo = data.data.account\r\n    _souhuCacheMeta = accountInfo\r\n    return {\r\n      uid: accountInfo.id,\r\n      title: accountInfo.nickName,\r\n      avatar: accountInfo.avatar,\r\n      type: 'sohu',\r\n      displayName: '搜狐号',\r\n      supportTypes: ['html'],\r\n      home: 'https://mp.sohu.com/mpfe/v3/main/first/page?newsType=1',\r\n      icon: 'https://mp.sohu.com/favicon.ico',\r\n    }\r\n  }\r\n\r\n  async addPost(post, _instance) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n\r\n    var postStruct = {\r\n        title: post.post_title,\r\n        brief: '',\r\n        content: post.post_content,\r\n        channelId: 39,\r\n        categoryId: -1,\r\n        id: 0,\r\n        userColumnId: 0,\r\n        businessCode: 0,\r\n        isOriginal: false,\r\n        cover: '',\r\n        attrIds: '',\r\n        topicIds: '',\r\n        isAd: 0,\r\n        accountId: _souhuCacheMeta.id\r\n    }\r\n\r\n    var res = await $.ajax({\r\n      url: 'https://mp.sohu.com/mpbp/bp/news/v4/news/draft',\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      data: postStruct,\r\n    })\r\n\r\n    if(!res.success) throw new Error(res.msg)\r\n    var post_id = res.data\r\n    console.log(res)\r\n    return {\r\n      status: 'success',\r\n      post_id: post_id,\r\n      draftLink: 'https://mp.sohu.com/mpfe/v3/main/news/addarticle?spm=smmp.articlelist.0.0&contentStatus=2&id=' + post_id,\r\n    }\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var uploadUrl = 'https://mp.sohu.com/commons/front/outerUpload/image/file'\r\n    var file = new File([file.bits], 'temp', {\r\n      type: file.type\r\n    });\r\n    var formdata = new FormData()\r\n    formdata.append('file', file)\r\n    if (_souhuCacheMeta) {\r\n      formdata.append('accountId', _souhuCacheMeta.id)\r\n    }\r\n    var res = await axios({\r\n      url: uploadUrl,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    return [\r\n      {\r\n        url: res.data.url,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n    try {\r\n      console.log('zihu.Juejin')\r\n      div.html(post.content)\r\n      var doc = div\r\n      processDocCode(div)\r\n      makeImgVisible(div)\r\n\r\n      var tempDoc = $('<div>').append(doc.clone())\r\n      post.content =\r\n        tempDoc.children('div').length == 1\r\n          ? tempDoc.children('div').html()\r\n          : tempDoc.html()\r\n\r\n      console.log('after.predEdit', post.content)\r\n    } catch (e) {\r\n      console.log('preEdit.error', e)\r\n    }\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 968:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ ToutiaoAdapter)\n/* harmony export */ });\n// source: 0\r\n// content: <p>testaaa</p>\r\n// title: test\r\n// search_creation_info: {\"searchTopOne\":0,\"abstract\":\"\"}\r\n// title_id: 1607584898506_1559572462858242\r\n// extra: {\"content_word_cnt\":7,\"gd_ext\":{\"entrance\":\"hotspots\",\"from_page\":\"publisher_mp\",\"enter_from\":\"PC\",\"device_platform\":\"mp\",\"is_message\":0}}\r\n// mp_editor_stat: {\"a_justify\":1}\r\n// educluecard:\r\n// draft_form_data: {\"coverType\":2}\r\n// pgc_feed_covers: []\r\n// claim_origin: 0\r\n// origin_debut_check_pgc_normal: 0\r\n// is_fans_article: 0\r\n// govern_forward: 0\r\n// praise: 0\r\n// disable_praise: 0\r\n// article_ad_type: 2\r\n// tree_plan_article: 0\r\n// activity_tag: 0\r\n// trends_writing_tag: 0\r\n// community_sync: 0\r\n// is_refute_rumor: 0\r\n// save: 0\r\n// timer_status: 0\r\n// timer_time:\r\n\r\nclass ToutiaoAdapter {\r\n  constructor() {\r\n    // this.skipReadImage = true\r\n    this.name = 'toutiao'\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.ajax({\r\n      url: 'https://mp.toutiao.com/get_media_info/',\r\n    })\r\n    // console.log(res);\r\n    return {\r\n      uid: res.data.user.id,\r\n      title: res.data.user.screen_name,\r\n      avatar: res.data.user.https_avatar_url,\r\n      supportTypes: ['html'],\r\n      type: 'toutiao',\r\n      displayName: '头条',\r\n      home: 'https://mp.toutiao.com/profile_v3/graphic/publish',\r\n      icon: 'https://sf1-ttcdn-tos.pstatp.com/obj/ttfe/pgcfe/sz/mp_logo.png',\r\n    }\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    var pgc_feed_covers = []\r\n    if (post.post_thumbnail_raw && post.post_thumbnail_raw.images) {\r\n      pgc_feed_covers.push({\r\n        id: 0,\r\n        url: post.post_thumbnail_raw.url,\r\n        uri: post.post_thumbnail_raw.images[0].origin_web_uri,\r\n        origin_uri: post.post_thumbnail_raw.images[0].origin_web_uri,\r\n        ic_uri: '',\r\n        thumb_width: post.post_thumbnail_raw.images[0].width,\r\n        thumb_height: post.post_thumbnail_raw.images[0].height,\r\n      })\r\n    }\r\n\r\n    await $.get('https://mp.toutiao.com/profile_v3/graphic/publish')\r\n\r\n    var res = await $.ajax({\r\n      // url:'https://mp.toutiao.com/core/article/edit_article_post/?source=mp&type=article',\r\n      url: 'https://mp.toutiao.com/mp/agw/article/publish?source=mp&type=article',\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      data: {\r\n        title: post.post_title,\r\n        article_ad_type: 2,\r\n        article_type: 0,\r\n        from_diagnosis: 0,\r\n        origin_debut_check_pgc_normal: 0,\r\n        tree_plan_article: 0,\r\n        save: 0,\r\n        pgc_id: 0,\r\n        content: post.post_content,\r\n        pgc_feed_covers: JSON.stringify(pgc_feed_covers),\r\n      },\r\n    })\r\n\r\n    if (!res.data) {\r\n      throw new Error(res.message)\r\n    }\r\n\r\n    return {\r\n      status: 'success',\r\n      post_id: res.data.pgc_id,\r\n      draftLink:\r\n        'https://mp.toutiao.com/profile_v3/graphic/publish?pgc_id=' +\r\n        res.data.pgc_id,\r\n    }\r\n  }\r\n\r\n  async uploadFileBySrc(file) {\r\n    var src = file.src\r\n    var res = await $.ajax({\r\n      url: 'https://mp.toutiao.com/tools/catch_picture/',\r\n      type: 'POST',\r\n      headers: {\r\n        accept: '*/*',\r\n      },\r\n      data: {\r\n        upfile: src,\r\n        version: 2,\r\n      },\r\n    })\r\n\r\n    // throw new Error('fuck');\r\n    if (res.images && !res.images.length) {\r\n      throw new Error('图片上传失败 ' + src)\r\n    }\r\n\r\n    // http only\r\n    console.log('uploadFile', res)\r\n    return [res]\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var src = file.src\r\n    var uploadUrl = 'https://mp.toutiao.com/mp/agw/article_material/photo/upload_picture?type=ueditor&pgc_watermark=1&action=uploadimage&encode=utf-8'\r\n    // var blob = new Blob([file.bits], {\r\n    //   type: file.type\r\n    // });\r\n    var file = new File([file.bits], 'temp', {\r\n      type: file.type\r\n    });\r\n    var formdata = new FormData()\r\n    formdata.append('upfile', file)\r\n    var res = await axios({\r\n      url: uploadUrl,\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n\r\n    if (res.data.state != 'SUCCESS') {\r\n      throw new Error('图片上传失败 ' + src)\r\n    }\r\n    // http only\r\n    console.log('uploadFile', res)\r\n    return [{\r\n      id: res.data.original,\r\n      object_key: res.data.original,\r\n      url: res.data.url,\r\n      images: [\r\n        res.data\r\n      ]\r\n    }]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n\r\n    div.html(post.content)\r\n\r\n    // var org = $(post.content);\r\n    // var doc = $('<div>').append(org.clone());\r\n\r\n    var doc = div\r\n    var pres = doc.find('a')\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        pre.after(pre.html()).remove()\r\n      } catch (e) {}\r\n    }\r\n\r\n    var pres = doc.find('iframe')\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        pre.remove()\r\n      } catch (e) {}\r\n    }\r\n\r\n    try {\r\n      const images = doc.find('img')\r\n      for (let index = 0; index < images.length; index++) {\r\n        const image = images.eq(index)\r\n        const imgSrc = image.attr('src')\r\n        if (imgSrc && imgSrc.indexOf('.svg') > -1) {\r\n          console.log('remove svg Image')\r\n          image.remove()\r\n        }\r\n      }\r\n      const qqm = doc.find('qqmusic')\r\n      qqm.next().remove()\r\n      qqm.remove()\r\n    } catch (e) {}\r\n\r\n    post.content = $('<div>').append(doc.clone()).html()\r\n    console.log('post', post)\r\n  }\r\n\r\n  editImg(img, source) {\r\n    img.attr('web_uri', source.images[0].origin_web_uri)\r\n  }\r\n  //   <img class=\"\" src=\"http://p2.pstatp.com/large/pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" data-ic=\"false\" data-ic-uri=\"\" data-height=\"1333\" data-width=\"1000\" image_type=\"1\" web_uri=\"pgc-image/bc0a9fc8e595453083d85deb947c3d6e\" img_width=\"1000\" img_height=\"1333\"></img>\r\n}\r\n\n\n/***/ }),\n\n/***/ 476:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ WeixinAdapter)\n/* harmony export */ });\nvar weixinMetaCache = null\r\n\r\nclass WeixinAdapter {\r\n  constructor() {\r\n    this.meta = weixinMetaCache\r\n    this.name = 'weixin'\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.ajax({ url: 'https://mp.weixin.qq.com/' })\r\n    var innerDoc = $(res)\r\n    var doc = $('<div>').append(innerDoc.clone())\r\n    // console.log('WeixinDriver', res);\r\n    var code = doc.find('script').eq(0).text()\r\n    code = code.substring(code.indexOf('window.wx.commonData'))\r\n    var wx = new Function(\r\n      'window.wx = {}; window.handlerNickname = function(){};' +\r\n        code +\r\n        '; return window.wx;'\r\n    )()\r\n    console.log(code, wx)\r\n    var commonData = Object.assign({}, wx.commonData)\r\n    delete window.wx\r\n    if (!commonData.data.t) {\r\n      throw new Error('未登录')\r\n    }\r\n    var metadata = {\r\n      uid: commonData.data.user_name,\r\n      title: commonData.data.nick_name,\r\n      token: commonData.data.t,\r\n      commonData: commonData,\r\n      avatar: doc.find('.weui-desktop-account__thumb').eq(0).attr('src'),\r\n      type: 'weixin',\r\n      supportTypes: ['html'],\r\n      home: 'https://mp.weixin.qq.com',\r\n      icon: 'https://mp.weixin.qq.com/favicon.ico',\r\n    }\r\n    weixinMetaCache = metadata\r\n    console.log('weixinMetaCache', weixinMetaCache)\r\n    return metadata\r\n  }\r\n\r\n  async addPost(post) {\r\n    return {\r\n      status: 'success',\r\n      post_id: 0,\r\n    }\r\n  }\r\n\r\n  async getArticle(data) {\r\n    var token = weixinMetaCache.token || '442135330'\r\n    const tempRespone = await $.get(\r\n      `https://mp.weixin.qq.com/cgi-bin/appmsg?action=get_temp_url&appmsgid=${data.msgId}&itemidx=1&token=${token}&lang=zh_CN&f=json&ajax=1`\r\n    )\r\n    const { temp_url } = tempRespone\r\n    const htmlData = await $.get(temp_url)\r\n    const doc = $(htmlData)\r\n    console.log('htmlData', htmlData)\r\n    var post = {}\r\n\r\n    const allMetas = doc\r\n      .filter(function(index, el) {\r\n        return $(el).attr('property') && $(el).attr('content')\r\n      })\r\n      .map(function() {\r\n        return {\r\n          name: $(this).attr('property'),\r\n          content: $(this).attr('content'),\r\n        }\r\n      })\r\n      .toArray()\r\n\r\n    const metaObj = {}\r\n    allMetas.forEach(obj => {\r\n      metaObj[obj.name] = obj.content\r\n    })\r\n\r\n    post.title = metaObj['og:title']\r\n    post.content = doc.find('#js_content').html()\r\n    post.thumb = metaObj['og:image']\r\n    post.desc = metaObj['og:description']\r\n    post.link = metaObj['og:url'];\r\n    console.log('post', post, doc)\r\n    return post\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    console.log('editPost', post.post_thumbnail)\r\n    var res = await $.ajax({\r\n      url:\r\n        'https://mp.weixin.qq.com/cgi-bin/operate_appmsg?t=ajax-response&sub=create&type=10&token=' +\r\n        weixinMetaCache.token +\r\n        '&lang=zh_CN',\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      data: {\r\n        token: weixinMetaCache.token,\r\n        lang: 'zh_CN',\r\n        f: 'json',\r\n        ajax: '1',\r\n        random: Math.random(),\r\n        AppMsgId: '',\r\n        count: '1',\r\n        data_seq: '0',\r\n        operate_from: 'Chrome',\r\n        isnew: '0',\r\n        ad_video_transition0: '',\r\n        can_reward0: '0',\r\n        related_video0: '',\r\n        is_video_recommend0: '-1',\r\n        title0: post.post_title,\r\n        author0: '',\r\n        writerid0: '0',\r\n        fileid0: '',\r\n        digest0: post.post_title,\r\n        auto_gen_digest0: '1',\r\n        content0: post.post_content,\r\n        sourceurl0: '',\r\n        need_open_comment0: '1',\r\n        only_fans_can_comment0: '0',\r\n        cdn_url0: '',\r\n        cdn_235_1_url0: '',\r\n        cdn_1_1_url0: '',\r\n        cdn_url_back0: '',\r\n        crop_list0: '',\r\n        music_id0: '',\r\n        video_id0: '',\r\n        voteid0: '',\r\n        voteismlt0: '',\r\n        supervoteid0: '',\r\n        cardid0: '',\r\n        cardquantity0: '',\r\n        cardlimit0: '',\r\n        vid_type0: '',\r\n        show_cover_pic0: '0',\r\n        shortvideofileid0: '',\r\n        copyright_type0: '0',\r\n        releasefirst0: '',\r\n        platform0: '',\r\n        reprint_permit_type0: '',\r\n        allow_reprint0: '',\r\n        allow_reprint_modify0: '',\r\n        original_article_type0: '',\r\n        ori_white_list0: '',\r\n        free_content0: '',\r\n        fee0: '0',\r\n        ad_id0: '',\r\n        guide_words0: '',\r\n        is_share_copyright0: '0',\r\n        share_copyright_url0: '',\r\n        source_article_type0: '',\r\n        reprint_recommend_title0: '',\r\n        reprint_recommend_content0: '',\r\n        share_page_type0: '0',\r\n        share_imageinfo0: '{\"list\":[]}',\r\n        share_video_id0: '',\r\n        dot0: '{}',\r\n        share_voice_id0: '',\r\n        insert_ad_mode0: '',\r\n        categories_list0: '[]',\r\n        sections0:\r\n          '[{\"section_index\":1000000,\"text_content\":\"​kkk\",\"section_type\":9,\"ad_available\":false}]',\r\n        compose_info0:\r\n          '{\"list\":[{\"blockIdx\":1,\"content\":\"<p>​kkk<br></p>\",\"width\":574,\"height\":27,\"topMargin\":0,\"blockType\":9,\"background\":\"rgba(0, 0, 0, 0)\",\"text\":\"kkk\",\"textColor\":\"rgb(51, 51, 51)\",\"textFontSize\":\"17px\",\"textBackGround\":\"rgba(0, 0, 0, 0)\"}]}',\r\n      },\r\n    })\r\n\r\n    if (!res.appMsgId) {\r\n      var err = formatError(res)\r\n      console.log('error', err)\r\n      throw new Error(\r\n        '同步失败 错误内容：' + (err && err.errmsg ? err.errmsg : res.ret)\r\n      )\r\n    }\r\n    return {\r\n      status: 'success',\r\n      post_id: res.appMsgId,\r\n      draftLink:\r\n        'https://mp.weixin.qq.com/cgi-bin/appmsg?t=media/appmsg_edit&action=edit&type=10&appmsgid=' +\r\n        res.appMsgId +\r\n        '&token=' +\r\n        weixinMetaCache.token +\r\n        '&lang=zh_CN',\r\n    }\r\n    // https://zhuanlan.zhihu.com/api/articles/68769713/draft\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    var formdata = new FormData()\r\n    var blob = new Blob([file.bits], {\r\n        type: file.type\r\n    });\r\n\r\n    formdata.append('type', blob.type)\r\n    formdata.append('id', new Date().getTime())\r\n    formdata.append('name', new Date().getTime() + '.jpg')\r\n    formdata.append('lastModifiedDate', new Date().toString())\r\n    formdata.append('size', blob.size)\r\n    formdata.append('file', blob, new Date().getTime() + '.jpg')\r\n\r\n    var ticket_id = this.meta.commonData.data.user_name,\r\n      ticket = this.meta.commonData.data.ticket,\r\n      svr_time =  this.meta.commonData.data.time,\r\n      token = this.meta.commonData.data.t,\r\n      seq = new Date().getTime();\r\n\r\n    var res = await axios({\r\n      url: `https://mp.weixin.qq.com/cgi-bin/filetransfer?action=upload_material&f=json&scene=8&writetype=doublewrite&groupid=1&ticket_id=${ticket_id}&ticket=${ticket}&svr_time=${svr_time}&token=${token}&lang=zh_CN&seq=${seq}&t=` + Math.random(),\r\n      method: 'post',\r\n      data: formdata,\r\n      headers: { 'Content-Type': 'multipart/form-data' },\r\n    })\r\n    var url = res.data.cdn_url\r\n    if(res.data.base_resp.err_msg != 'ok') {\r\n      console.log(res.data);\r\n      throw new Error('upload failed')\r\n    }\r\n    //  return url;\r\n    return [\r\n      {\r\n        id: res.data.content,\r\n        object_key: res.data.content,\r\n        url: url,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async uploadFileBySource(file) {\r\n    var src = file.src\r\n    var res = await $.ajax({\r\n      url:\r\n        'https://mp.weixin.qq.com/cgi-bin/uploadimg2cdn?lang=zh_CN&token=' +\r\n        weixinMetaCache.token +\r\n        '&t=' +\r\n        Math.random(),\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      data: {\r\n        imgurl: src,\r\n        t: 'ajax-editor-upload-img',\r\n        token: weixinMetaCache.token,\r\n        lang: 'zh_CN',\r\n        f: 'json',\r\n        ajax: '1',\r\n      },\r\n    })\r\n\r\n    if (res.errcode != 0) {\r\n      throw new Error('图片上传失败' + src)\r\n    }\r\n    console.log(res)\r\n    return [\r\n      {\r\n        id: 'aaa',\r\n        object_key: 'aaa',\r\n        url: res.url,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n\r\n    if (post.inline_content) {\r\n      post.content = post.inline_content\r\n    }\r\n\r\n    div.html(post.content)\r\n\r\n    var doc = div\r\n    var tags = doc.find('p')\r\n    for (let mindex = 0; mindex < tags.length; mindex++) {\r\n      const tag = tags.eq(mindex)\r\n      try {\r\n        var nextHasImage = tag.next().children('img').length\r\n        var span = $('<span></span>')\r\n        span.html(tag.html())\r\n        tag.html('')\r\n        tag.append(span)\r\n        // if (!tag.children(\"br\").length) tag.css(\"margin-bottom\", \"20px\");\r\n        // tag.after(\"<p><br></p>\");\r\n        // span.css(\"color\", \"rgb(68, 68, 68)\");\r\n        // span.css(\"font-size\", \"16px\");\r\n      } catch (e) {}\r\n    }\r\n\r\n    var tags = doc.find('img')\r\n    for (let mindex = 0; mindex < tags.length; mindex++) {\r\n      const tag = tags.eq(mindex)\r\n      const wraperTag = tag.parent()\r\n      try {\r\n        tag.removeAttr('_src')\r\n        tag.attr('style', '')\r\n        wraperTag.replaceWith('<p>' + wraperTag.html() + '</p>')\r\n      } catch (e) {}\r\n    }\r\n\r\n    var pres = doc.find('a')\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        pre.after(pre.html()).remove()\r\n      } catch (e) {}\r\n    }\r\n\r\n    var processEmptyLine = function (idx, el) {\r\n      var $obj = $(this)\r\n      var originalText = $obj.text()\r\n      var img = $obj.find('img')\r\n      var brs = $obj.find('br')\r\n      if (originalText == '') {\r\n        ;(function () {\r\n          if (img.length) return\r\n          if (!brs.length) return\r\n          $obj.remove()\r\n        })()\r\n      }\r\n    }\r\n\r\n    var processListItem = function (idx, el) {\r\n      var $obj = $(this)\r\n      $obj.html($('<p></p>').append($obj.html()))\r\n    }\r\n\r\n    doc.find('li').each(processListItem)\r\n    // remove empty break line\r\n    doc.find('p').each(processEmptyLine)\r\n\r\n    var processBr = function (idx, el) {\r\n      var $obj = $(this)\r\n      if (!$obj.next().length) {\r\n        $obj.remove()\r\n      }\r\n    }\r\n\r\n    doc.find('br').each(processBr)\r\n    post.content = $('<div>')\r\n      .append(\r\n        \"<section style='margin-left: 6px;margin-right: 6px;line-height: 1.75em;'>\" +\r\n          doc.clone().html() +\r\n          '</section>'\r\n      )\r\n      .html()\r\n\r\n    console.log('post.content', post.content)\r\n    var inlineCssHTML = juice.inlineContent(\r\n      post.content,\r\n      `\r\n    /**\r\n    * common style\r\n    */\r\n\r\n   html, address,\r\n   blockquote,\r\n   body, dd, div,\r\n   dl, dt, fieldset, form,\r\n   frame, frameset,\r\n   h1, h2, h3, h4,\r\n   h5, h6, noframes,\r\n   ol, p, ul, center,\r\n   dir, hr, menu, pre   { display: block; unicode-bidi: embed }\r\n   li              { display: list-item }\r\n   head            { display: none }\r\n   table           { display: table }\r\n   tr              { display: table-row }\r\n   thead           { display: table-header-group }\r\n   tbody           { display: table-row-group }\r\n   tfoot           { display: table-footer-group }\r\n   col             { display: table-column }\r\n   colgroup        { display: table-column-group }\r\n   td, th          { display: table-cell }\r\n   caption         { display: table-caption }\r\n   th              { font-weight: bolder; text-align: center }\r\n   caption         { text-align: center }\r\n   body            { margin: 8px }\r\n   h1              { font-size: 2em; margin: .67em 0 }\r\n   h2              { font-size: 1.5em; margin: .75em 0 }\r\n   h3              { font-size: 1.17em; margin: .83em 0 }\r\n   h4, p,\r\n   blockquote, ul,\r\n   fieldset, form,\r\n   ol, dl, dir,\r\n   menu            { margin: 1.12em 0 }\r\n   h5              { font-size: .83em; margin: 1.5em 0 }\r\n   h6              { font-size: .75em; margin: 1.67em 0 }\r\n   h1, h2, h3, h4,\r\n   h5, h6, b,\r\n   strong          { font-weight: bolder }\r\n   blockquote      { margin-left: 40px; margin-right: 40px }\r\n   i, cite, em,\r\n   var, address    { font-style: italic }\r\n   pre, tt, code,\r\n   kbd, samp       { font-family: monospace }\r\n   pre             { white-space: pre }\r\n   button, textarea,\r\n   input, select   { display: inline-block }\r\n   big             { font-size: 1.17em }\r\n   small, sub, sup { font-size: .83em }\r\n   sub             { vertical-align: sub }\r\n   sup             { vertical-align: super }\r\n   table           { border-spacing: 2px; }\r\n   thead, tbody,\r\n   tfoot           { vertical-align: middle }\r\n   td, th, tr      { vertical-align: inherit }\r\n   s, strike, del  { text-decoration: line-through }\r\n   hr              { border: 1px inset }\r\n   ol, ul, dir,\r\n   menu, dd        { margin-left: 40px }\r\n   ol              { list-style-type: decimal }\r\n   ol ul, ul ol,\r\n   ul ul, ol ol    { margin-top: 0; margin-bottom: 0 }\r\n   u, ins          { text-decoration: underline }\r\n   br:before       { content: \"\\A\"; white-space: pre-line }\r\n   center          { text-align: center }\r\n   :link, :visited { text-decoration: underline }\r\n   :focus          { outline: thin dotted invert }\r\n\r\n   /* Begin bidirectionality settings (do not change) */\r\n   BDO[DIR=\"ltr\"]  { direction: ltr; unicode-bidi: bidi-override }\r\n   BDO[DIR=\"rtl\"]  { direction: rtl; unicode-bidi: bidi-override }\r\n\r\n   *[DIR=\"ltr\"]    { direction: ltr; unicode-bidi: embed }\r\n   *[DIR=\"rtl\"]    { direction: rtl; unicode-bidi: embed }\r\n\r\n   @media print {\r\n     h1            { page-break-before: always }\r\n     h1, h2, h3,\r\n     h4, h5, h6    { page-break-after: avoid }\r\n     ul, ol, dl    { page-break-before: avoid }\r\n   }\r\n   h1,\r\n   h2,\r\n   h3,\r\n   h4,\r\n   h5,\r\n   h6 {\r\n     font-weight: bold;\r\n   }\r\n\r\n   h1 {\r\n     font-size: 1.25em;\r\n     line-height: 1.4em;\r\n   }\r\n\r\n   h2 {\r\n     font-size: 1.125em;\r\n   }\r\n\r\n   h3 {\r\n     font-size: 1.05em;\r\n   }\r\n\r\n   h4,\r\n   h5,\r\n   h6 {\r\n     font-size: 1em;\r\n     margin: 1em 0;\r\n   }\r\n\r\n    p {\r\n      color: rgb(51, 51, 51);\r\n      font-size: 15px;\r\n    }\r\n\r\n    li p {\r\n      margin: 0;\r\n    }\r\n   `\r\n    )\r\n    console.log('inlineCssHTML new', inlineCssHTML)\r\n    post.content = inlineCssHTML\r\n  }\r\n}\r\n\r\nfunction formatError(e) {\r\n  var r,\r\n    a = {\r\n      errmsg: '',\r\n      index: !1,\r\n    }\r\n  switch (\r\n    ('undefined' != typeof e.ret\r\n      ? (r = 1 * e.ret)\r\n      : e.base_resp &&\r\n        'undefined' != typeof e.base_resp.ret &&\r\n        (r = 1 * e.base_resp.ret),\r\n    1 * r)\r\n  ) {\r\n    case -8:\r\n    case -6:\r\n      ;(e.ret = '-6'), (a.errmsg = '请输入验证码')\r\n      break\r\n\r\n    case 62752:\r\n      a.errmsg = '可能含有具备安全风险的链接，请检查'\r\n      break\r\n\r\n    case 64505:\r\n      a.errmsg = '发送预览失败，请稍后再试'\r\n      break\r\n\r\n    case 64504:\r\n      a.errmsg = '保存图文消息发送错误，请稍后再试'\r\n      break\r\n\r\n    case 64518:\r\n      a.errmsg = '正文只能包含一个投票'\r\n      break\r\n\r\n    case 10704:\r\n    case 10705:\r\n      a.errmsg = '该素材已被删除'\r\n      break\r\n\r\n    case 10701:\r\n      a.errmsg = '用户已被加入黑名单，无法向其发送消息'\r\n      break\r\n\r\n    case 10703:\r\n      a.errmsg = '对方关闭了接收消息'\r\n      break\r\n\r\n    case 10700:\r\n    case 64503:\r\n      a.errmsg =\r\n        '1.接收预览消息的微信尚未关注公众号，请先扫码关注<br /> 2.如果已经关注公众号，请查看微信的隐私设置（在手机微信的“我->设置->隐私->添加我的方式”中），并开启“可通过以下方式找到我”的“手机号”、“微信号”、“QQ号”，否则可能接收不到预览消息'\r\n      break\r\n\r\n    case 64502:\r\n      a.errmsg = '你输入的微信号不存在，请重新输入'\r\n      break\r\n\r\n    case 64501:\r\n      a.errmsg = '你输入的帐号不存在，请重新输入'\r\n      break\r\n\r\n    case 412:\r\n      a.errmsg = '图文中含非法外链'\r\n      break\r\n\r\n    case 64515:\r\n      a.errmsg = '当前素材非最新内容，请重新打开并编辑'\r\n      break\r\n\r\n    case 320001:\r\n      a.errmsg = '该素材已被删除，无法保存'\r\n      break\r\n\r\n    case 64702:\r\n      a.errmsg = '标题超出64字长度限制'\r\n      break\r\n\r\n    case 64703:\r\n      a.errmsg = '摘要超出120字长度限制'\r\n      break\r\n\r\n    case 64704:\r\n      a.errmsg = '推荐语超出300字长度限制'\r\n      break\r\n\r\n    case 64708:\r\n      a.errmsg = '推荐语超出140字长度限制'\r\n      break\r\n\r\n    case 64515:\r\n      a.errmsg = '当前素材非最新内容'\r\n      break\r\n\r\n    case 200041:\r\n      a.errmsg = '此素材有文章存在违规，无法编辑'\r\n      break\r\n\r\n    case 64506:\r\n      a.errmsg = '保存失败,链接不合法'\r\n      break\r\n\r\n    case 64507:\r\n      a.errmsg =\r\n        '内容不能包含外部链接，请输入http://或https://开头的公众号相关链接'\r\n      break\r\n\r\n    case 64510:\r\n      a.errmsg = '内容不能包含音频，请调整'\r\n      break\r\n\r\n    case 64511:\r\n      a.errmsg = '内容不能包多个音频，请调整'\r\n      break\r\n\r\n    case 64512:\r\n      a.errmsg = '文章中音频错误,请使用音频添加按钮重新添加。'\r\n      break\r\n\r\n    case 64508:\r\n      a.errmsg = '查看原文链接可能具备安全风险，请检查'\r\n      break\r\n\r\n    case 64550:\r\n      a.errmsg = '请勿插入不合法的图文消息链接'\r\n      break\r\n\r\n    case 64558:\r\n      a.errmsg = '请勿插入图文消息临时链接，链接会在短期失效'\r\n      break\r\n\r\n    case 64559:\r\n      a.errmsg = '请勿插入未群发的图文消息链接'\r\n      break\r\n\r\n    case -99:\r\n      a.errmsg = '内容超出字数，请调整'\r\n      break\r\n\r\n    case 64705:\r\n      a.errmsg = '内容超出字数，请调整'\r\n      break\r\n\r\n    case -1:\r\n      a.errmsg = '系统错误，请注意备份内容后重试'\r\n      break\r\n\r\n    case -2:\r\n    case 200002:\r\n      a.errmsg = '参数错误，请注意备份内容后重试'\r\n      break\r\n\r\n    case 64509:\r\n      a.errmsg = '正文中不能包含超过3个视频，请重新编辑正文后再保存。'\r\n      break\r\n\r\n    case -5:\r\n      a.errmsg = '服务错误，请注意备份内容后重试。'\r\n      break\r\n\r\n    case 64513:\r\n      a.errmsg = '请从正文中选择封面，再尝试保存。'\r\n      break\r\n\r\n    case -206:\r\n      a.errmsg = '目前，服务负荷过大，请稍后重试。'\r\n      break\r\n\r\n    case 10801:\r\n      ;(a.errmsg =\r\n        '标题不能有违反公众平台协议、相关法律法规和政策的内容，请重新编辑。'),\r\n        (a.index = 1 * e.msg)\r\n      break\r\n\r\n    case 10802:\r\n      ;(a.errmsg =\r\n        '作者不能有违反公众平台协议、相关法律法规和政策的内容，请重新编辑。'),\r\n        (a.index = 1 * e.msg)\r\n      break\r\n\r\n    case 10803:\r\n      ;(a.errmsg = '敏感链接，请重新添加。'), (a.index = 1 * e.msg)\r\n      break\r\n\r\n    case 10804:\r\n      ;(a.errmsg =\r\n        '摘要不能有违反公众平台协议、相关法律法规和政策的内容，请重新编辑。'),\r\n        (a.index = 1 * e.msg)\r\n      break\r\n\r\n    case 10806:\r\n      ;(a.errmsg =\r\n        '正文不能有违反公众平台协议、相关法律法规和政策的内容，请重新编辑。'),\r\n        (a.index = 1 * e.msg)\r\n      break\r\n\r\n    case 10808:\r\n      ;(a.errmsg =\r\n        '推荐语不能有违反公众平台协议、相关法律法规和政策的内容，请重新编辑。'),\r\n        (a.index = 1 * e.msg)\r\n      break\r\n\r\n    case 10807:\r\n      a.errmsg = '内容不能违反公众平台协议、相关法律法规和政策，请重新编辑。'\r\n      break\r\n\r\n    case 200003:\r\n      a.errmsg = '登录态超时，请重新登录。'\r\n      break\r\n\r\n    case 64513:\r\n      a.errmsg = '封面必须存在正文中，请检查封面'\r\n      break\r\n\r\n    case 64551:\r\n      a.errmsg = '请检查图文消息中的微视链接后重试。'\r\n      break\r\n\r\n    case 64552:\r\n      a.errmsg = '请检查阅读原文中的链接后重试。'\r\n      break\r\n\r\n    case 64553:\r\n      a.errmsg = '请不要在图文消息中插入超过5张卡券。请删减卡券后重试。'\r\n      break\r\n\r\n    case 64554:\r\n      a.errmsg = '在当前情况下不允许在图文消息中插入卡券，请删除卡券后重试。'\r\n      break\r\n\r\n    case 64555:\r\n      a.errmsg = '请检查图文消息卡片跳转的链接后重试。'\r\n      break\r\n\r\n    case 64556:\r\n      a.errmsg = '卡券不属于该公众号，请删除后重试'\r\n      break\r\n\r\n    case 64557:\r\n      a.errmsg = '卡券无效，请删除后重试。'\r\n      break\r\n\r\n    case 13002:\r\n      ;(a.errmsg = '该广告卡片已过期，删除后才可保存成功'),\r\n        (a.index = 1 * e.msg)\r\n      break\r\n\r\n    case 13003:\r\n      ;(a.errmsg = '已有文章插入过该广告卡片，一个广告卡片仅可插入一篇文章'),\r\n        (a.index = 1 * e.msg)\r\n      break\r\n\r\n    case 13004:\r\n      ;(a.errmsg = '该广告卡片与图文消息位置不一致'), (a.index = 1 * e.msg)\r\n      break\r\n\r\n    case 15801:\r\n    case 15802:\r\n    case 15803:\r\n    case 15804:\r\n    case 15805:\r\n    case 15806:\r\n      a.errmsg =\r\n        e.remind_wording ||\r\n        '你所编辑的内容可能含有违反微信公众平台平台协议、相关法律法规和政策的内容'\r\n      break\r\n\r\n    case 1530503:\r\n      a.errmsg = '请勿添加其他公众号的主页链接'\r\n      break\r\n\r\n    case 1530504:\r\n      a.errmsg = '请勿添加其他公众号的主页链接'\r\n      break\r\n\r\n    case 1530510:\r\n      a.errmsg = '链接已失效，请在手机端重新复制链接'\r\n      break\r\n\r\n    case 153007:\r\n    case 153008:\r\n    case 153009:\r\n    case 153010:\r\n      a.errmsg =\r\n        '很抱歉，原创声明不成功|你的文章内容未达到声明原创的要求，满足以下任一条件可发起声明：<br />1、文章文字字数大于300字，且自己创作的内容大于引用内容<br />2、文章文字字数小于300字，无视频，且图片（包括封面图）均为你已成功声明原创的图片<br />说明：上述要求中，文章文字字数不包含标点符号和空格，请知悉。'\r\n      break\r\n\r\n    case 153200:\r\n      a.errmsg = '无权限声明原创，取消声明后重试'\r\n      break\r\n\r\n    case 1530511:\r\n      a.errmsg = '链接已失效，请在手机端重新复制链接'\r\n      break\r\n\r\n    case 220001:\r\n      a.errmsg = '\"素材管理\"中的存储数量已达到上限，请删除后再操作。'\r\n      break\r\n\r\n    case 220002:\r\n      a.errmsg = '你的图片库已达到存储上限，请进行清理。'\r\n      break\r\n\r\n    case 153012:\r\n      a.errmsg = '请设置转载类型'\r\n      break\r\n\r\n    case 200042:\r\n      a.errmsg = '图文中包含的小程序素材不能多于50个、小程序帐号不能多于10个'\r\n      break\r\n\r\n    case 200043:\r\n      a.errmsg = '图文中包含没有关联的小程序，请删除后再保存'\r\n      break\r\n\r\n    case 64601:\r\n      a.errmsg = '一篇文章只能插入一个广告卡片'\r\n      break\r\n\r\n    case 64602:\r\n      a.errmsg = '尚未开通文中广告位，但文章中有广告'\r\n      break\r\n\r\n    case 64603:\r\n      a.errmsg = '文中广告前不足300字'\r\n      break\r\n\r\n    case 64604:\r\n      a.errmsg = '文中广告后不足300字'\r\n      break\r\n\r\n    case 64605:\r\n      a.errmsg = '文中不能同时插入文中广告和互选广告'\r\n      break\r\n\r\n    case 65101:\r\n      a.errmsg = '图文模版数量已达到上限，请删除后再操作'\r\n      break\r\n\r\n    case 64560:\r\n      a.errmsg = '请勿插入历史图文消息页链接'\r\n      break\r\n\r\n    case 64561:\r\n      a.errmsg = '请勿插入mp.weixin.qq.com域名下的非图文消息链接'\r\n      break\r\n\r\n    case 64562:\r\n      a.errmsg = '请勿插入非mp.weixin.qq.com域名的链接'\r\n      break\r\n\r\n    case 153013:\r\n      a.errmsg = '文章内含有投票，不能设置为开放转载'\r\n      break\r\n\r\n    case 153014:\r\n      a.errmsg = '文章内含有卡券，不能设置为开放转载'\r\n      break\r\n\r\n    case 153015:\r\n      a.errmsg = '文章内含有小程序链接，不能设置为开放转载'\r\n      break\r\n\r\n    case 153016:\r\n      a.errmsg = '文章内含有小程序链接，不能设置为开放转载'\r\n      break\r\n\r\n    case 153017:\r\n      a.errmsg = '文章内含有小程序卡片，不能设置为开放转载'\r\n      break\r\n\r\n    case 153018:\r\n      a.errmsg = '文章内含有商品，不能设置为开放转载'\r\n      break\r\n\r\n    case 153019:\r\n      a.errmsg = '文章内含有广告卡片，不能设置为开放转载'\r\n      break\r\n\r\n    case 153020:\r\n      a.errmsg = '文章内含有广告卡片，不能设置为开放转载'\r\n      break\r\n\r\n    case 153021:\r\n      a.errmsg = '文章内含有广告卡片，不能设置为开放转载'\r\n      break\r\n\r\n    case 153101:\r\n      a.errmsg = '含有原文已删除的转载文章，请删除后重试'\r\n      break\r\n\r\n    case 64707:\r\n      a.errmsg = '赞赏账户授权失效或者状态异常'\r\n      break\r\n\r\n    case 420001:\r\n      a.errmsg = '封面图不支持GIF，请更换'\r\n      break\r\n\r\n    case 353004:\r\n      a.errmsg = '不支持添加商品，请删除后重试'\r\n      break\r\n\r\n    case 442001:\r\n      a.errmsg = '帐号新建/编辑素材能力已被封禁，暂不可使用。'\r\n      break\r\n\r\n    default:\r\n      a.errmsg = '系统繁忙，请稍后重试'\r\n  }\r\n  return a\r\n}\r\n\n\n/***/ }),\n\n/***/ 402:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ WordpressAdapter)\n/* harmony export */ });\nfunction xmlrpcWrapper(conf) {\r\n  return new Promise((resolve, reject) => {\r\n    $.xmlrpc(conf).then(\r\n      function(response, status, xhr) {\r\n        resolve({\r\n          response,\r\n          status,\r\n          xhr,\r\n        })\r\n      },\r\n      function(jqXHR, status, error) {\r\n        reject({\r\n          jqXHR,\r\n          status,\r\n          error,\r\n        })\r\n      }\r\n    )\r\n  })\r\n}\r\n\r\nclass WordpressAdapter {\r\n  constructor(url, user, pwd, isTypecho) {\r\n    this.url = url\r\n    this.user = user\r\n    this.pwd = pwd\r\n    this.isTypecho = isTypecho\r\n  }\r\n\r\n  getRPC() {\r\n    var endPoint = this.url + '/xmlrpc.php'\r\n    if (this.isTypecho) {\r\n      endPoint = this.url + '/action/xmlrpc'\r\n    }\r\n    return endPoint\r\n  }\r\n\r\n  async getMetaData() {\r\n    var params = [this.user, this.pwd]\r\n    var res = await xmlrpcWrapper({\r\n      url: this.getRPC(),\r\n      methodName: 'wp.getUsersBlogs',\r\n      params: params,\r\n    })\r\n    console.log('end')\r\n    res.icon = chrome.extension.getURL('images/wordpress.ico')\r\n    return res\r\n  }\r\n\r\n  addPost(post) {\r\n    if (this.isTypecho) {\r\n      return {\r\n        status: 'success',\r\n        post_id: '1',\r\n      }\r\n    }\r\n\r\n    var params = [0, this.user, this.pwd, post]\r\n    var end = this.url\r\n    return xmlrpcWrapper({\r\n      url: this.getRPC(),\r\n      methodName: 'wp.newPost',\r\n      params: params,\r\n    })\r\n  }\r\n\r\n  editPost(post_id, post) {\r\n    var params = [0, this.user, this.pwd, post]\r\n    var endpoint = this.getRPC()\r\n    var isTypecho = this.isTypecho\r\n    if (isTypecho) {\r\n      params.push(false)\r\n      params[3] = {\r\n        title: post['post_title'],\r\n        // text: \"!!!\\n\" + post['post_content'].trim() + \"\\n!!!\",\r\n        description: post['post_content'].trim(),\r\n        // markdown: 1\r\n      }\r\n      console.log('params', params)\r\n    } else {\r\n      params[3] = post_id\r\n      params.push(post)\r\n    }\r\n    return new Promise((resolve, reject) => {\r\n      ;(async () => {\r\n        try {\r\n          var res = await xmlrpcWrapper({\r\n            url: endpoint,\r\n            methodName: isTypecho ? 'metaWeblog.newPost' : 'wp.editPost',\r\n            params: params,\r\n          })\r\n\r\n          res.draftLink = this.url + '?p=' + post_id\r\n          console.log('Wordpress', res)\r\n          resolve(res)\r\n        } catch (e) {\r\n          reject(e)\r\n        }\r\n      })()\r\n    })\r\n  }\r\n\r\n  //  'metaWeblog.getPost' => array($this, 'mwGetPost'),\r\n\r\n  editImg(img, source) {\r\n    // img.attr('web_uri', source.images[0].origin_web_uri)\r\n    img.removeAttr('data-src')\r\n  }\r\n\r\n  uploadFile(file) {\r\n    if (this.isTypecho) {\r\n      file['bytes'] = file['bits']\r\n      delete file['bits']\r\n    }\r\n    var params = [0, this.user, this.pwd, file]\r\n\r\n    var end = this.url\r\n    return $.xmlrpc({\r\n      url: this.getRPC(),\r\n      methodName: 'wp.uploadFile',\r\n      params: params,\r\n    })\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 659:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ ZhiHuAdapter)\n/* harmony export */ });\nfunction escapeHtml(text) {\r\n  return text\r\n    .replace(/&/g, '&amp;')\r\n    .replace(/</g, '&lt;')\r\n    .replace(/>/g, '&gt;')\r\n    .replace(/\"/g, '&quot;')\r\n    .replace(/'/g, '&#039;')\r\n}\r\n\r\nfunction getChildren(obj, count) {\r\n  count++\r\n  if (count > 4) return null\r\n  if (obj.children().length > 1) return obj\r\n  return getChildren(obj.children().eq(0), count)\r\n}\r\n\r\nfunction CodeBlockToPlainTextOther(pre) {\r\n  var text = []\r\n  var minSub = getChildren(pre, 0)\r\n  var lines = minSub.children()\r\n  for (let index = 0; index < lines.length; index++) {\r\n    const element = lines.eq(index)\r\n    const codeStr = element.text()\r\n    text.push('<code>' + escapeHtml(codeStr) + '</code>')\r\n  }\r\n  return text.join('\\n')\r\n}\r\n\r\nfunction CodeBlockToPlainText(pre) {\r\n  var text = []\r\n  var minSub = getChildren(pre, 0)\r\n  var lines = pre.find('code')\r\n  if (lines.length > 1) {\r\n    return CodeBlockToPlainTextOther(pre)\r\n  }\r\n\r\n  for (let index = 0; index < lines.length; index++) {\r\n    const element = lines.eq(index)\r\n    const codeStr = element[0].innerText\r\n    console.log('codeStr', codeStr)\r\n    var codeLines = codeStr.split('\\n')\r\n    codeLines.forEach((codeLine) => {\r\n      text.push('<code>' + escapeHtml(codeLine) + '</code>')\r\n    })\r\n  }\r\n  return text.join('\\n')\r\n}\r\n\r\nclass ZhiHuAdapter {\r\n  constructor() {\r\n    // this.skipReadImage = true\r\n    this.version = '0.0.1'\r\n    this.name = 'zhihu'\r\n  }\r\n\r\n  async getMetaData() {\r\n    var res = await $.ajax({\r\n      url:\r\n        'https://www.zhihu.com/api/v4/me?include=account_status%2Cis_bind_phone%2Cis_force_renamed%2Cemail%2Crenamed_fullname',\r\n    })\r\n    // console.log(res);\r\n    return {\r\n      uid: res.uid,\r\n      title: res.name,\r\n      avatar: res.avatar_url,\r\n      supportTypes: ['html'],\r\n      type: 'zhihu',\r\n      displayName: '知乎',\r\n      home: 'https://www.zhihu.com/settings/account',\r\n      icon: 'https://static.zhihu.com/static/favicon.ico',\r\n    }\r\n  }\r\n\r\n  async addPost(post) {\r\n    var res = await $.ajax({\r\n      url: 'https://zhuanlan.zhihu.com/api/articles/drafts',\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      contentType: 'application/json',\r\n      data: JSON.stringify({\r\n        title: post.post_title,\r\n        // content: post.post_content\r\n      }),\r\n    })\r\n    console.log(res)\r\n    return {\r\n      status: 'success',\r\n      post_id: res.id,\r\n    }\r\n    //\r\n  }\r\n\r\n  async editPost(post_id, post) {\r\n    console.log('editPost', post.post_thumbnail)\r\n    var res = await $.ajax({\r\n      url: 'https://zhuanlan.zhihu.com/api/articles/' + post_id + '/draft',\r\n      type: 'PATCH',\r\n      contentType: 'application/json',\r\n      data: JSON.stringify({\r\n        title: post.post_title,\r\n        content: post.post_content,\r\n        isTitleImageFullScreen: false,\r\n        titleImage: 'https://pic1.zhimg.com/' + post.post_thumbnail + '.png',\r\n      }),\r\n    })\r\n\r\n    return {\r\n      status: 'success',\r\n      post_id: post_id,\r\n      draftLink: 'https://zhuanlan.zhihu.com/p/' + post_id + '/edit',\r\n    }\r\n    // https://zhuanlan.zhihu.com/api/articles/68769713/draft\r\n  }\r\n\r\n  untiImageDone(image_id) {\r\n    return new Promise(function(resolve, reject) {\r\n      function waitToNext() {\r\n        console.log('untiImageDone', image_id);\r\n        (async () => {\r\n          var imgDetail = await $.ajax({\r\n            url: 'https://api.zhihu.com/images/' + image_id,\r\n            type: 'GET',\r\n          })\r\n          console.log('imgDetail', imgDetail)\r\n          if (imgDetail.status != 'processing') {\r\n            console.log('all done')\r\n            resolve(imgDetail)\r\n          } else {\r\n            // console.log('go next', waitToNext)\r\n            setTimeout(waitToNext, 300)\r\n          }\r\n        })()\r\n      }\r\n      waitToNext()\r\n    })\r\n  }\r\n\r\n  async _uploadFile(file) {\r\n    var src = file.src\r\n    var res = await $.ajax({\r\n      url: 'https://zhuanlan.zhihu.com/api/uploaded_images',\r\n      type: 'POST',\r\n      headers: {\r\n        accept: '*/*',\r\n        'x-requested-with': 'fetch',\r\n      },\r\n      data: {\r\n        url: src,\r\n        source: 'article',\r\n      },\r\n    })\r\n\r\n    return [\r\n      {\r\n        id: res.hash,\r\n        object_key: res.hash,\r\n        url: res.src,\r\n      },\r\n    ]\r\n  }\r\n\r\n  async uploadFile(file) {\r\n    console.log('ZhiHuDriver.uploadFile', file, md5)\r\n    var updateData = JSON.stringify({\r\n      image_hash: md5(file.bits),\r\n      source: 'article',\r\n    })\r\n    console.log('upload', updateData)\r\n    var fileResp = await $.ajax({\r\n      url: 'https://api.zhihu.com/images',\r\n      type: 'POST',\r\n      dataType: 'JSON',\r\n      contentType: 'application/json',\r\n      data: updateData,\r\n    })\r\n\r\n    console.log('upload', fileResp)\r\n\r\n    var upload_file = fileResp.upload_file\r\n    if (fileResp.upload_file.state == 1) {\r\n      var imgDetail = await this.untiImageDone(upload_file.image_id)\r\n      console.log('imgDetail', imgDetail)\r\n      upload_file.object_key = imgDetail.original_hash\r\n    } else {\r\n      var token = fileResp.upload_token\r\n      let client = new OSS({\r\n        endpoint: 'https://zhihu-pics-upload.zhimg.com',\r\n        accessKeyId: token.access_id,\r\n        accessKeySecret: token.access_key,\r\n        stsToken: token.access_token,\r\n        cname: true,\r\n        bucket: 'zhihu-pics',\r\n      })\r\n      var finalUrl = await client.put(\r\n        upload_file.object_key,\r\n        new Blob([file.bits])\r\n      )\r\n      console.log(client, finalUrl)\r\n    }\r\n    console.log(file, fileResp)\r\n\r\n    if (file.type === 'image/gif') {\r\n      // add extension for gif\r\n      upload_file.object_key = upload_file.object_key + '.gif';\r\n    }\r\n    return [\r\n      {\r\n        id: upload_file.object_key,\r\n        object_key: upload_file.object_key,\r\n        url: 'https://pic4.zhimg.com/' + upload_file.object_key,\r\n        // url: 'https://pic1.zhimg.com/80/' + upload_file.object_key + '_hd.png',\r\n      },\r\n    ]\r\n  }\r\n\r\n  async preEditPost(post) {\r\n    var div = $('<div>')\r\n    $('body').append(div)\r\n\r\n    // post.content = post.content.replace(/\\>\\s+\\</g,'');\r\n    div.html(post.content)\r\n\r\n    // var org = $(post.content);\r\n    // var doc = $('<div>').append(org.clone());\r\n    var doc = div\r\n    var pres = doc.find('pre')\r\n    console.log('find code blocks', pres.length, post)\r\n    for (let mindex = 0; mindex < pres.length; mindex++) {\r\n      const pre = pres.eq(mindex)\r\n      try {\r\n        var newHtml = CodeBlockToPlainText(pre, 0)\r\n        if (newHtml) {\r\n          console.log(newHtml)\r\n          pre.html(newHtml)\r\n        }\r\n      } catch (e) {}\r\n    }\r\n\r\n    var processEmptyLine = function (idx, el) {\r\n      var $obj = $(this)\r\n      var originalText = $obj.text()\r\n      var img = $obj.find('img')\r\n      var brs = $obj.find('br')\r\n      if (originalText == '') {\r\n        ;(function () {\r\n          if (img.length) return\r\n          if (!brs.length) return\r\n          $obj.remove()\r\n        })()\r\n      }\r\n\r\n      // try to replace as h2;\r\n      var strongTag = $obj.find('strong').eq(0)\r\n      var childStrongText = strongTag.text()\r\n      if (originalText == childStrongText) {\r\n        var strongSize = null\r\n        var tagStart = strongTag\r\n        var align = null\r\n        for (let index = 0; index < 4; index++) {\r\n          var fontSize = tagStart.css('font-size')\r\n          var textAlign = tagStart.css('text-align')\r\n          if (fontSize) {\r\n            strongSize = fontSize\r\n          }\r\n          if (textAlign) {\r\n            align = textAlign\r\n          }\r\n          if (align && strongSize) break\r\n          if (tagStart == $obj) {\r\n            console.log('near top')\r\n            break\r\n          }\r\n          tagStart = tagStart.parent()\r\n        }\r\n        if (strongSize) {\r\n          var theFontSize = parseInt(strongSize)\r\n          if (theFontSize > 17 && align == 'center') {\r\n            var newTag = $('<h2></h2>').append($obj.html())\r\n            $obj.after(newTag).remove()\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // remove empty break line\r\n    doc.find('p').each(processEmptyLine)\r\n    doc.find('section').each(processEmptyLine)\r\n\r\n    var processBr = function (idx, el) {\r\n      var $obj = $(this)\r\n      if (!$obj.next().length) {\r\n        $obj.remove()\r\n      }\r\n    }\r\n    doc.find('br').each(processBr)\r\n    // table {\r\n    //     margin-bottom: 10px;\r\n    //     border-collapse: collapse;\r\n    //     display: table;\r\n    //     width: 100%!important;\r\n    // }\r\n    // td, th {\r\n    //     word-wrap: break-word;\r\n    //     word-break: break-all;\r\n    //     padding: 5px 10px;\r\n    //     border: 1px solid #DDD;\r\n    // }\r\n\r\n    // console.log('found table', doc.find('table'))\r\n    var tempDoc = $('<div>').append(doc.clone())\r\n    post.content =\r\n      tempDoc.children('div').length == 1\r\n        ? tempDoc.children('div').html()\r\n        : tempDoc.html()\r\n    // div.remove();\r\n  }\r\n}\r\n\n\n/***/ }),\n\n/***/ 449:\n/***/ ((module, __unused_webpack_exports, __webpack_require__) => {\n\nvar map = {\n\t\"./163.js\": 150,\n\t\"./51cto.js\": 258,\n\t\"./BaseAdapter.js\": 174,\n\t\"./CSDN.js\": 617,\n\t\"./Cnblog.js\": 308,\n\t\"./Discuz.js\": 159,\n\t\"./Juejin.js\": 341,\n\t\"./Segmentfault.js\": 920,\n\t\"./Weibo.js\": 836,\n\t\"./YiDian.js\": 522,\n\t\"./baijiahao.js\": 386,\n\t\"./bilibili.js\": 536,\n\t\"./douban.js\": 247,\n\t\"./focus.js\": 754,\n\t\"./jianshu.js\": 172,\n\t\"./sohu.js\": 192,\n\t\"./toutiao.js\": 968,\n\t\"./weixin.js\": 476,\n\t\"./wordpress.js\": 402,\n\t\"./zhihu.js\": 659\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 449;\n\n/***/ })\n\n/******/ \t});\n/************************************************************************/\n/******/ \t// The module cache\n/******/ \tvar __webpack_module_cache__ = {};\n/******/ \t\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/ \t\t// Check if module is in cache\n/******/ \t\tvar cachedModule = __webpack_module_cache__[moduleId];\n/******/ \t\tif (cachedModule !== undefined) {\n/******/ \t\t\treturn cachedModule.exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = __webpack_module_cache__[moduleId] = {\n/******/ \t\t\t// no module.id needed\n/******/ \t\t\t// no module.loaded needed\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/ \t\n/******/ \t\t// Execute the module function\n/******/ \t\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n/******/ \t\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/ \t\n/************************************************************************/\n/******/ \t/* webpack/runtime/define property getters */\n/******/ \t(() => {\n/******/ \t\t// define getter functions for harmony exports\n/******/ \t\t__webpack_require__.d = (exports, definition) => {\n/******/ \t\t\tfor(var key in definition) {\n/******/ \t\t\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n/******/ \t\t\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n/******/ \t\t\t\t}\n/******/ \t\t\t}\n/******/ \t\t};\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/hasOwnProperty shorthand */\n/******/ \t(() => {\n/******/ \t\t__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/make namespace object */\n/******/ \t(() => {\n/******/ \t\t// define __esModule on exports\n/******/ \t\t__webpack_require__.r = (exports) => {\n/******/ \t\t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t\t}\n/******/ \t\t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t\t};\n/******/ \t})();\n/******/ \t\n/************************************************************************/\nvar __webpack_exports__ = {};\n// This entry need to be wrapped in an IIFE because it need to be in strict mode.\n(() => {\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, {\n  \"addCustomDriver\": () => (/* binding */ addCustomDriver),\n  \"getDriver\": () => (/* binding */ getDriver),\n  \"getMeta\": () => (/* binding */ getMeta),\n  \"getPublicAccounts\": () => (/* binding */ getPublicAccounts)\n});\n\n;// CONCATENATED MODULE: ../@wechatsync/drivers/index.js\nfunction importAll(r) {\n  const modules = {}\n  r.keys().forEach(key => {\n    const module = r(key)\n    const moduleName = module.default ? module.default.name : null\n    if (moduleName && moduleName !== 'BaseAdapter') {\n      modules[moduleName] = module.default\n    }\n  })\n  return modules\n}\n\n/* harmony default export */ const drivers = (importAll(__webpack_require__(449)));\n\n;// CONCATENATED MODULE: ./src/drivers/driver.js\n\n\nconst {\n  JianShuAdapter,\n  ZhiHuAdapter,\n  WordpressAdapter,\n  ToutiaoAdapter,\n  WeiboAdapter,\n  SegmentfaultAdapter,\n  JuejinAdapter,\n  CSDNAdapter,\n  CnblogAdapter,\n  WeixinAdapter,\n  YiDianAdapter,\n  DoubanAdapter,\n  BilibiliAdapter,\n  _51CtoAdapter,\n  FocusAdapter,\n  DiscuzAdapter,\n  SoHuAdapter,\n  BaiJiaHaoAdapter\n} = drivers;\n\nvar _cacheState = {}\nconst _customDrivers = {};\n\nfunction addCustomDriver(name, driverClass) {\n  _customDrivers[name] = {\n    name: name,\n    handler: driverClass\n  }\n  console.log('addCustomDriver', _customDrivers)\n}\n\nfunction getDriver(account) {\n\n  // 保证在内置的前面\n  if(_customDrivers[account.type]) {\n    const driverInCustom = _customDrivers[account.type]\n    return new driverInCustom['handler'](account)\n  }\n\n  if (account.type == 'wordpress') {\n    return new WordpressAdapter(\n      account.params.wpUrl,\n      account.params.wpUser,\n      account.params.wpPwd\n    )\n  }\n\n  if (account.type == 'zhihu') {\n    return new ZhiHuAdapter()\n  }\n\n  if (account.type == 'jianshu') {\n    return new JianShuAdapter()\n  }\n\n  if (account.type == 'typecho') {\n    return new WordpressAdapter(\n      account.params.wpUrl,\n      account.params.wpUser,\n      account.params.wpPwd,\n      true\n    )\n  }\n\n  if (account.type == 'toutiao') {\n    return new ToutiaoAdapter()\n  }\n\n  if (account.type == 'bilibili') {\n    return new BilibiliAdapter({\n      globalState: _cacheState,\n      state: _cacheState[account.type],\n    })\n  }\n\n  if (account.type == 'weibo') {\n    return new WeiboAdapter()\n  }\n\n  if (account.type == 'sohufocus') {\n    return new FocusAdapter()\n  }\n\n  if (account.type == '51cto') {\n    return new _51CtoAdapter()\n  }\n\n  if (account.type == 'segmentfault') {\n    return new SegmentfaultAdapter(account)\n  }\n\n  if (account.type == 'juejin') {\n    return new JuejinAdapter(account)\n  }\n\n  if (account.type == 'csdn') {\n    return new CSDNAdapter(account)\n  }\n\n  if (account.type == 'cnblog') {\n    return new CnblogAdapter(account)\n  }\n  if (account.type == 'weixin') {\n    return new WeixinAdapter(account)\n  }\n\n  if (account.type == 'yidian') {\n    return new YiDianAdapter(account)\n  }\n\n  if (account.type == 'baijiahao') {\n    return new BaiJiaHaoAdapter(account)\n  }\n\n  if(account.type == 'douban') {\n    console.log(account.type)\n    return new DoubanAdapter({\n      globalState: _cacheState,\n      state: _cacheState[account.type],\n    })\n  }\n\n  if(account.type == 'discuz') {\n    console.log('discuz', account)\n    return new DiscuzAdapter(account.config)\n  }\n\n  if (account.type == 'sohu') {\n    return new SoHuAdapter(account)\n  }\n\n  throw Error('not supprt account type')\n}\n\nconst chunk = (arr, size) => Array.from({ length: Math.ceil(arr.length / size) }, (v, i) =>\n  arr.slice(i * size, i * size + size)\n);\n\nlet _cacheUsers = null\nlet _lastFetch = null\n\nasync function getPublicAccounts() {\n\n  // 限制100s 保证不会太频繁请求平台\n  if(_lastFetch != null) {\n    const isTooQuickly = (Date.now() - _lastFetch) < 100 * 1000\n    if (isTooQuickly) {\n      console.log('too quickly return by cache')\n      return _cacheUsers\n    }\n  }\n\n  console.log('getPublicAccounts')\n  var drivers = [\n    new SegmentfaultAdapter(),\n    new CSDNAdapter(),\n    new JuejinAdapter(),\n    new CnblogAdapter(),\n    new WeiboAdapter(),\n    new ZhiHuAdapter(),\n    new JianShuAdapter(),\n    new ToutiaoAdapter(),\n    new WeixinAdapter(),\n    new YiDianAdapter(),\n    new DoubanAdapter(),\n    new BilibiliAdapter(),\n    new _51CtoAdapter(),\n    new FocusAdapter(),\n    new BaiJiaHaoAdapter(),\n    new SoHuAdapter()\n  ]\n\n  var customDiscuzEndpoints = ['https://www.51hanghai.com'];\n  customDiscuzEndpoints.forEach(_ => {\n    drivers.push(new DiscuzAdapter({\n      url: _,\n   }));\n  })\n\n  for (let index = 0; index < _customDrivers.length; index++) {\n    const _customDriver = _customDrivers[index];\n    try {\n      drivers.push(new _customDriver['handler']());\n    } catch (e) {\n      console.log('initlaze custom driver error', e)\n    }\n  }\n\n  var users = []\n\n  const stepItems = chunk(drivers, 20);\n  const startTime = Date.now()\n  for (let index = 0; index < stepItems.length; index++) {\n    try {\n      const stepItem = stepItems[index];\n      const results = await Promise.all(\n        stepItem.map((driver) => {\n          return new Promise((resolve, reject) => {\n            driver.getMetaData().then(resolve, function() {\n              resolve(null)\n            })\n          })\n        })\n      );\n      const successAccounts = results.filter(_ => _)\n      users = users.concat(successAccounts)\n    } catch (e) {\n      console.log(\"chunkPromise\", e);\n    }\n  }\n  // for (let index = 0; index < drivers.length; index++) {\n  //   const driver = drivers[index]\n  //   try {\n  //     var user = await driver.getMetaData()\n  //     users.push(user)\n  //   } catch (e) {\n  //     console.log(e)\n  //   }\n  // }\n  const spend = Date.now() - startTime\n  console.log('getPublicAccounts spend', spend, 'driverCount', drivers.length)\n  _lastFetch = Date.now()\n  _cacheUsers = users\n  return users\n}\n\nfunction getCookie(name, cookieStr) {\n  let arr,\n    reg = new RegExp('(^| )' + name + '=([^;]*)(;|$)')\n  if ((arr = cookieStr.match(reg))) {\n    return unescape(arr[2])\n  } else {\n    return ''\n  }\n}\n\nfunction urlHandler(details) {\n  if (\n    details.url.indexOf('api.bilibili.com') >\n    -1\n  ) {\n    var cookieHeader = details.requestHeaders.filter(h => {\n      return h.name.toLowerCase() == 'cookie'\n    })\n\n    if (cookieHeader.length) {\n      var cookieStr = cookieHeader[0].value\n      var bili_jct = getCookie('bili_jct', cookieStr)\n      if (bili_jct) {\n        _cacheState['bilibili'] = _cacheState['bilibili'] || {};\n        Object.assign(_cacheState['bilibili'], {\n          csrf: bili_jct,\n        })\n        console.log('bili_jct', bili_jct, details)\n      }\n    }\n    // console.log('details.requestHeaders', details)\n  }\n  // https://music.douban.com/subject/24856133/new_review\n  if (\n    details.url.indexOf('music.douban.com') >\n    -1\n    &&\n    details.url.indexOf('/new_review') >\n    -1\n  ) {\n    _cacheState['douban'] = _cacheState['douban'] || {};\n    Object.assign(_cacheState['douban'], {\n      is_review: true,\n      subject: 'music',\n      url: details.url,\n      id: details.url.replace('https://music.douban.com/subject/', '')\n      .replace('/new_review', '')\n    })\n  }\n}\n\nfunction getMeta() {\n  return {\n    version: '0.0.12',\n    versionNumber: 12,\n    log: '',\n    urlHandler: urlHandler,\n    inspectUrls: ['*://api.bilibili.com/*', '*://music.douban.com/*'],\n  }\n}\n\n// DEVTOOL_PLACEHOLDER_INSERT\n\n})();\n\nmodules = __webpack_exports__;\n/******/ })()\n;for (var k in modules) exports[k] = modules[k];"